"use strict";let date=new Date,descargas="RegistroDiagnostico_"+date.getFullYear()+"_"+date.getMonth()+"_"+date.getUTCDay()+"_"+date.getMilliseconds(),pagina="58";class RegistroDiagnostico{constructor(n){this.IdRegistroFalla=n;this.IdEqúipo=null;this.FechaCreacion=null;this.Descripcion="";this.Diagnostico="";this.Orometro="";this.DetieneOperacion=!1}}const registroDiagnostico={init:()=>{$("#alert-operacion-ok").hide(),$("#alert-operacion-fail").hide(),$("#panelTabla").show(),$("#panelForm").hide(),registroDiagnostico.idSeleccionado=-1,registroDiagnostico.idEquipoSeleccionado=-1,registroDiagnostico.cargarItems(),registroDiagnostico.cargarComboMarcasRefacciones(),datosEquipo.cargarComboMarcas(),datosEquipo.cargarComboUbicaciones(),datosEquipo.cargarComboUnidades(),datosEquipo.cargarComboUnidadesMedida()},cargarItems:()=>{var n={};n.path=window.location.hostname;n.idUsuario=sessionStorage.getItem("idusuario");utils.postData("../pages/MantenimientoPanelDiagnostico.aspx/GetListaItems",n).then(n=>{n=n.d;let t=$("#table").DataTable({destroy:!0,processing:!0,order:[],data:n,columns:[{data:"IdRequisicion"},{data:"NumeroEconomico"},{data:"NombreEquipo"},{data:"FechaCreacionFormateada"},{data:"NombrePrioridad"},{data:"NombreStatus"},{data:"NombreUsuario"},{data:"Accion"}],language:textosEsp,columnDefs:[{targets:[-1],orderable:!1},],dom:"frtiplB",buttons:[{extend:"excelHtml5",title:descargas,text:"Xls",className:"excelbtn"},{extend:"pdfHtml5",title:descargas,text:"Pdf",className:"pdfbtn"}]})})},cargarComboMarcasRefacciones:()=>{var n={};n.path=window.location.hostname;n=JSON.stringify(n);$.ajax({type:"POST",url:"../pages/Proyectos.aspx/GetListaMarcas",data:n,contentType:"application/json; charset=utf-8",dataType:"json","async":!0,success:function(n){var t=n.d,i=new $.jqx.dataAdapter(t);$("#comboMarcaProveedor").jqxDropDownList({source:i,displayMember:"Nombre",valueMember:"Id_Marca",width:"250px",height:"20px",placeHolder:"Seleccione:",filterable:!0,searchMode:"containsignorecase",filterPlaceHolder:"Buscar"});$("#comboMarcaProveedor").jqxDropDownList("clearSelection")},error:function(n,t){console.log(t+": "+n.responseText)}})},eliminar:n=>{registroDiagnostico.idSeleccionado=n,$("#panelEliminar").modal("show")},editar:n=>{$(".form-group").removeClass("has-error");$(".help-block").empty();$("#divDocumentos").empty();$("#panelFormRefacciones").hide();$("#panelTablaRefacciones").hide();var t={};t.path=window.location.hostname;t.id=n;t=JSON.stringify(t);$.ajax({type:"POST",url:"../pages/MantenimientoPanelDiagnostico.aspx/GetItem",data:t,contentType:"application/json; charset=utf-8",dataType:"json","async":!0,success:function(n){var t=n.d;registroDiagnostico.idSeleccionado=t.IdRequisicion;registroDiagnostico.idEquipoSeleccionado=t.IdEquipo;$("#txtNumeroRequisicion").val(t.IdRequisicion);$("#txtNombreEquipo").val(t.NombreEquipo);$("#txtGeneradoPor").val(t.NombreUsuario);$("#txtNombreOperador").val(t.NombreOperador);$("#txtTelefono").val(t.Telefono);$("#txtFechaCreacion").val(t.FechaCreacionFormateadaMx);$("#txtFechaCreacion").prop("fecha",t.FechaCreacionCanonical);$("#txtOrometro").val(t.Orometro);$("#chkDetieneOperacion").prop("checked",t.DetieneOperacion==1);$("#txtDescripcion").val(t.Descripcion);$("#txtDiagnostico").val(t.Diagnostico);$("#txtNumeroEconomico").val(t.NumeroEconomico);$("#comboMarca").val(t.IdMarca);$("#comboUbicacion").val(t.IdUbicacion);datosEquipo.cargarComboModelos_(t.IdMarca,t.IdModelo);$("#txtPrioridadRojo").hide();$("#txtPrioridadAmarillo").hide();$("#txtPrioridadVerde").hide();switch(t.IdNivelPrioridad){case 1:$("#txtPrioridadRojo").show();break;case 2:$("#txtPrioridadAmarillo").show();break;case 3:$("#txtPrioridadVerde").show()}registroDiagnostico.accion="editar";$("#spnTituloForm").text("Editar");$(".deshabilitable").prop("disabled",!1);let i={path:window.location.hostname,id_requisicion:t.IdRequisicion,idUsuario:sessionStorage.getItem("idusuario"),id_tipo:1};utils.getDocumentos(i);registroPanelRefacciones.idRequisicionSeleccionada=t.IdRequisicion;registroPanelRefacciones.cargarItems(t.IdRequisicion);$("#panelTablaRefacciones").show()},error:function(n,t){console.log(t+": "+n.responseText)}})},finalizar:(n,t)=>{registroDiagnostico.idSeleccionado=n,registroDiagnostico.idEquipoSeleccionado=t,$("#msgFinalizar").html("<p>Se dara por finalizada esta orden de trabajo  (No."+n+"). ¿Desea continuar?<\/p>"),$("#panelFinalizar").modal("show")},status_enatencion:(n,t)=>{registroDiagnostico.idSeleccionado=n,registroDiagnostico.idEquipoSeleccionado=t,registroDiagnostico.idStatus=5,$("#msgSetEnAtencion").html("<p>Se enviará esta orden a status <strong>En atención <\/strong>(No."+n+"). ¿Desea continuar?<\/p>"),$("#panelEnAtencion").modal("show")},status_proximoaatender:(n,t)=>{registroDiagnostico.idSeleccionado=n,registroDiagnostico.idEquipoSeleccionado=t,registroDiagnostico.idStatus=3,$("#msgSetStatus").html("<p>Se enviará esta orden a status <strong>Próximo a atender<\/strong>(No."+n+"). ¿Desea continuar?<\/p>"),$("#panelSetStatus").modal("show")},enviar:n=>{registroDiagnostico.idSeleccionado=n,$("#msgEnviar").html("<p>Se enviará a la siguiente etapa el registro seleccionado(No."+n+"). ¿Desea continuar?<\/p>"),$("#panelEnviar").modal("show")},abrir:n=>{$(".form-group").removeClass("has-error");$(".help-block").empty();var t={};t.path=window.location.hostname;t.id=n;t=JSON.stringify(t);$.ajax({type:"POST",url:"../pages/MantenimientoPanelDiagnostico.aspx/GetItem",data:t,contentType:"application/json; charset=utf-8",dataType:"json","async":!0,success:function(n){var t=n.d;registroDiagnostico.idSeleccionado=t.IdRequisicion;registroDiagnostico.idEquipoSeleccionado=t.IdEquipo;$("#txtNumeroRequisicion").val(t.IdRequisicion);$("#txtNombreEquipo").val(t.NombreEquipo);$("#txtNombreProveedor").val(t.NombreProveedor);$("#txtFechaCreacion").val(t.FechaCreacionFormateada);$("#txtDescripcion").val(t.Descripcion);$("#txtNumeroEconomico").val(t.NumeroEconomico);$("#comboMarca").val(t.IdMarca);datosEquipo.cargarComboModelos_(t.IdMarca,t.IdModelo);registroDiagnostico.accion="editar";$("#spnTituloForm").text("Datos requisición");$(".deshabilitable").prop("disabled",!0);datosEquipo.odometro(t.IdEquipo);let i={path:window.location.hostname,id_requisicion:t.IdRequisicion,idUsuario:sessionStorage.getItem("idusuario"),id_tipo:1};datosEquipo.odometro(t.IdEquipo);utils.getDocumentos(i);$("#panelTabla").hide();$("#panelForm").show()},error:function(n,t){console.log(t+": "+n.responseText)}})},nuevo:()=>{$("#frm")[0].reset(),$(".form-group").removeClass("has-error"),$(".help-block").empty(),$("#spnTituloForm").text("Reporte de fallas"),$("#txtDescripcion").val(""),$("#panelTabla").hide(),$("#panelForm").show(),registroDiagnostico.accion="nuevo",registroDiagnostico.idSeleccionado=-1,registroDiagnostico.idEquipoSeleccionado=-1,$(".deshabilitable").prop("disabled",!1),obtenerFechaHoraServidor("txtFechaCreacion")},accionesBotones:()=>{$("#btnSetEnAtencion").on("click",()=>{var n={};n.path=window.location.hostname;n.id=registroDiagnostico.idSeleccionado;n.idEquipo=registroDiagnostico.idEquipoSeleccionado;n.idUsuario=sessionStorage.getItem("idusuario");n.status=registroDiagnostico.idStatus;n=JSON.stringify(n);$.ajax({type:"POST",url:"../pages/MantenimientoPanelDiagnostico.aspx/setStatusEnAtencion",data:n,contentType:"application/json; charset=utf-8",dataType:"json","async":!0,success:function(n){var t=n.d;t.MensajeError===null?(utils.toast(mensajesAlertas.exitoCambiarStatus,"ok"),registroDiagnostico.cargarItems()):utils.toast(t.MensajeError,"error")},error:function(n,t){console.log(t+": "+n.responseText);utils.toast(resultado.MensajeError,"error")}})});$("#btnSetStatusAceptar").on("click",()=>{var n={};n.path=window.location.hostname;n.id=registroDiagnostico.idSeleccionado;n.idEquipo=registroDiagnostico.idEquipoSeleccionado;n.status=registroDiagnostico.idStatus;n=JSON.stringify(n);$.ajax({type:"POST",url:"../pages/MantenimientoListadoFallas.aspx/setStatusRequisicion",data:n,contentType:"application/json; charset=utf-8",dataType:"json","async":!0,success:function(n){var t=n.d;t.MensajeError===null?(utils.toast(mensajesAlertas.exitoCambiarStatus,"ok"),registroDiagnostico.cargarItems()):utils.toast(t.MensajeError,"error")},error:function(n,t){console.log(t+": "+n.responseText);utils.toast(resultado.MensajeError,"error")}})});$("#btnGuardar").on("click",n=>{var r,i,t;if(n.preventDefault(),r=$('form[name="frm"]').validator("validate").has(".has-error").length,!r){if(registroDiagnostico.idEquipoSeleccionado==-1){utils.toast(mensajesAlertas.errorSeleccionarEquipo,"error");return}i={};i.IdRequisicion=registroDiagnostico.idSeleccionado;i.Diagnostico=$("#txtDiagnostico").val();t={};t.path=window.location.hostname;t.item=i;t.accion=registroDiagnostico.accion;t=JSON.stringify(t);$.ajax({type:"POST",url:"../pages/MantenimientoPanelDiagnostico.aspx/Guardar",data:t,contentType:"application/json; charset=utf-8",dataType:"json","async":!0,success:function(n){var t=n.d;t.CodigoError==0?(registroDiagnostico.idSeleccionado=t.IdItem,$("#txtNumeroRequisicion").val(registroDiagnostico.idSeleccionado),$(".file-documentos").each(function(){let n;(n=this.files[0])&&utils.sendFile(n,"documentos",t.IdItem,"documento")}),$("#spnMensajes").html(mensajesAlertas.exitoGuardar),$("#panelMensajes").modal("show"),registroDiagnostico.cargarItems()):utils.toast(mensajesAlertas.errorGuardar,"error")},error:function(n,t){console.log(t+": "+n.responseText);utils.toast(mensajesAlertas.errorGuardar,"error")}})}});$("#btnAceptarPanelMensajes").on("click",n=>{n.preventDefault(),$("#panelMensajes").modal("hide"),$("#panelTabla").show(),$("#panelForm").hide()});$("#btnAgregarOtroDocumento").on("click",n=>{n.preventDefault();let t=`<div class="form-group col-md-4">
                            <input type="file" class="form-control file-documentos" />
                            <div class="help-block with-errors"></div>
                            </div>`;$("#divDocumentos").append(t)});$("#btnCancelar").on("click",n=>{n.preventDefault(),$("#panelTabla").show(),$("#panelForm").hide()});$("#btnFinalizarAceptar").on("click",()=>{var n={};n.path=window.location.hostname;n.id=registroDiagnostico.idSeleccionado;n.idEquipo=registroDiagnostico.idEquipoSeleccionado;n=JSON.stringify(n);$.ajax({type:"POST",url:"../pages/MantenimientoPanelDiagnostico.aspx/FinalizarRequisicion",data:n,contentType:"application/json; charset=utf-8",dataType:"json","async":!0,success:function(n){var t=n.d;t.MensajeError===null?(utils.toast(mensajesAlertas.exitoFinalizar,"ok"),registroDiagnostico.cargarItems()):utils.toast(t.MensajeError,"error")},error:function(n,t){console.log(t+": "+n.responseText)}})});$("#btnEnviarAceptar").on("click",()=>{var n={};n.path=window.location.hostname;n.id=registroDiagnostico.idSeleccionado;n=JSON.stringify(n);$.ajax({type:"POST",url:"../pages/MantenimientoPanelDiagnostico.aspx/EnviarRequisicion",data:n,contentType:"application/json; charset=utf-8",dataType:"json","async":!0,success:function(n){var t=n.d;t.MensajeError===null?(utils.toast(mensajesAlertas.exitoEnviar,"ok"),registroDiagnostico.cargarItems()):utils.toast(t.MensajeError,"error")},error:function(n,t){console.log(t+": "+n.responseText)}})})}};window.addEventListener("load",()=>{registroDiagnostico.init(),registroDiagnostico.accionesBotones()});