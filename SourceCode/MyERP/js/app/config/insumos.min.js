function seleccionarProveedor(n){console.log("Desde la funcion seleccionarProveedor");console.log("Id "+n);var t={};t.path=window.location.hostname;t.id=n;t=JSON.stringify(t);$.ajax({type:"POST",url:"../pages/Proveedores.aspx/GetItem",data:t,contentType:"application/json; charset=utf-8",dataType:"json",async:!0,success:function(n){var t=n.d;$("#txtNombreProveedor").val(t.Nombre);$("#txtDomicilio").val(t.Domicilio);idProveedorSeleccionado=t.IdProveedor;$("#panelSeleccionarProveedor").modal("hide")},error:function(n,t){console.log(t+": "+n.responseText)}})}function seleccionarProyecto(n){console.log("Desde la funcion seleccionarProyecto");console.log("Id "+n);var t={};t.path=window.location.hostname;t.id=n;t=JSON.stringify(t);$.ajax({type:"POST",url:"../pages/Insumos.aspx/GetItemProyecto",data:t,contentType:"application/json; charset=utf-8",dataType:"json",async:!0,success:function(n){var t=n.d;idProyectoSeleccionado=t.IdProyecto;idClienteSeleccionado=t.IdCliente;$("#txtNumProyecto").val(t.IdProyecto);$("#txtFechaEntrada").val(t.FechaEntradaISO);$("#txtHoraEntrada").val(t.HoraEntrada);$("#txtNumOrden").val(t.NumeroOrden);$("#comboTipoReparacion").val(t.IdTipoReparacion);$("#comboMarca").val(t.IdMarca);$("#comboModelo").val(t.IdModelo);$("#txtColor").val(t.Color);$("#txtAnio").val(t.Anio);$("#txtKilometraje").val(t.Kilometraje);$("#txtPlacas").val(t.Placas);$("#txtDiagnostico").val(t.Diagnostico);$("#txtS01").val(t.Area);$("#comboArmador").val(t.IdArmador);$("#comboMontador").val(t.IdMontador);$("#txtSemanaAlta").val(t.NumeroSemanaAlta);$("#txtDiaAlta").val(t.NumeroDiaAlta);$("#txtValorAlta").val(t.ValorAlta);$("#comboEstatus").val(t.IdStatusProyecto);$("#txtDescripcionServicio1").val(t.DescripcionServicio1);$("#txtDescripcionServicio2").val(t.DescripcionServicio2);$("#txtDescripcionServicio3").val(t.DescripcionServicio3);$("#txtFechaProMesaEntrega").val(t.FechaPromesaEntregaISO);$("#txtHoraProMesaEntrega").val(t.HoraPromesaEntrega);$("#txtFechaPresupuesto").val(t.FechaPresupuestoISO);$("#txtValorVenta").val(t.ValorVenta);$("#txtValorCobro").val(t.ValorCobro);$("#txtValor35").val(t.Valor35);$("#txtValor35").attr("data-valor35",t.Valor35);$("#txtNombre").val(t.Nombre);$("#txtCalle_No").val(t.Calle_y_No);$("#txtColonia").val(t.Colonia);$("#txtTelefono_1").val(t.Telefono_1);$("#txtCelular").val(t.Celular);$("#txtCorreo_Electronico").val(t.Correo_Electronico);cargarItemsSolicitudes(idProyectoSeleccionado,"tablaSolicitudes",1);cargarItemsSolicitudes(idProyectoSeleccionado,"tablaAutorizados",2);cargarItemsSolicitudes(idProyectoSeleccionado,"tablaEntregados",3);cargarItemsSolicitudes(idProyectoSeleccionado,"tablaVerificados",4);cargarItemsEliminados(idProyectoSeleccionado,"tablaEliminados");cargarCostosAdicionales(idProyectoSeleccionado);cargarSumatoriaImportes(idProyectoSeleccionado);cargarItemsDestajosArmador(idProyectoSeleccionado);cargarItemsDestajosMontador(idProyectoSeleccionado);$(".money").currency();$("#panelSeleccionarProyecto").modal("hide")},error:function(n,t){console.log(t+": "+n.responseText)}})}function nuevo(){console.log("Desde nuevo");$("#frmInsumo")[0].reset();$(".form-group").removeClass("has-error");$(".help-block").empty();$("#spnTituloForm").text("Nuevo insumo");$("#txtObservaciones").val("");$("#txtDescripcion").val("");$("#panelEditarInsumo").modal("show");accion="nuevo";id=-1;idSeleccionado=-1;obtenerFechaHoraServidor()}function cargarItemsEliminados(n,t){console.log("desde  cargarItemsEliminados");var i={};i.path=window.location.hostname;i.idProyecto=n;i.idUsuario=sessionStorage.getItem("idusuario");i=JSON.stringify(i);$.ajax({type:"POST",url:"../pages/Insumos.aspx/GetListaInsumosEliminadosPorProyecto",data:i,contentType:"application/json; charset=utf-8",dataType:"json",async:!0,success:function(n){var f,i,u,r,e,o;for($("#"+t+">tbody").empty(),f=0,i="",u=0;u<n.d.length;u++)i="",r=n.d[u],i+="<tr>",i+="<td>"+r.FechaEliminacionISO+" "+r.HoraEliminacion+"<\/td> ",i+="<td>"+r.NombreTipoInsumo+"<\/td> ",i+="<td>"+r.NombreEmpleado+"<\/td> ",i+="<td>"+r.Cantidad+"<\/td> ",i+="<td>"+r.Descripcion+"<\/td> ",i+="<td>"+r.NombreProveedor1+"<\/td> ",i+='<td class="money">'+r.PrecioProveedor1+"<\/td> ",i+="<td>"+r.Observaciones1+"<\/td> ",i+="<td>"+r.NombreProveedor2+"<\/td> ",i+='<td class="money">'+r.PrecioProveedor2+"<\/td> ",i+="<td>"+r.Observaciones2+"<\/td> ",i+="<td>"+r.NombreProveedor3+"<\/td> ",i+='<td class="money">'+r.PrecioProveedor3+"<\/td> ",i+="<td>"+r.Observaciones3+"<\/td> ",i+="<td>"+r.NombreProveedorElegido+"<\/td> ",e=r.Cantidad*r.PrecioElegido,i+='<td> <span class="money">'+r.PrecioElegido+"<\/span><\/td> ",i+='<td> <span class="money">'+e+"<\/span><\/td> ",f+=parseFloat(e),i+="<\/tr>",$("#"+t+">tbody").append(i);o="";o='<td colspan="16" style="text-align:right;"><label class="label label-success form-control_">Total<\/label><\/td>';i="<tr>";i+=o;i+='<td class="money"><label class="label label-success">'+f+"<\/label><\/td>";i+="<\/tr>";$("#"+t+">tbody").append(i);$(".money").currency()},error:function(n,t){console.log(t+": "+n.responseText)}})}function cargarCostosAdicionales(n){console.log("desde  cargarCostosAdicionales");var t={};t.path=window.location.hostname;t.idProyecto=n;t=JSON.stringify(t);$.ajax({type:"POST",url:"../pages/CostosAdicionales.aspx/GetSumatoriaCostos_ItemsPorProyecto",data:t,contentType:"application/json; charset=utf-8",dataType:"json",async:!0,success:function(n){var i=n.d,r,t;$("#txtSumaCostoAdicional").val(i);r=$("#txtValor35").attr("data-valor35");t=parseFloat(i)+parseFloat(r);$("#txtValor35MasCostoAdicional").val(t);$("#txtValor35MasCostoAdicional").attr("data-valor35mascosto",t);$(".money").currency()},error:function(n,t){console.log(t+": "+n.responseText)}})}function cargarItemsSolicitudes(n,t,i){var r={};r.path=window.location.hostname;r.idProyecto=n;r.idStatus=i;r.idUsuario=sessionStorage.getItem("idusuario");r.modoInsumos=sessionStorage.getItem("modo_insumos");r=JSON.stringify(r);$.ajax({type:"POST",url:"../pages/Insumos.aspx/GetListaInsumosPorProyectoYStatus",data:r,contentType:"application/json; charset=utf-8",dataType:"json",async:!0,success:function(n){var e,r,o,u,f;for($("#"+t+">tbody").empty(),e=0,r="",o=0;o<n.d.length;o++)r="",u=n.d[o],r+="<tr class='clickable-row' >",r+="<td>"+u.FechaISO+" "+u.Hora+"<\/td> ",console.log("item.IdStatusInsumo = "+u.IdStatusInsumo),i>=2&&(r+="<td>"+u.FechaAutorizacionISO+" "+u.HoraAutorizacion+"<\/td> "),i>=3&&(r+="<td>"+u.FechaEntregaISO+" "+u.HoraEntrega+"<\/td> "),i>=4&&(r+="<td>"+u.FechaVerificacionISO+" "+u.HoraVerificacion+"<\/td> ",r+="<td>"+u.Referencia+"<\/td> "),r+="<td>"+u.NombreTipoInsumo+"<\/td> ",r+="<td>"+u.NombreEmpleado+"<\/td> ",r+="<td>"+u.Cantidad+"<\/td> ",r+="<td>"+u.Descripcion+"<\/td> ",r+="<td>"+u.NombreProveedor1+"<\/td> ",r+='<td class="money">'+u.PrecioProveedor1+"<\/td> ",r+="<td>"+u.Observaciones1+"<\/td> ",r+="<td>"+u.NombreProveedor2+"<\/td> ",r+='<td class="money">'+u.PrecioProveedor2+"<\/td> ",r+="<td>"+u.Observaciones2+"<\/td> ",r+="<td>"+u.NombreProveedor3+"<\/td> ",r+='<td class="money">'+u.PrecioProveedor3+"<\/td> ",r+="<td>"+u.Observaciones3+"<\/td> ",r+="<td>"+u.NombreProveedorElegido+"<\/td> ",importe=u.Cantidad*u.PrecioElegido,r+='<td> <span class="money">'+u.PrecioElegido+"<\/span><\/td> ",r+='<td> <span class="money">'+importe+"<\/span><\/td> ",e+=parseFloat(importe),r+="<td>"+u.Accion+"<\/td> ",r+="<\/tr>",$("#"+t+">tbody").append(r);sumatoriaTotal[i-1]=e;f="";i===1&&(f='<td colspan="16" style="text-align:right;"><label class="label label-success form-control_">Total<\/label><\/td>');i===2&&(f='<td colspan="17"style="text-align:right;"><label class="label label-success form-control_">Total<\/label><\/td>');i===3&&(f='<td colspan="18"style="text-align:right;"><label class="label label-success form-control_">Total<\/label><\/td>');i===4&&(f='<td colspan="20"style="text-align:right;"><label class="label label-success form-control_">Total<\/label><\/td>');console.log("la suma es: "+sumatoriaTotal[i-1]);r="<tr>";r+=f;r+='<td class="money"><label class="label label-success">'+e+"<\/label><\/td>";r+="<\/tr>";$("#"+t+">tbody").append(r);$(".money").currency();$(".boton-agregar-proveedor").click(function(n){n.preventDefault();console.log("agregar proveedor");idProveedorSeleccionado="-1";$("#frmProveedor")[0].reset();$("#txtObservaciones").val("");$("#txtDescripcion").val("");var t=$(this).attr("data-numproveedor"),i=$(this).attr("data-idinsumo");$("#spnNumProveedor").html("<strong>"+t+"<\/strong>");$("#spnIdInsumo").text(i);$("#panelEditarProveedor").modal("show")});$(".boton-elegir-proveedor").click(function(n){var i,t;n.preventDefault();console.log("elegir proveedor");$("#frmElegirProveedor")[0].reset();$("#txtObservaciones").val("");$("#txtDescripcion").val("");i=$(this).attr("data-idinsumo");$("#spnIdInsumoElegirProveedor").text(i);t={};t.path=window.location.hostname;t.idInsumo=i;t=JSON.stringify(t);$.ajax({type:"POST",url:"../pages/Insumos.aspx/GetProveedoresAsociadosAInsumo",data:t,contentType:"application/json; charset=utf-8",dataType:"json",async:!0,success:function(n){var u,t,i,r;for(console.log("comboProveedorElegido = "+n.d),precios=[],u=n.d,t="",t+='<option value="">Seleccione...<\/option>',precios.push(-1),i=0;i<u.length;i++)r=u[i],t+='<option value="'+r.IdProveedor+'">'+r.Nombre+"<\/option>",precios.push(r.Precio);$("#comboProveedorElegido").empty().append(t);$("#panelElegirProveedor").modal("show")},error:function(n,t){console.log(t+": "+n.responseText)}})})},error:function(n,t){console.log(t+": "+n.responseText)}})}function cargarSumatoriaImportes(n){var t={};t.path=window.location.hostname;t.idProyecto=n;t=JSON.stringify(t);$.ajax({type:"POST",url:"../pages/Insumos.aspx/GetSumatoriaImportesInsumosPorProyecto",data:t,contentType:"application/json; charset=utf-8",dataType:"json",async:!0,success:function(n){var t=n.d;$("#txtTotalInsumos").val(t);$("#txtTotalInsumos").attr("data-totalinsumos",t);console.log("sumatoria total importes = "+t);$(".money").currency()},error:function(n,t){console.log(t+": "+n.responseText)}})}function autorizarInsumo(n){console.log("Id insumo "+n);console.log("status insumo "+status);idInsumoSeleccionado=n;subtotalRenglon=0;cantidadRenglon=0;var t={};t.path=window.location.hostname;t.idInsumo=idInsumoSeleccionado;t=JSON.stringify(t);$.ajax({type:"POST",url:"../pages/Insumos.aspx/GetInsumoPorId",data:t,contentType:"application/json; charset=utf-8",dataType:"json",async:!0,success:function(n){var t=n.d;if(subtotalRenglon=t.Subtotal,cantidadRenglon=t.Cantidad,console.log("cantidad renglon = "+t.Cantidad),console.log("subtotalRenglon  = "+t.Subtotal),t.IdProveedorElegido===null||t.IdProveedorElegido===0){$("#spnMensajes").html("Error: Para apoder autorizar, primero debe elegir un proveedor.");$("#panelMensajes").modal("show");return}cantidadRenglon!==null?$("#panelAutorizar").modal("show"):console.log("no se pudo traer datos de insumo")},error:function(n,t){console.log(t+": "+n.responseText)}})}function entregarInsumo(n){var t={};t.path=window.location.hostname;t.idInsumo=n;t=JSON.stringify(t);$.ajax({type:"POST",url:"../pages/Insumos.aspx/GetInsumoPorId",data:t,contentType:"application/json; charset=utf-8",dataType:"json",async:!0,success:function(t){var i=t.d;cantidadRenglon=i.Cantidad;nombreInsumoSeleccionado=i.NombreTipoInsumo;idTipoInsumoSeleccionado=i.IdTipoSolicitud;console.log("cantidad renglon = "+i.Cantidad);idInsumoSeleccionado=n;$("#panelEntregar").modal("show")},error:function(n,t){console.log(t+": "+n.responseText)}})}function verificarInsumo(n){subtotalRenglon=0;cantidadRenglon=0;var t={};t.path=window.location.hostname;t.idInsumo=n;t=JSON.stringify(t);$.ajax({type:"POST",url:"../pages/Insumos.aspx/GetInsumoPorId",data:t,contentType:"application/json; charset=utf-8",dataType:"json",async:!0,success:function(t){insumo=t.d;subtotalRenglon=insumo.Subtotal;cantidadRenglon=insumo.Cantidad;console.log("cantidad renglon = "+insumo.Cantidad);console.log("subtotalRenglon  = "+insumo.Subtotal);idInsumoSeleccionado=n;cantidadRenglon!==null?($("#frmVerificar")[0].reset(),$("#txtCantidadRenglon").val(cantidadRenglon),$("#panelVerificar").modal("show")):console.log("no se pudo traer datos de insumo")},error:function(n,t){console.log(t+": "+n.responseText)}})}function eliminarInsumo(n){idInsumoSeleccionado=n;$("#panelEliminar").modal("show")}function rechazarInsumo(n,t){idInsumoSeleccionado=n;idStatusRechazo=t;$("#panelRechazar").modal("show")}function cargarItemsDestajosArmador(n){var t={};t.path=window.location.hostname;t.idProyecto=n;t.idUsuario=sessionStorage.getItem("idusuario");t.tipoTecnico=0;t=JSON.stringify(t);$.ajax({type:"POST",url:"../pages/DestajoTecnico.aspx/GetItemsDestajosPorProyectoArmador",data:t,contentType:"application/json; charset=utf-8",dataType:"json",async:!0,success:function(n){var u,f,r,t,i;for($("#tablaItemsDestajosArmador >tbody").empty(),u=n.d,f=u.listaItems,r=0;r<f.length;r++)t="",i=f[r],t+="<tr>",t+="<td>"+i.IdDestajoTecnicoStr+"<\/td> ",t+="<td>"+i.FechaStr+" "+i.Hora+"<\/td> ",t+="<td>"+i.Descripcion+"<\/td> ",t+="<td>"+i.TipoEmpleadoStr+"<\/td> ",t+='<td style="text-align:right;"><span class="money">'+i.Cantidad+"<\/span><\/td> ",t+="<td>"+i.NumeroSemanaStr+"<\/td> ",t+="<\/tr>",$("#tablaItemsDestajosArmador >tbody").append(t);t="<tr>";t+='<td colspan="4" style="text-align:right;"><label class="label label-success form-control_">Total<\/td> ';t+='<td style="text-align:right;"><span class="money">'+u.Totalizado+"<\/span><\/td> ";t+="<td><\/td> ";t+="<\/tr>";$("#tablaItemsDestajosArmador >tbody").append(t);$(".money").currency()},error:function(n,t){console.log(t+": "+n.responseText)}})}function cargarItemsDestajosMontador(n){var t={};t.path=window.location.hostname;t.idProyecto=n;t.idUsuario=sessionStorage.getItem("idusuario");t.tipoTecnico=0;t=JSON.stringify(t);$.ajax({type:"POST",url:"../pages/DestajoTecnico.aspx/GetItemsDestajosPorProyectoMontador",data:t,contentType:"application/json; charset=utf-8",dataType:"json",async:!0,success:function(n){var u,f,r,t,i;for($("#tablaItemsDestajosMontador >tbody").empty(),u=n.d,f=u.listaItems,r=0;r<f.length;r++)t="",i=f[r],t+="<tr>",t+="<td>"+i.IdDestajoTecnicoStr+"<\/td> ",t+="<td>"+i.FechaStr+" "+i.Hora+"<\/td> ",t+="<td>"+i.Descripcion+"<\/td> ",t+="<td>"+i.TipoEmpleadoStr+"<\/td> ",t+='<td style="text-align:right;"><span class="money">'+i.Cantidad+"<\/span><\/td> ",t+="<td>"+i.NumeroSemanaStr+"<\/td> ",t+="<\/tr>",$("#tablaItemsDestajosMontador >tbody").append(t);t="<tr>";t+='<td colspan="4" style="text-align:right;"><label class="label label-success form-control_">Total<\/td> ';t+='<td style="text-align:right;"><span class="money">'+u.Totalizado+"<\/span><\/td> ";t+="<td><\/td> ";t+="<\/tr>";$("#tablaItemsDestajosMontador >tbody").append(t);$(".money").currency()},error:function(n,t){console.log(t+": "+n.responseText)}})}var accion="",idSeleccionado=-1,idProyectoSeleccionado=-1,idProveedorSeleccionado=-1,idClienteSeleccionado=-1,idInsumoSeleccionado=-1,statusInsumoSeleccionado=-1,idStatusRechazo=-1,tablaSolicitudes,tablaClientes,tablaDestajos,tablaProveedores,date=new Date,descargas="Insumos_"+date.getFullYear()+"_"+date.getMonth()+"_"+date.getUTCDay()+"_"+date.getMilliseconds(),pagina="30",precios=[],sumatoriaTotal=[],subtotalRenglon=0,cantidadRenglon=0,nombreInsumoSeleccionado=null,idTipoInsumoSeleccionado=null,importe,insumo;$(document).ready(function(){function r(){var n={};n.path=window.location.hostname;n.idUsuario=sessionStorage.getItem("idusuario");n.modoInsumos=sessionStorage.getItem("modo_insumos");n=JSON.stringify(n);$.ajax({type:"POST",url:"../pages/Insumos.aspx/GetListaProyectos",data:n,contentType:"application/json; charset=utf-8",dataType:"json",async:!0,success:function(n){table=$("#tablaProyectos").DataTable({destroy:!0,processing:!0,order:[],data:n.d,columns:[{data:"IdProyecto"},{data:"NumeroOrden"},{data:"Placas"},{data:"Color"},{data:"NombreMarca"},{data:"NombreModelo"},{data:"Anio"},{data:"Accion"}],language:textosEsp,columnDefs:[{targets:[-1],orderable:!1}],dom:"fBrtip",buttons:[{extend:"csvHtml5",title:descargas,text:"&nbsp;Exportar Csv",className:"csvbtn"},{extend:"pdfHtml5",title:descargas,text:"Xls",className:"pdfbtn"}]})},error:function(n,t){console.log(t+": "+n.responseText)}})}function u(){var n={};n.path=window.location.hostname;n.idUsuario=sessionStorage.getItem("idusuario");n=JSON.stringify(n);$.ajax({type:"POST",url:"../pages/Insumos.aspx/GetListaItemsProveedores",data:n,contentType:"application/json; charset=utf-8",dataType:"json",async:!0,success:function(n){tablaProveedores=$("#tablaProveedores").DataTable({destroy:!0,processing:!0,order:[],data:n.d,columns:[{data:"Nombre"},{data:"Domicilio"},{data:"Telefono"},{data:"Celular"},{data:"Correo"},{data:"Accion"},],language:{sProcessing:"Procesando...",sLengthMenu:"Mostrar _MENU_ registros",sZeroRecords:"No se encontraron resultados",sEmptyTable:"Ningún dato disponible en esta tabla",sInfo:"Mostrando registros del _START_ al _END_ de un total de _TOTAL_ registros",sInfoEmpty:"Mostrando registros del 0 al 0 de un total de 0 registros",sInfoFiltered:"(filtrado de un total de _MAX_ registros)",sInfoPostFix:"",sSearch:"Buscar:",sUrl:"",sInfoThousands:",",sLoadingRecords:"Cargando...",oPaginate:{sFirst:"Primero",sLast:"Último",sNext:"Siguiente",sPrevious:"Anterior"},oAria:{sSortAscending:": Activar para ordenar la columna de manera ascendente",sSortDescending:": Activar para ordenar la columna de manera descendente"}},columnDefs:[{targets:[-1],orderable:!1},],dom:"frtiplB"})},error:function(n,t){console.log(t+": "+n.responseText)}})}function f(){var n={};n.path=window.location.hostname;n=JSON.stringify(n);$.ajax({type:"POST",url:"../pages/Insumos.aspx/GetListaTiposSolicitud",data:n,contentType:"application/json; charset=utf-8",dataType:"json",async:!0,success:function(n){var i,r,t,u;for(console.log("comboTipoInsumo = "+n.d),i=n.d,r="",t=0;t<i.length;t++)u=i[t],r+='<option value="'+u.IdTipoSolicitud+'">'+u.Nombre+"<\/option>";$("#comboTipoInsumo").empty().append(r)},error:function(n,t){console.log(t+": "+n.responseText)}})}function e(){var n={};n.path=window.location.hostname;n=JSON.stringify(n);$.ajax({type:"POST",url:"../pages/Proyectos.aspx/GetListaEstatus",data:n,contentType:"application/json; charset=utf-8",dataType:"json",async:!0,success:function(n){for(var i,r=n.d,u="",t=0;t<r.length;t++)i=r[t],u+='<option value="'+i.IdStatusProyecto+'">'+i.Nombre+"<\/option>";$("#comboEstatus").empty().append(u)},error:function(n,t){console.log(t+": "+n.responseText)}})}function o(){var n={};n.path=window.location.hostname;n=JSON.stringify(n);$.ajax({type:"POST",url:"../pages/Proyectos.aspx/GetListaMarcas",data:n,contentType:"application/json; charset=utf-8",dataType:"json",async:!0,success:function(n){for(var i,r=n.d,u="",t=0;t<r.length;t++)i=r[t],u+='<option value="'+i.Id_Marca+'">'+i.Nombre+"<\/option>";$("#comboMarca").empty().append(u)},error:function(n,t){console.log(t+": "+n.responseText)}})}function s(){var n={};n.path=window.location.hostname;n=JSON.stringify(n);$.ajax({type:"POST",url:"../pages/Proyectos.aspx/GetListaModelos",data:n,contentType:"application/json; charset=utf-8",dataType:"json",async:!0,success:function(n){for(var i,r=n.d,u="",t=0;t<r.length;t++)i=r[t],u+='<option value="'+i.Id_Modelo+'">'+i.Nombre+"<\/option>";$("#comboModelo").empty().append(u)},error:function(n,t){console.log(t+": "+n.responseText)}})}function h(){var n={};n.path=window.location.hostname;n=JSON.stringify(n);$.ajax({type:"POST",url:"../pages/Proyectos.aspx/GetListaTiposReparacion",data:n,contentType:"application/json; charset=utf-8",dataType:"json",async:!0,success:function(n){for(var i,r=n.d,u="",t=0;t<r.length;t++)i=r[t],u+='<option value="'+i.IdTipoReparacion+'">'+i.Nombre+"<\/option>";$("#comboTipoReparacion").empty().append(u)},error:function(n,t){console.log(t+": "+n.responseText)}})}function i(){var n={};n.path=window.location.hostname;n=JSON.stringify(n);$.ajax({type:"POST",url:"../pages/Proyectos.aspx/GetListaEmpleados",data:n,contentType:"application/json; charset=utf-8",dataType:"json",async:!0,success:function(n){for(var r,u=n.d,t="",i=0;i<u.length;i++)r=u[i],t+='<option value="'+r.IdEmpleado+'">'+r.Nombre+"<\/option>";$("#comboArmador").empty().append(t);$("#comboMontador").empty().append(t);$("#comboTecnico").empty().append(t)},error:function(n,t){console.log(t+": "+n.responseText)}})}var n,t;console.log("Inicializando");$("#alert-operacion-ok").hide();$("#alert-operacion-fail").hide();n=sessionStorage.getItem("modo_insumos");console.log("modo_insumos="+n);t=n==="1"?"Insumos":"Consulta de insumos";$("#spnTitulo").text(t);f();i();r();u();o();s();h();e();i();$("#btnAbrirSeleccionarProyecto").click(function(n){n.preventDefault();$("#panelSeleccionarProyecto").modal("show")});$("#btnAbrirSeleccionarProveedor").click(function(n){n.preventDefault();$("#panelSeleccionarProveedor").modal("show")});$("#comboProveedorElegido").on("change",function(){console.log("cambio , posicion "+$("#comboProveedorElegido :selected").index());console.log("cambio , precio "+precios[$("#comboProveedorElegido :selected").index()]);var n=precios[$("#comboProveedorElegido :selected").index()];n!==-1?($("#txtPrecioElegido").val(n),$("#spnPrecioElegido").text(n),$(".money").currency()):($("#txtPrecioElegido").val(""),$("#spnPrecioElegido").text(""))});$("#btnGuardarElegirProveedor").click(function(n){var i,t;console.log("Boton proveedor");n.preventDefault();i=$('form[name="frmElegirProveedor"]').validator("validate").has(".has-error").length;i||(t={},t.path=window.location.hostname,t.idInsumo=$("#spnIdInsumoElegirProveedor").text(),t.idProveedor=$("#comboProveedorElegido").val(),t.precio=$("#spnPrecioElegido").text(),t.observaciones="",t.numProveedor=4,t=JSON.stringify(t),$.ajax({type:"POST",url:"../pages/Insumos.aspx/AsignarProveedor",data:t,contentType:"application/json; charset=utf-8",dataType:"json",async:!0,success:function(n){var t=n.d;console.log("update = "+t[1]);$("#panelElegirProveedor").modal("hide");cargarItemsSolicitudes(idProyectoSeleccionado,"tablaSolicitudes",1);cargarItemsSolicitudes(idProyectoSeleccionado,"tablaAutorizados",2);cargarItemsSolicitudes(idProyectoSeleccionado,"tablaEntregados",3);cargarItemsSolicitudes(idProyectoSeleccionado,"tablaVerificados",4);cargarItemsEliminados(idProyectoSeleccionado,"tablaEliminados");cargarCostosAdicionales(idProyectoSeleccionado);cargarSumatoriaImportes(idProyectoSeleccionado);cargarItemsDestajosArmador(idProyectoSeleccionado);cargarItemsDestajosMontador(idProyectoSeleccionado)},error:function(n,t){console.log(t+": "+n.responseText)}}))});$("#btnGuardarProveedor").click(function(n){var i,t;if(console.log("Boton proveedor"),n.preventDefault(),i=$('form[name="frmProveedor"]').validator("validate").has(".has-error").length,idProveedorSeleccionado==="-1"){$("#spnMensajes").html("Debe seleccionar un proveedor ...");$("#panelMensajes").modal("show");$("#btnAbrirSeleccionarProveedor").focus();return}i||(t={},t.path=window.location.hostname,t.idInsumo=$("#spnIdInsumo").text(),t.idProveedor=idProveedorSeleccionado,t.precio=$("#txtPrecio").val(),t.observaciones=$("#txtObservaciones").val(),t.numProveedor=$("#spnNumProveedor").text(),t=JSON.stringify(t),$.ajax({type:"POST",url:"../pages/Insumos.aspx/AsignarProveedor",data:t,contentType:"application/json; charset=utf-8",dataType:"json",async:!0,success:function(n){var t=n.d;console.log("update = "+t[1]);$("#panelEditarProveedor").modal("hide");cargarItemsSolicitudes(idProyectoSeleccionado,"tablaSolicitudes",1);cargarItemsSolicitudes(idProyectoSeleccionado,"tablaAutorizados",2);cargarItemsSolicitudes(idProyectoSeleccionado,"tablaEntregados",3);cargarItemsSolicitudes(idProyectoSeleccionado,"tablaVerificados",4);cargarItemsEliminados(idProyectoSeleccionado,"tablaEliminados");cargarCostosAdicionales(idProyectoSeleccionado);cargarSumatoriaImportes(idProyectoSeleccionado);cargarItemsDestajosArmador(idProyectoSeleccionado);cargarItemsDestajosMontador(idProyectoSeleccionado)},error:function(n,t){console.log(t+": "+n.responseText)}}))});$("#btnGuardarInsumo").click(function(n){var r,t,i;if(console.log("Boton guardar insumo"),n.preventDefault(),idProyectoSeleccionado===-1){$("#spnMensajes").html("Debe seleccionar un proyecto ...");$("#panelMensajes").modal("show");$("#btnAbrirSeleccionarProyecto").focus();return}r=$('form[name="frmInsumo"]').validator("validate").has(".has-error").length;r||(console.log("idSeleccionado ="+idSeleccionado),t={},t.IdInsumo=idSeleccionado,t.IdProyecto=idProyectoSeleccionado,t.Fecha=$("#txtFecha").val(),t.Hora=$("#txtHora").val(),t.IdTipoSolicitud=$("#comboTipoInsumo").val(),t.IdEmpleado=$("#comboTecnico").val(),t.Cantidad=$("#txtCant").val(),t.Descripcion=$("#txtDescripcion").val(),t.IdStatusInsumo=1,i={},i.path=window.location.hostname,i.insumo=t,i.accion=accion,i=JSON.stringify(i),$.ajax({type:"POST",url:"../pages/Insumos.aspx/Guardar",data:i,contentType:"application/json; charset=utf-8",dataType:"json",async:!0,success:function(n){var t=n.d,r=parseInt(t[0]),i=t[1];console.log(i);$("#spnMensajes").html(i);$("#panelMensajes").modal("show");r>0?($("#lblMensajesOk").text("Registro guardado correctamente..."),$("#alert-operacion-ok").show("fast",function(){setTimeout(function(){$("#alert-operacion-ok").hide("fast")},3e3)}),$("#panelEditarInsumo").modal("hide"),cargarItemsSolicitudes(idProyectoSeleccionado,"tablaSolicitudes",1),cargarItemsSolicitudes(idProyectoSeleccionado,"tablaAutorizados",2),cargarItemsSolicitudes(idProyectoSeleccionado,"tablaEntregados",3),cargarItemsSolicitudes(idProyectoSeleccionado,"tablaVerificados",4),cargarItemsEliminados(idProyectoSeleccionado,"tablaEliminados"),cargarCostosAdicionales(idProyectoSeleccionado),cargarSumatoriaImportes(idProyectoSeleccionado),cargarItemsDestajosArmador(idProyectoSeleccionado),cargarItemsDestajosMontador(idProyectoSeleccionado)):($("#lblMensajesFail").text("No se pudo guardar el registro..."),$("#alert-operacion-fail").show("fast",function(){setTimeout(function(){$("#alert-operacion-fail").hide("fast")},3e3)}))},error:function(n,t){console.log(t+": "+n.responseText)}}))});$("#btnAutorizarAceptar").click(function(){var i=parseFloat($("#txtValor35MasCostoAdicional").attr("data-valor35mascosto")),t,n;if(console.log("monto25="+i),t=sumatoriaTotal[1]+sumatoriaTotal[2]+sumatoriaTotal[3]+subtotalRenglon,console.log(sumatoriaTotal),console.log("sumatoriaGeneral (acumulado de insumos) = "+t),t>i){$("#spnMensajes").html("El acumulado de costos  sobrepasa el 25% + costos adicionales. No se puede autorizar este insumo.");$("#panelMensajes").modal("show");return}n={};n.path=window.location.hostname;n.idInsumo=idInsumoSeleccionado;n.idStatusInsumo=2;n=JSON.stringify(n);$.ajax({type:"POST",url:"../pages/Insumos.aspx/AutorizarInsumo",data:n,contentType:"application/json; charset=utf-8",dataType:"json",async:!0,success:function(n){var t=n.d;t>0?(cargarItemsSolicitudes(idProyectoSeleccionado,"tablaSolicitudes",1),cargarItemsSolicitudes(idProyectoSeleccionado,"tablaAutorizados",2),cargarItemsSolicitudes(idProyectoSeleccionado,"tablaEntregados",3),cargarItemsSolicitudes(idProyectoSeleccionado,"tablaVerificados",4),cargarItemsEliminados(idProyectoSeleccionado,"tablaEliminados"),cargarCostosAdicionales(idProyectoSeleccionado),cargarSumatoriaImportes(idProyectoSeleccionado),cargarItemsDestajosArmador(idProyectoSeleccionado),cargarItemsDestajosMontador(idProyectoSeleccionado),$("#panelAutorizar").modal("hide"),$("#spnMensajes").html("Registro autorizado correctamente."),$("#panelMensajes").modal("show"),idProveedorSeleccionado=-1):($("#spnMensajes").html("Error: No se pudo autorizar el registro."),$("#panelMensajes").modal("show"))},error:function(n,t){console.log(t+": "+n.responseText)}})});$("#btnEntregarAceptar").click(function(){var i=parseFloat($("#txtValor35MasCostoAdicional").attr("data-valor35mascosto")),t,n;if(console.log("monto25="+i),t=sumatoriaTotal[1]+sumatoriaTotal[2]+sumatoriaTotal[3],console.log("sumatoriaGeneral= "+t),t>i){$("#spnMensajes").html("El acumulado de costos sobrepasa el 25% + costos adicionales. No se puede autorizar este insumo.");$("#panelMensajes").modal("show");return}n={};n.path=window.location.hostname;n.idTipoSolicitud=idTipoInsumoSeleccionado;n=JSON.stringify(n);$.ajax({type:"POST",url:"../pages/Insumos.aspx/GetListaTipoSolicitud",data:n,contentType:"application/json; charset=utf-8",dataType:"json",async:!0,success:function(n){var i=n.d,t;i.IdCategoria===2&&parseFloat(i.Existencia)<parseFloat(cantidadRenglon)?($("#spnMensajes").html("La cantidad <strong>"+cantidadRenglon+"<\/strong> sobrepasa a la existencia del producto/tipo de solicitud seleccionado.<br/>Tipo de insumo = <strong>"+nombreInsumoSeleccionado+"<\/strong> Existencia = <strong>"+i.Existencia+"<\/strong>"),$("#panelMensajes").modal("show")):(t={},t.path=window.location.hostname,t.idInsumo=idInsumoSeleccionado,t.idStatusInsumo=3,t=JSON.stringify(t),$.ajax({type:"POST",url:"../pages/Insumos.aspx/EntregarInsumo",data:t,contentType:"application/json; charset=utf-8",dataType:"json",async:!0,success:function(n){var t=n.d;t.mensajeError===null?(cargarItemsSolicitudes(idProyectoSeleccionado,"tablaSolicitudes",1),cargarItemsSolicitudes(idProyectoSeleccionado,"tablaAutorizados",2),cargarItemsSolicitudes(idProyectoSeleccionado,"tablaEntregados",3),cargarItemsSolicitudes(idProyectoSeleccionado,"tablaVerificados",4),cargarItemsEliminados(idProyectoSeleccionado,"tablaEliminados"),cargarCostosAdicionales(idProyectoSeleccionado),cargarSumatoriaImportes(idProyectoSeleccionado),cargarItemsDestajosArmador(idProyectoSeleccionado),cargarItemsDestajosMontador(idProyectoSeleccionado),$("#panelEntregar").modal("hide"),$("#spnMensajes").html("<br/>"+t.mensaje),$("#panelMensajes").modal("show")):($("#spnMensajes").html("Error: No se pudo terminar la operación. <br/>"+t.mensajeError),$("#panelMensajes").modal("show"))},error:function(n,t){console.log(t+": "+n.responseText)}}))},error:function(n,t){console.log(t+": "+n.responseText)}})});$("#btnVerificarAceptar").click(function(){var e=$('form[name="frmVerificar"]').validator("validate").has(".has-error").length,t,n;if(!e){t=parseFloat($("#txtValor35MasCostoAdicional").attr("data-valor35mascosto"));console.log("monto25="+t);var o=parseFloat($("#txtPrecioFinal").val()),s=parseFloat(cantidadRenglon)*o,i=sumatoriaTotal[1]+sumatoriaTotal[2]+sumatoriaTotal[3]-subtotalRenglon+s;if(console.log("sumatoriaGeneral (acumulado de costos)= "+i),i>t){$("#spnMensajes").html("La cantidad del insumo seleccionado es : <strong>"+cantidadRenglon+"<\/strong><p>El acumulado de costos de insumos (<strong>"+number_format(i,2)+"<\/strong>) sobrepasa el 25% + costos adicionales (<strong>"+number_format(t)+"<\/strong>).<\/p> No se puede autorizar este insumo.");$("#panelMensajes").modal("show");return}var r=parseFloat($("#txtPrecioFinal").val()),u=insumo.PrecioElegido+1,f=insumo.PrecioElegido-1;if(console.log("subtotal_importe_insumo: "+insumo.PrecioElegido),console.log("cantidad precio final__: "+r),console.log("cantidad precio final mas uno: "+u),console.log("cantidad precio final menos uno: "+f),r<f||r>u){$("#spnMensajes").html("Cantidad precio final sobrepasa el subtotal  + $1, ó es menor a el subtotal - $1");$("#panelMensajes").modal("show");return}n={};n.path=window.location.hostname;n.idInsumo=idInsumoSeleccionado;n.idStatusInsumo=4;n.referencia=$("#txtReferencia").val();n.precioFinal=$("#txtPrecioFinal").val();n=JSON.stringify(n);$.ajax({type:"POST",url:"../pages/Insumos.aspx/VerificarInsumo",data:n,contentType:"application/json; charset=utf-8",dataType:"json",async:!0,success:function(n){var t=n.d;t>0?(cargarItemsSolicitudes(idProyectoSeleccionado,"tablaSolicitudes",1),cargarItemsSolicitudes(idProyectoSeleccionado,"tablaAutorizados",2),cargarItemsSolicitudes(idProyectoSeleccionado,"tablaEntregados",3),cargarItemsSolicitudes(idProyectoSeleccionado,"tablaVerificados",4),cargarItemsEliminados(idProyectoSeleccionado,"tablaEliminados"),cargarCostosAdicionales(idProyectoSeleccionado),cargarSumatoriaImportes(idProyectoSeleccionado),cargarItemsDestajosArmador(idProyectoSeleccionado),cargarItemsDestajosMontador(idProyectoSeleccionado),$("#panelVerificar").modal("hide"),$("#spnMensajes").html("Operación terminada correctamente."),$("#panelMensajes").modal("show")):($("#spnMensajes").html("Error: No se pudo terminar la operación."),$("#panelMensajes").modal("show"))},error:function(n,t){console.log(t+": "+n.responseText)}})}});$("#btnEliminarAceptar").click(function(){var n={};n.path=window.location.hostname;n.id=idInsumoSeleccionado;n=JSON.stringify(n);$.ajax({type:"POST",url:"../pages/Insumos.aspx/EliminarInsumo",data:n,contentType:"application/json; charset=utf-8",dataType:"json",async:!0,success:function(n){var t=n.d;t>0?(cargarItemsSolicitudes(idProyectoSeleccionado,"tablaSolicitudes",1),cargarItemsSolicitudes(idProyectoSeleccionado,"tablaAutorizados",2),cargarItemsSolicitudes(idProyectoSeleccionado,"tablaEntregados",3),cargarItemsSolicitudes(idProyectoSeleccionado,"tablaVerificados",4),cargarItemsEliminados(idProyectoSeleccionado,"tablaEliminados"),cargarCostosAdicionales(idProyectoSeleccionado),cargarSumatoriaImportes(idProyectoSeleccionado),cargarItemsDestajosArmador(idProyectoSeleccionado),cargarItemsDestajosMontador(idProyectoSeleccionado),$("#panelEliminar").modal("hide"),$("#spnMensajes").html("Registro eliminado correctamente."),$("#panelMensajes").modal("show")):($("#spnMensajes").html("Error: No se pudo eliminar el registro."),$("#panelMensajes").modal("show"))},error:function(n,t){console.log(t+": "+n.responseText)}})});$("#btnRechazarAceptar").click(function(){var n={};n.path=window.location.hostname;n.idInsumo=idInsumoSeleccionado;n.idStatusInsumo=idStatusRechazo;n=JSON.stringify(n);$.ajax({type:"POST",url:"../pages/Insumos.aspx/RechazarInsumo",data:n,contentType:"application/json; charset=utf-8",dataType:"json",async:!0,success:function(n){var t=n.d;t>0?(cargarItemsSolicitudes(idProyectoSeleccionado,"tablaSolicitudes",1),cargarItemsSolicitudes(idProyectoSeleccionado,"tablaAutorizados",2),cargarItemsSolicitudes(idProyectoSeleccionado,"tablaEntregados",3),cargarItemsSolicitudes(idProyectoSeleccionado,"tablaVerificados",4),cargarItemsEliminados(idProyectoSeleccionado,"tablaEliminados"),cargarCostosAdicionales(idProyectoSeleccionado),cargarSumatoriaImportes(idProyectoSeleccionado),cargarItemsDestajosArmador(idProyectoSeleccionado),cargarItemsDestajosMontador(idProyectoSeleccionado),$("#panelRechazar").modal("hide"),$("#spnMensajes").html("Registro enviado a etapa anterior correctamente."),$("#panelMensajes").modal("show")):($("#spnMensajes").html("Error: No se pudo actualizar el registro."),$("#panelMensajes").modal("show"))},error:function(n,t){console.log(t+": "+n.responseText)}})})});