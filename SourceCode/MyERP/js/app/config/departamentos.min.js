"use strict";let date=new Date,descargas="Departamento_"+date.getFullYear()+"_"+date.getMonth()+"_"+date.getUTCDay()+"_"+date.getMilliseconds(),pagina="61";const departamento={init:()=>{departamento.idSeleccionado="-1",departamento.accion="",$("#panelTabla").show(),$("#panelForm").hide(),departamento.cargarItems()},cargarItems:()=>{var n={};n.path=window.location.hostname;n.idUsuario=sessionStorage.getItem("idusuario");utils.postData("../pages/Departamentos.aspx/GetListaItems",n).then(n=>{console.log(n);n=n.d;let t=$("#table").DataTable({destroy:!0,processing:!0,order:[],data:n,columns:[{data:"IdDepartamento"},{data:"Nombre"},{data:"Clave"},{data:"NombreResidente"},{data:"ActivoStr"},{data:"Accion"}],language:textosEsp,columnDefs:[{targets:[-1],orderable:!1},],dom:"frtiplB",buttons:[{extend:"excelHtml5",title:descargas,text:"Xls",className:"excelbtn"},{extend:"pdfHtml5",title:descargas,text:"Pdf",className:"pdfbtn"}]})})},eliminar:n=>{departamento.idSeleccionado=n,$("#panelEliminar").modal("show")},asignar:(n,t)=>{departamento.idSeleccionado=n;console.log("Asignar");var i={};i.path=window.location.hostname;i.idUsuario=sessionStorage.getItem("idusuario");utils.postData("../pages/Departamentos.aspx/GetListaResidentes",i).then(n=>{var i=JSON.parse(n.d),r=new $.jqx.dataAdapter(i);$("#comboResidente").jqxDropDownList({source:r,displayMember:"NombreCompleto",valueMember:"IdEmpleado",width:"350px",height:"20px",placeHolder:"Seleccione:",filterable:!0,searchMode:"containsignorecase",filterPlaceHolder:"Buscar"});$("#comboResidente").jqxDropDownList("clearSelection");t?$("#comboResidente").val(t):$("#comboResidente").val(-1);$("#panelSeleccionarResidente").modal("show")})},editar:n=>{$(".form-group").removeClass("has-error");$(".help-block").empty();var t={};t.path=window.location.hostname;t.id=n;t=JSON.stringify(t);$.ajax({type:"POST",url:"../pages/Departamentos.aspx/GetItem",data:t,contentType:"application/json; charset=utf-8",dataType:"json",async:!0,success:function(n){var t=n.d;departamento.idSeleccionado=t.IdDepartamento;console.log(".");$("#txtNombre").val(t.Nombre);$("#txtClave").val(t.Clave);$("#chkActivo").prop("checked",t.Activo===1);$("#panelTabla").hide();$("#panelForm").show();departamento.accion="editar";$("#spnTituloForm").text("Editar");$(".deshabilitable").prop("disabled",!1)},error:function(n,t){console.log(t+": "+n.responseText)}})},nuevo:()=>{$("#frm")[0].reset(),$(".form-group").removeClass("has-error"),$(".help-block").empty(),$("#spnTituloForm").text("Nuevo"),$("#txtDescripcion").val(""),$("#panelTabla").hide(),$("#panelForm").show(),departamento.accion="nuevo",departamento.idSeleccionado="-1",$(".deshabilitable").prop("disabled",!1),obtenerFechaHoraServidor("txtFechaCreacion")},accionesBotones:()=>{$("#btnNuevo").on("click",n=>{n.preventDefault(),departamento.nuevo()});$("#btnGuardar").on("click",n=>{var r,i,t;(n.preventDefault(),r=$('form[name="frm"]').validator("validate").has(".has-error").length,r)||(i={},i.IdDepartamento=departamento.idSeleccionado,i.Activo=$("#chkActivo").prop("checked")==!0?1:0,i.Nombre=$("#txtNombre").val(),i.Clave=$("#txtClave").val(),t={},t.path=window.location.hostname,t.item=i,t.accion=departamento.accion,t=JSON.stringify(t),$.ajax({type:"POST",url:"../pages/Departamentos.aspx/Guardar",data:t,contentType:"application/json; charset=utf-8",dataType:"json",async:!0,success:function(n){var t=n.d;t.CodigoError==0?(utils.toast(mensajesAlertas.exitoGuardar,"ok"),$("#panelTabla").show(),$("#panelForm").hide(),departamento.cargarItems()):utils.toast(mensajesAlertas.errorGuardar,"error")},error:function(){utils.toast(mensajesAlertas.errorGuardar,"error")}}))});$("#btnCancelar").on("click",n=>{n.preventDefault(),$("#panelTabla").show(),$("#panelForm").hide()});$("#btnAceptarSeleccionResidente").on("click",()=>{var n={};n.path=window.location.hostname;n.idObra=departamento.idSeleccionado;n.idResidente=$("#comboResidente").val();n=JSON.stringify(n);$.ajax({type:"POST",url:"../pages/Departamentos.aspx/UpdateResidente",data:n,contentType:"application/json; charset=utf-8",dataType:"json",async:!0,success:function(n){var t=n.d;t.MensajeError===null?(utils.toast(mensajesAlertas.exitoGuardar,"ok"),departamento.cargarItems()):utils.toast(t.MensajeError,"error")},error:function(n,t){console.log(t+": "+n.responseText)}})});$("#btnEliminarAceptar").on("click",()=>{var n={};n.path=window.location.hostname;n.id=departamento.idSeleccionado;n=JSON.stringify(n);$.ajax({type:"POST",url:"../pages/Departamentos.aspx/Eliminar",data:n,contentType:"application/json; charset=utf-8",dataType:"json",async:!0,success:function(n){var t=n.d;t.MensajeError===null?(utils.toast(mensajesAlertas.exitoEliminar,"ok"),departamento.cargarItems()):utils.toast(t.MensajeError,"error")},error:function(n,t){console.log(t+": "+n.responseText)}})})}};window.addEventListener("load",()=>{departamento.init(),departamento.accionesBotones()});