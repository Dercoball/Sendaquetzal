"use strict";let date=new Date,descargas="OrdenTrabajo_"+date.getFullYear()+"_"+date.getMonth()+"_"+date.getUTCDay()+"_"+date.getMilliseconds(),pagina="53";class RegistroFalla{constructor(n){this.IdRegistroFalla=n;this.IdEqúipo=null;this.FechaCreacion=null;this.Descripcion="";this.Orometro="";this.DetieneOperacion=!1}}const registroFallas={init:()=>{$("#alert-operacion-ok").hide(),$("#alert-operacion-fail").hide(),$("#panelTabla").show(),$("#panelForm").hide(),$("#panelTablaCerrados").hide(),registroFallas.idProveedorSeleccionado=-1,registroFallas.idEquipoSeleccionado=-1,registroFallas.idSeleccionado=-1,registroFallas.accion="",registroFallas.cargarItems(),registroFallas.cargarComboMarcas(),registroFallas.cargarComboEstatus(),registroFallas.cargarEmpleados()},cargarItems:()=>{var n={};n.path=window.location.hostname;n.idUsuario=sessionStorage.getItem("idusuario");utils.postData("../pages/PanelRegistroFallas.aspx/GetListaItems",n).then(n=>{console.log(n);n=n.d;let t=$("#table").DataTable({destroy:!0,processing:!0,order:[],data:n,columns:[{data:"IdRequisicion"},{data:"NumeroEconomico"},{data:"NombreEquipo"},{data:"FechaCreacionFormateada"},{data:"NombrePrioridad"},{data:"NombreStatus"},{data:"Accion"}],language:textosEsp,columnDefs:[{targets:[-1],orderable:!1},],dom:"fBrtip",buttons:[{extend:"csvHtml5",title:descargas,text:"&nbsp;Exportar Csv",className:"csvbtn"},{extend:"excelHtml5",title:descargas,text:"Xls",className:"excelbtn"},{extend:"pdfHtml5",title:descargas,text:"Pdf",className:"pdfbtn"}]})})},cargarItemsEquipos:()=>{var n={};n.path=window.location.hostname;n.idUsuario=sessionStorage.getItem("idusuario");n=JSON.stringify(n);$.ajax({type:"POST",url:"../pages/PanelRegistroFallas.aspx/GetListaEquiposSinRequisicion",data:n,contentType:"application/json; charset=utf-8",dataType:"json",async:!0,success:function(n){function t(n,t){var i={};i.path=window.location.hostname;i.idMarca=n;i=JSON.stringify(i);$.ajax({type:"POST",url:"../pages/PanelRegistroFallas.aspx/GetListaModelos",data:i,contentType:"application/json; charset=utf-8",dataType:"json",async:!0,success:function(n){var f=n.d,r="",i,u;for(r+='<option value=""><\/option>',i=0;i<f.length;i++)u=f[i],r+='<option value="'+u.Id_Modelo+'">'+u.Nombre+"<\/option>";$("#comboModelo").empty().append(r);t!==0&&$("#comboModelo").val(t)},error:function(n,t){console.log(t+": "+n.responseText)}})}let i=$("#tablaEquipos").DataTable({pageLength:5,destroy:!0,processing:!0,order:[],data:n.d,columns:[{data:"NumeroEconomico"},{data:"Nombre"},{data:"NombreMarca"},{data:"Accion"}],language:textosEsp,columnDefs:[{targets:[-1],orderable:!1},],dom:"frtipl"});$("#tablaEquipos").on("draw.dt",function(){$(".boton-seleccionar-equipo").on("click",function(n){n.preventDefault();registroFallas.idEquipoSeleccionado=$(this).attr("data-idequipo");$("#txtNombreEquipo").val(registroFallas.idEquipoSeleccionado);var i={};i.path=window.location.hostname;i.id=registroFallas.idEquipoSeleccionado;i=JSON.stringify(i);$.ajax({type:"POST",url:"../pages/Proyectos.aspx/GetItemEquipo",data:i,contentType:"application/json; charset=utf-8",dataType:"json",async:!0,success:function(n){var i=n.d;registroFallas.idEquipoSeleccionado=i.IdEquipo;$("#txtNombreEquipo").val(i.Nombre);$("#txtNumeroEconomico").val(i.NumeroEconomico);$("#txtNombreEquipo").val(i.Nombre);$("#comboMarca").val(i.IdMarca);t(i.IdMarca,i.IdModelo);$("#panelSeleccionarEquipo").modal("hide")},error:function(n,t){console.log(t+": "+n.responseText)}})})});$("#tablaEquipos").trigger("draw.dt")},error:function(n,t){console.log(t+": "+n.responseText)}})},cargarComboMarcas:()=>{var n={};n.path=window.location.hostname;n=JSON.stringify(n);$.ajax({type:"POST",url:"../pages/Proyectos.aspx/GetListaMarcas",data:n,contentType:"application/json; charset=utf-8",dataType:"json",async:!0,success:function(n){var u=n.d,i="",t,r;for(i+='<option value=""><\/option>',t=0;t<u.length;t++)r=u[t],i+='<option value="'+r.Id_Marca+'">'+r.Nombre+"<\/option>";$("#comboMarca").empty().append(i)},error:function(n,t){console.log(t+": "+n.responseText)}})},cargarComboEstatus:()=>{var n={};n.path=window.location.hostname;n=JSON.stringify(n);$.ajax({type:"POST",url:"../pages/Proyectos.aspx/GetListaEstatus",data:n,contentType:"application/json; charset=utf-8",dataType:"json",async:!0,success:function(n){for(var i,r=n.d,u="",t=0;t<r.length;t++)i=r[t],u+='<option value="'+i.IdStatusProyecto+'">'+i.Nombre+"<\/option>";$("#comboEstatus").empty().append(u)},error:function(n,t){console.log(t+": "+n.responseText)}})},cargarComboModelos:(n,t)=>{var i={};i.path=window.location.hostname;i.idMarca=n;i=JSON.stringify(i);$.ajax({type:"POST",url:"../pages/Proyectos.aspx/GetListaModelos",data:i,contentType:"application/json; charset=utf-8",dataType:"json",async:!0,success:function(n){var f=n.d,r="",i,u;for(r+='<option value=""><\/option>',i=0;i<f.length;i++)u=f[i],r+='<option value="'+u.Id_Modelo+'">'+u.Nombre+"<\/option>";$("#comboModelo").empty().append(r);t!==0&&$("#comboModelo").val(t)},error:function(n,t){console.log(t+": "+n.responseText)}})},cargarEmpleados:()=>{var n={};n.path=window.location.hostname;n.idUsuario=sessionStorage.getItem("idusuario");n.like="";n=JSON.stringify(n);$.ajax({type:"POST",url:"../pages/PanelRegistroFallas.aspx/GetListaEmpleados",data:n,contentType:"application/json; charset=utf-8",dataType:"json",async:!0,success:function(n){var t=JSON.parse(n.d),i=new $.jqx.dataAdapter(t);$("#comboEmpleado").jqxDropDownList({source:i,displayMember:"Nombre",valueMember:"IdEmpleado",width:"350px",height:"20px",placeHolder:"Seleccione:",filterable:!0,searchMode:"containsignorecase",filterPlaceHolder:"Buscar"});$("#comboEmpleado").jqxDropDownList("clearSelection")},error:function(n,t){console.log(t+": "+n.responseText)}})},eliminar:n=>{registroFallas.idSeleccionado=n,$("#panelEliminar").modal("show")},cargarComboModelos_:(n,t)=>{var i={};i.path=window.location.hostname;i.idMarca=n;i=JSON.stringify(i);$.ajax({type:"POST",url:"../pages/Proyectos.aspx/GetListaModelos",data:i,contentType:"application/json; charset=utf-8",dataType:"json",async:!0,success:function(n){var f=n.d,r="",i,u;for(r+='<option value=""><\/option>',i=0;i<f.length;i++)u=f[i],r+='<option value="'+u.Id_Modelo+'">'+u.Nombre+"<\/option>";$("#comboModelo").empty().append(r);t!==0&&$("#comboModelo").val(t)},error:function(n,t){console.log(t+": "+n.responseText)}})},editar:n=>{$(".form-group").removeClass("has-error");$(".help-block").empty();$("#divDocumentos").empty();var t={};t.path=window.location.hostname;t.id=n;t=JSON.stringify(t);$.ajax({type:"POST",url:"../pages/PanelRegistroFallas.aspx/GetItem",data:t,contentType:"application/json; charset=utf-8",dataType:"json",async:!0,success:function(n){var t=n.d;registroFallas.idSeleccionado=t.IdRequisicion;registroFallas.idEquipoSeleccionado=t.IdEquipo;console.log(".");$("#txtNumeroRequisicion").val(t.IdRequisicion);$("#txtNombreEquipo").val(t.NombreEquipo);$("#txtNombreProveedor").val(t.NombreProveedor);$("#txtFechaCreacion").val(t.FechaCreacionFormateadaMx);$("#txtFechaCreacion").prop("fecha",t.FechaCreacionCanonical);$("#txtOrometro").val(t.Orometro);$("#chkDetieneOperacion").prop("checked",t.DetieneOperacion==1);$("#txtDescripcion").val(t.Descripcion);$("#txtNumeroEconomico").val(t.NumeroEconomico);$("#txtCoordenadas").val(t.Latitud+", "+t.Longitud);$("#comboMarca").val(t.IdMarca);$("#comboPrioridad").val(t.IdNivelPrioridad);registroFallas.cargarComboModelos_($("#comboMarca").val(),t.IdModelo);$("#comboEmpleado").jqxDropDownList("clearSelection");$("#comboEmpleado").jqxDropDownList({disabled:!0});$("#comboEmpleado").val(t.IdUsuarioDiagnostico);registroFallas.accion="editar";$("#spnTituloForm").text("Editar");$(".deshabilitable").prop("disabled",!1);let i={path:window.location.hostname,id_requisicion:t.IdRequisicion,idUsuario:sessionStorage.getItem("idusuario"),id_tipo:1};utils.getDocumentos(i)},error:function(n,t){console.log(t+": "+n.responseText)}})},enviar:n=>{registroFallas.idSeleccionado=n,$("#msgEnviar").html("<p>Se enviará a la siguiente etapa el registro seleccionado(No."+n+"). ¿Desea continuar?<\/p>"),$("#panelEnviar").modal("show")},abrir:n=>{$(".form-group").removeClass("has-error");$(".help-block").empty();var t={};t.path=window.location.hostname;t.id=n;t=JSON.stringify(t);$.ajax({type:"POST",url:"../pages/PanelRegistroFallas.aspx/GetItem",data:t,contentType:"application/json; charset=utf-8",dataType:"json",async:!0,success:function(n){var t=n.d;registroFallas.idSeleccionado=t.IdRequisicion;registroFallas.idEquipoSeleccionado=t.IdEquipo;registroFallas.idProveedorSeleccionado=t.IdProveedor;console.log(".");$("#txtNumeroRequisicion").val(t.IdRequisicion);$("#txtNombreEquipo").val(t.NombreEquipo);$("#txtNombreProveedor").val(t.NombreProveedor);$("#txtFechaCreacion").val(t.FechaCreacionFormateada);$("#txtDescripcion").val(t.Descripcion);$("#txtNumeroEconomico").val(t.NumeroEconomico);$("#txtCoordenadas").val(t.Latitud+", "+t.Longitud);$("#comboMarca").val(t.IdMarca);$("#comboPrioridad").val(t.IdNivelPrioridad);cargarComboModelos_($("#comboMarca").val(),t.IdModelo);registroFallas.accion="editar";$("#spnTituloForm").text("Datos orden de trabajo");$(".deshabilitable").prop("disabled",!0);let i={path:window.location.hostname,id_requisicion:t.IdRequisicion,idUsuario:sessionStorage.getItem("idusuario"),id_tipo:1};utils.getDocumentos(i);$("#panelTabla").hide();$("#panelForm").show()},error:function(n,t){console.log(t+": "+n.responseText)}})},nuevo:()=>{$("#frm")[0].reset(),$(".form-group").removeClass("has-error"),$(".help-block").empty(),$("#txtDescripcion").val(""),$("#panelTabla").hide(),$("#panelForm").show(),registroFallas.accion="nuevo",registroFallas.idSeleccionado=-1,registroFallas.idEquipoSeleccionado=-1,$(".deshabilitable").prop("disabled",!1),$("#comboEmpleado").jqxDropDownList({disabled:!1}),obtenerFechaHoraServidor("txtFechaCreacion"),$("#comboEmpleado").jqxDropDownList("clearSelection"),$("#divDocumentosExistentes").empty()},accionesBotones:()=>{$("#btnAbrirSeleccionarEquipo").on("click",n=>{n.preventDefault(),registroFallas.cargarItemsEquipos(),$("#panelSeleccionarEquipo").modal("show")});$("#btnNuevo").on("click",n=>{n.preventDefault(),registroFallas.nuevo()});$("#btnGuardar").on("click",n=>{var r,t,i;if(n.preventDefault(),r=$('form[name="frm"]').validator("validate").has(".has-error").length,!r){if(registroFallas.idEquipoSeleccionado==-1){utils.toast(mensajesAlertas.errorSeleccionarEquipo,"error");return}if($("#comboEmpleado").val()==null||$("#comboEmpleado").val()===""){utils.toast(mensajesAlertas.errorSeleccionarUsuarioDiagnostico,"error");return}t={};t.IdRequisicion=registroFallas.idSeleccionado;t.FechaCreacion=$("#txtFechaCreacion").prop("fecha");t.IdEquipo=registroFallas.idEquipoSeleccionado;t.Descripcion=$("#txtDescripcion").val();t.Orometro=$("#txtOrometro").val();t.IdNivelPrioridad=$("#comboPrioridad").val();t.DetieneOperacion=$("#chkDetieneOperacion").prop("checked")==!0?1:0;t.IdUsuarioDiagnostico=$("#comboEmpleado").val()===null?"-1":$("#comboEmpleado").val();i={};i.path=window.location.hostname;i.item=t;i.accion=registroFallas.accion;i=JSON.stringify(i);$.ajax({type:"POST",url:"../pages/PanelRegistroFallas.aspx/Guardar",data:i,contentType:"application/json; charset=utf-8",dataType:"json",async:!0,success:function(n){var t=n.d;t.CodigoError==0?(registroFallas.idSeleccionado=t.IdItem,$("#txtNumeroRequisicion").val(registroFallas.idSeleccionado),$(".file-documentos").each(function(){let n;(n=this.files[0])&&utils.sendFile(n,"documentos",t.IdItem)}),$("#spnMensajes").html(mensajesAlertas.exitoGuardar),$("#panelMensajes").modal("show"),registroFallas.cargarItems()):utils.toast(mensajesAlertas.errorGuardar,"error")},error:function(n,t){console.log(t+": "+n.responseText);utils.toast(mensajesAlertas.errorGuardar,"error")}})}});$("#btnAceptarPanelMensajes").on("click",n=>{n.preventDefault(),$("#panelMensajes").modal("hide"),$("#panelTabla").show(),$("#panelForm").hide()});$("#btnAgregarOtroDocumento").on("click",n=>{n.preventDefault();let t='<div class="form-group col-md-4">';t+='<input type="file" class="form-control file-documentos" />';t+='<div class="help-block with-errors"><\/div>';t+="<\/div>";$("#divDocumentos").append(t)});$("#btnCancelar").on("click",n=>{n.preventDefault(),$("#panelTabla").show(),$("#panelForm").hide()});$("#btnEliminarAceptar").on("click",()=>{var n={};n.path=window.location.hostname;n.id=registroFallas.idSeleccionado;n=JSON.stringify(n);$.ajax({type:"POST",url:"../pages/PanelRegistroFallas.aspx/EliminarRequisicion",data:n,contentType:"application/json; charset=utf-8",dataType:"json",async:!0,success:function(n){var t=n.d;t.MensajeError===null?(utils.toast(mensajesAlertas.exitoEliminar,"ok"),registroFallas.cargarItems()):utils.toast(t.MensajeError,"error")},error:function(n,t){console.log(t+": "+n.responseText)}})});$("#btnEnviarAceptar").on("click",n=>{n.preventDefault();var t={};t.path=window.location.hostname;t.id=registroFallas.idSeleccionado;t=JSON.stringify(t);$.ajax({type:"POST",url:"../pages/PanelRegistroFallas.aspx/EnviarRequisicion",data:t,contentType:"application/json; charset=utf-8",dataType:"json",async:!0,success:function(n){var t=n.d;t.MensajeError===null?(utils.toast(mensajesAlertas.exitoEnviar,"ok"),registroFallas.cargarItems()):utils.toast(t.MensajeError,"error")},error:function(n,t){console.log(t+": "+n.responseText)}})})}};window.addEventListener("load",()=>{registroFallas.init(),registroFallas.accionesBotones()});