"use strict";let date=new Date,descargas="TiposUsuario_"+date.getFullYear()+"_"+date.getMonth()+"_"+date.getUTCDay()+"_"+date.getMilliseconds(),pagina="10",idEquipoSeleccionado=-1;const tiposUsuario={init:()=>{$("#panelTabla").show(),$("#panelForm").hide(),tiposUsuario.idSeleccionado=-1,tiposUsuario.accion="",tiposUsuario.cargarItems()},cargarItems:()=>{var n={};n.path="connbd";n.idUsuario=document.getElementById("txtIdUsuario").value;utils.postData("../../pages/Config/Positions.aspx/GetListaItems",n).then(n=>{console.log(n);n=n.d;let t=$("#table").DataTable({destroy:!0,processing:!0,order:[],data:n,columns:[{data:"IdPosicion"},{data:"Nombre"},{data:"ActivoStr"},{data:"Accion"}],language:textosEsp,columnDefs:[{targets:[-1],orderable:!1},],dom:"frtiplB",buttons:[{extend:"excelHtml5",title:descargas,text:"Xls",className:"excelbtn"},{extend:"pdfHtml5",title:descargas,text:"Pdf",className:"pdfbtn"}]})})},eliminar:n=>{tiposUsuario.idSeleccionado=n,$("#panelEliminar").modal("show")},editar:n=>{$(".form-group").removeClass("has-error");$(".help-block").empty();var t={};t.path="connbd";t.id=n;t=JSON.stringify(t);$.ajax({type:"POST",url:"../../pages/Config/Positions.aspx/GetItem",data:t,contentType:"application/json; charset=utf-8",dataType:"json","async":!0,success:function(n){var t=n.d;tiposUsuario.idSeleccionado=t.IdTipoUsuario;console.log(".");$("#txtNombre").val(t.Nombre);$("#chkActivo").prop("checked",t.Activo===1);$("#panelTabla").hide();$("#panelForm").show();tiposUsuario.accion="editar";$("#spnTituloForm").text("Editar");$(".deshabilitable").prop("disabled",!1)},error:function(n,t){console.log(t+": "+n.responseText)}})},nuevo:()=>{$("#frm")[0].reset(),$(".form-group").removeClass("has-error"),$(".help-block").empty(),$("#spnTituloForm").text("Nuevo"),$("#txtDescripcion").val(""),$("#panelTabla").hide(),$("#panelForm").show(),tiposUsuario.accion="nuevo",tiposUsuario.idSeleccionado=-1,idEquipoSeleccionado=-1,$(".deshabilitable").prop("disabled",!1)},permisos:(n,t)=>{tiposUsuario.idSeleccionado=n,$(".spnNombreTipoUsuario").text(t),tiposUsuario.cargarListaPermisos(n),tiposUsuario.cargarListaPermisosUsuario(n),$("#panelPermisos").modal("show")},cargarListaPermisos:n=>{var t={};t.path="connbd";t.idTipoUsuario=n;t=JSON.stringify(t);$.ajax({type:"POST",url:"../../pages/Config/Positions.aspx/ObtenerListaPermisos",data:t,contentType:"application/json; charset=utf-8",dataType:"json","async":!0,success:function(n){for(var i,r=n.d,u="",t=0;t<r.length;t++)i=r[t],u+='<option value="'+i.IdPermiso+'">'+i.Nombre+"<\/option>";$("#listaPermisos").empty().append(u)},error:function(n,t){console.log(t+": "+n.responseText)}})},cargarListaPermisosUsuario:n=>{var t={};t.path="connbd";t.idTipoUsuario=n;t=JSON.stringify(t);$.ajax({type:"POST",url:"../../pages/Config/Positions.aspx/ObtenerListaPermisosPorTipoUsuario",data:t,contentType:"application/json; charset=utf-8",dataType:"json","async":!0,success:function(n){for(var i,r=n.d,u="",t=0;t<r.length;t++)i=r[t],u+='<option value="'+i.IdPermiso+'">'+i.Nombre+"<\/option>";$("#listaPermisosSeleccionados").empty().append(u)},error:function(n,t){console.log(t+": "+n.responseText)}})},accionesBotones:()=>{$("#listaPermisos").on("change",n=>{n.preventDefault();let t=n.currentTarget.selectedOptions;if(t[0].value){let n=t[0].value,i=t[0].text,r='<option value="'+n+'">'+i+"<\/option>";$("#listaPermisosSeleccionados").append(r);$("#listaPermisos option[value='"+n+"']").remove()}});$("#listaPermisosSeleccionados").on("change",n=>{n.preventDefault();let t=n.currentTarget.selectedOptions;if(t[0].value){let n=t[0].value,i=t[0].text,r='<option value="'+n+'">'+i+"<\/option>";$("#listaPermisos").append(r);$("#listaPermisosSeleccionados option[value='"+n+"']").remove()}});$("#btnGuardarPermisos").on("click",n=>{var i,t;console.log("Boton guardarP");n.preventDefault();i=[];$("#listaPermisosSeleccionados option").each(function(){var n={};n.IdPermiso=$(this).val();n.IdTipoUsuario=tiposUsuario.idSeleccionado;i.push(n)});t={};t.path="connbd";t.listaPermisos=i;t.idTipoUsuario=tiposUsuario.idSeleccionado;t=JSON.stringify(t);$.ajax({type:"POST",url:"Positions.aspx/GuardarPermisosUsuario",data:t,contentType:"application/json; charset=utf-8",dataType:"json","async":!0,success:function(n){var t=parseInt(n.d);t>0?utils.toast(mensajesAlertas.exitoGuardar,"ok"):utils.toast(mensajesAlertas.errorGuardar,"ok");$("#listaPermisosSeleccionados").empty();$("#panelPermisos").modal("hide")},error:function(n,t){console.log(t+": "+n.responseText)}})});$("#btnNuevo").on("click",n=>{n.preventDefault(),tiposUsuario.nuevo()});$("#btnGuardar").on("click",n=>{var r,i,t;(n.preventDefault(),r=$('form[name="frm"]').validator("validate").has(".has-error").length,r)||(i={},i.IdTipoUsuario=tiposUsuario.idSeleccionado,i.Activo=$("#chkActivo").prop("checked")==!0?1:0,i.NOmbre=$("#txtNombre").val(),t={},t.path="connbd",t.item=i,t.accion=tiposUsuario.accion,t=JSON.stringify(t),$.ajax({type:"POST",url:"../../pages/Config/Positions.aspx/Guardar",data:t,contentType:"application/json; charset=utf-8",dataType:"json","async":!0,success:function(n){var t=n.d;t.CodigoError==0?(utils.toast(mensajesAlertas.exitoGuardar,"ok"),$("#panelTabla").show(),$("#panelForm").hide(),tiposUsuario.cargarItems()):utils.toast(mensajesAlertas.errorGuardar,"error")},error:function(){utils.toast(mensajesAlertas.errorGuardar,"error")}}))});$("#btnCancelar").on("click",n=>{n.preventDefault(),$("#panelTabla").show(),$("#panelForm").hide()});$("#btnEliminarAceptar").on("click",()=>{var n={};n.path="connbd";n.id=tiposUsuario.idSeleccionado;n=JSON.stringify(n);$.ajax({type:"POST",url:"../../pages/Config/Positions.aspx/EliminarTipoUsuario",data:n,contentType:"application/json; charset=utf-8",dataType:"json","async":!0,success:function(n){var t=n.d;t.MensajeError===null?(utils.toast(mensajesAlertas.exitoEliminar,"ok"),tiposUsuario.cargarItems()):utils.toast(t.MensajeError,"error")},error:function(n,t){console.log(t+": "+n.responseText)}})})}};window.addEventListener("load",()=>{tiposUsuario.init(),tiposUsuario.accionesBotones()});