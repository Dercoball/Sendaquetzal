function eliminar(n){idSeleccionado=n;$("#panelEliminar").modal("show")}function cargarComboModelos_(n,t){var i={};i.path=window.location.hostname;i.idMarca=n;i=JSON.stringify(i);$.ajax({type:"POST",url:"../pages/Proyectos.aspx/GetListaModelos",data:i,contentType:"application/json; charset=utf-8",dataType:"json",async:!0,success:function(n){var f=n.d,r="",i,u;for(r+='<option value=""><\/option>',i=0;i<f.length;i++)u=f[i],r+='<option value="'+u.Id_Modelo+'">'+u.Nombre+"<\/option>";$("#comboModelo").empty().append(r);t!==0&&$("#comboModelo").val(t)},error:function(n,t){console.log(t+": "+n.responseText)}})}function abrir(n){$(".form-group").removeClass("has-error");$(".help-block").empty();$("#frm")[0].reset();$("#divDocumentos").empty();var t={};t.path=window.location.hostname;t.id=n;t=JSON.stringify(t);$.ajax({type:"POST",url:"../pages/PanelRequisiciones.aspx/GetItem",data:t,contentType:"application/json; charset=utf-8",dataType:"json",async:!0,success:function(n){var t=n.d;idSeleccionado=t.IdRequisicion;idEquipoSeleccionado=t.IdEquipo;idProveedorSeleccionado=t.IdProveedor;console.log(".");$("#txtNumeroRequisicion").val(t.IdRequisicion);$("#txtNombreEquipo").val(t.NombreEquipo);$("#txtNombreProveedor").val(t.NombreProveedor);$("#txtDiagnostico").val(t.Diagnostico);$("#txtFechaCreacion").val(t.FechaCreacionFormateada);$("#txtDescripcion").val(t.Descripcion);$("#txtNumeroEconomico").val(t.NumeroEconomico);$("#txtCoordenadas").val(t.Latitud+", "+t.Longitud);$("#comboMarca").val(t.IdMarca);cargarComboModelos_($("#comboMarca").val(),t.IdModelo);$("#txtOrometro").val(t.Orometro);$("#chkDetieneOperacion").prop("checked",t.DetieneOperacion==1);accion="editar";$("#spnTituloForm").text("Datos requisición");$(".deshabilitable").prop("disabled",!0);let i={path:window.location.hostname,id_requisicion:t.IdRequisicion,idUsuario:sessionStorage.getItem("idusuario"),id_tipo:1};utils.getDocumentos(i);$("#panelTabla").hide();$("#panelForm").show()},error:function(n,t){console.log(t+": "+n.responseText)}})}function nuevo(){$("#frm")[0].reset();$(".form-group").removeClass("has-error");$(".help-block").empty();$("#spnTituloForm").text("Nueva requisición");$("#txtDescripcion").val("");$("#panelTabla").hide();$("#panelForm").show();accion="nuevo";id=-1;idSeleccionado=-1;idEquipoSeleccionado=-1;idProveedorSeleccionado=-1;$(".deshabilitable").prop("disabled",!1);obtenerFechaHoraServidor("txtFechaCreacion")}let date=new Date,descargas="Requisiciones_"+date.getFullYear()+"_"+date.getMonth()+"_"+date.getUTCDay()+"_"+date.getMilliseconds(),pagina="57",idProveedorSeleccionado=-1,idEquipoSeleccionado=-1;$(document).ready(function(){function t(){var n={};n.path=window.location.hostname;n=JSON.stringify(n);$.ajax({type:"POST",url:"../pages/PanelRequisiciones.aspx/GetListaMarcas",data:n,contentType:"application/json; charset=utf-8",dataType:"json",async:!0,success:function(n){var u=n.d,i="",t,r;for(i+='<option value=""><\/option>',t=0;t<u.length;t++)r=u[t],i+='<option value="'+r.Id_Marca+'">'+r.Nombre+"<\/option>";$("#comboMarca").empty().append(i)},error:function(n,t){console.log(t+": "+n.responseText)}})}function n(){var n={};n.path=window.location.hostname;n.idUsuario=sessionStorage.getItem("idusuario");n=JSON.stringify(n);$.ajax({type:"POST",url:"../pages/PanelRequisiciones.aspx/GetListaItems",data:n,contentType:"application/json; charset=utf-8",dataType:"json",async:!0,success:function(n){console.log("");let t=$("#table").DataTable({destroy:!0,processing:!0,order:[],data:n.d,columns:[{data:"IdRequisicion"},{data:"NumeroEconomico"},{data:"NombreEquipo"},{data:"NombreProveedor"},{data:"FechaCreacionFormateada"},{data:"NombrePrioridad"},{data:"NombreStatus"},{data:"Accion"}],language:textosEsp,columnDefs:[{targets:[-1],orderable:!1},],dom:"frtiplB",buttons:[{extend:"excelHtml5",title:descargas,text:"Xls",className:"excelbtn"},{extend:"pdfHtml5",title:descargas,text:"Pdf",className:"pdfbtn"}]})},error:function(n,t){console.log(t+": "+n.responseText)}})}function i(){var n={};n.path=window.location.hostname;n.idUsuario=sessionStorage.getItem("idusuario");n=JSON.stringify(n);$.ajax({type:"POST",url:"../pages/PanelRequisiciones.aspx/GetListaEquiposSinRequisicion",data:n,contentType:"application/json; charset=utf-8",dataType:"json",async:!0,success:function(n){function t(n,t){var i={};i.path=window.location.hostname;i.idMarca=n;i=JSON.stringify(i);$.ajax({type:"POST",url:"../pages/PanelRequisiciones.aspx/GetListaModelos",data:i,contentType:"application/json; charset=utf-8",dataType:"json",async:!0,success:function(n){var f=n.d,r="",i,u;for(r+='<option value=""><\/option>',i=0;i<f.length;i++)u=f[i],r+='<option value="'+u.Id_Modelo+'">'+u.Nombre+"<\/option>";$("#comboModelo").empty().append(r);t!==0&&$("#comboModelo").val(t)},error:function(n,t){console.log(t+": "+n.responseText)}})}tablaClientes=$("#tablaEquipos").DataTable({pageLength:5,destroy:!0,processing:!0,order:[],data:n.d,columns:[{data:"NumeroEconomico"},{data:"Nombre"},{data:"NombreMarca"},{data:"Accion"}],language:textosEsp,columnDefs:[{targets:[-1],orderable:!1},],dom:"frtipl"});$("#tablaEquipos").on("draw.dt",function(){$(".boton-seleccionar-equipo").on("click",function(n){n.preventDefault();idEquipoSeleccionado=$(this).attr("data-idequipo");$("#txtNombreEquipo").val(idEquipoSeleccionado);var i={};i.path=window.location.hostname;i.id=idEquipoSeleccionado;i=JSON.stringify(i);$.ajax({type:"POST",url:"../pages/Proyectos.aspx/GetItemEquipo",data:i,contentType:"application/json; charset=utf-8",dataType:"json",async:!0,success:function(n){var i=n.d;idEquipoSeleccionado=i.IdEquipo;$("#txtNombreEquipo").val(i.Nombre);$("#txtNumeroEconomico").val(i.NumeroEconomico);$("#txtNombreEquipo").val(i.Nombre);$("#comboMarca").val(i.IdMarca);t(i.IdMarca,i.IdModelo);$("#panelSeleccionarEquipo").modal("hide")},error:function(n,t){console.log(t+": "+n.responseText)}})})});$("#tablaEquipos").trigger("draw.dt")},error:function(n,t){console.log(t+": "+n.responseText)}})}function r(){var n={};n.path=window.location.hostname;n.idUsuario=sessionStorage.getItem("idusuario");n=JSON.stringify(n);$.ajax({type:"POST",url:"../pages/PanelRequisiciones.aspx/GetListaItemsProveedores",data:n,contentType:"application/json; charset=utf-8",dataType:"json",async:!0,success:function(n){let t=$("#tablaProveedores").DataTable({pageLength:5,destroy:!0,processing:!0,order:[],data:n.d,columns:[{data:"IdProveedor"},{data:"Nombre"},{data:"Accion"}],language:textosEsp,columnDefs:[{targets:[-1],orderable:!1},],dom:"frtipl"});$("#tablaProveedores").on("draw.dt",function(){$(".boton-seleccionar-proveedor").on("click",function(n){n.preventDefault();idProveedorSeleccionado=$(this).attr("data-idproveedor");$("#btnAbrirSeleccionarProveedor").prop("data-idproveedor",idProveedorSeleccionado);$("#txtNombreProveedor").val(idProveedorSeleccionado+" - "+$(this).attr("data-nombreproveedor"));$("#panelSeleccionarProveedor").modal("hide")})});$("#tablaProveedores").trigger("draw.dt")},error:function(n,t){console.log(t+": "+n.responseText)}})}function t(){var n={};n.path=window.location.hostname;n=JSON.stringify(n);$.ajax({type:"POST",url:"../pages/Proyectos.aspx/GetListaMarcas",data:n,contentType:"application/json; charset=utf-8",dataType:"json",async:!0,success:function(n){var u=n.d,i="",t,r;for(i+='<option value=""><\/option>',t=0;t<u.length;t++)r=u[t],i+='<option value="'+r.Id_Marca+'">'+r.Nombre+"<\/option>";$("#comboMarca").empty().append(i)},error:function(n,t){console.log(t+": "+n.responseText)}})}function u(){var n={};n.path=window.location.hostname;n=JSON.stringify(n);$.ajax({type:"POST",url:"../pages/Proyectos.aspx/GetListaEstatus",data:n,contentType:"application/json; charset=utf-8",dataType:"json",async:!0,success:function(n){for(var i,r=n.d,u="",t=0;t<r.length;t++)i=r[t],u+='<option value="'+i.IdStatusProyecto+'">'+i.Nombre+"<\/option>";$("#comboEstatus").empty().append(u)},error:function(n,t){console.log(t+": "+n.responseText)}})}$("#alert-operacion-ok").hide();$("#alert-operacion-fail").hide();$("#panelTabla").show();$("#panelForm").hide();$("#panelTablaCerrados").hide();n();t();u();$("#btnEnviarAceptar").on("click",t=>{t.preventDefault();var i={};i.path=window.location.hostname;i.id=idSeleccionado;i=JSON.stringify(i);$.ajax({type:"POST",url:"../pages/PanelRequisiciones.aspx/EnviarRequisicion",data:i,contentType:"application/json; charset=utf-8",dataType:"json",async:!0,success:function(t){var i=t.d;i.MensajeError===null?(utils.toast(mensajesAlertas.exitoEnviar,"ok"),n()):utils.toast(i.MensajeError,"error")},error:function(n,t){console.log(t+": "+n.responseText)}})});$("#btnAbrirSeleccionarEquipo").click(function(n){n.preventDefault();i();$("#panelSeleccionarEquipo").modal("show")});$("#btnAbrirSeleccionarProveedor").click(function(n){n.preventDefault();r();$("#panelSeleccionarProveedor").modal("show")});$("#btnNuevo").click(function(n){n.preventDefault();nuevo()});$("#btnGuardar").on("click",function(t){var u,i,r;if(t.preventDefault(),u=$('form[name="frm"]').validator("validate").has(".has-error").length,!u){if(idEquipoSeleccionado==-1){utils.toast(mensajesAlertas.errorSeleccionarEquipo,"error");return}if(idProveedorSeleccionado==-1||idProveedorSeleccionado==0){utils.toast(mensajesAlertas.errorSeleccionarProveedor,"error");return}i={};i.IdRequisicion=idSeleccionado;i.IdEquipo=idEquipoSeleccionado;i.IdProveedor=idProveedorSeleccionado;i.Descripcion=$("#txtDescripcion").val();i.Diagnostico=$("#txtDiagnostico").val();i.Coordenadas=$("#txtCoordenadas").val();r={};r.path=window.location.hostname;r.item=i;r.accion=accion;r=JSON.stringify(r);$.ajax({type:"POST",url:"../pages/PanelRequisiciones.aspx/Guardar",data:r,contentType:"application/json; charset=utf-8",dataType:"json",async:!0,success:function(t){var i=t.d;i.CodigoError==0?(idSeleccionado=i.IdItem,$("#txtNumeroRequisicion").val(idSeleccionado),$(".file-documentos").each(function(){let n;(n=this.files[0])&&utils.sendFile(n,"documentos",i.IdItem)}),$("#spnMensajes").html(mensajesAlertas.exitoGuardar),$("#panelMensajes").modal("show"),n()):utils.toast(mensajesAlertas.errorGuardar,"error")},error:function(n,t){console.log(t+": "+n.responseText);utils.toast(mensajesAlertas.errorGuardar,"error")}})}});$("#btnAceptarPanelMensajes").on("click",n=>{n.preventDefault(),$("#panelMensajes").modal("hide"),$("#panelTabla").show(),$("#panelForm").hide()});$("#btnAgregarOtroDocumento").on("click",function(n){n.preventDefault();let t='<div class="form-group col-md-4">';t+='<input type="file" class="form-control file-documentos" />';t+='<div class="help-block with-errors"><\/div>';t+="<\/div>";$("#divDocumentos").append(t)});$("#btnCancelar").on("click",function(n){n.preventDefault();$("#panelTabla").show();$("#panelForm").hide()});$("#btnEliminarAceptar").on("click",function(){var t={};t.path=window.location.hostname;t.id=idSeleccionado;t=JSON.stringify(t);$.ajax({type:"POST",url:"../pages/PanelRequisiciones.aspx/EliminarRequisicion",data:t,contentType:"application/json; charset=utf-8",dataType:"json",async:!0,success:function(t){var i=t.d;i.MensajeError===null?(utils.toast(mensajesAlertas.exitoEliminar,"ok"),n()):utils.toast(i.MensajeError,"error")},error:function(n,t){console.log(t+": "+n.responseText)}})})});const enviar=n=>{var t={};t.path=window.location.hostname;t.id=n;t=JSON.stringify(t);$.ajax({type:"POST",url:"../pages/PanelRequisiciones.aspx/GetItem",data:t,contentType:"application/json; charset=utf-8",dataType:"json",async:!0,success:function(t){var i=t.d;idSeleccionado=i.IdRequisicion;idEquipoSeleccionado=i.IdEquipo;idProveedorSeleccionado=i.IdProveedor;accion="editar";idProveedorSeleccionado===0||idProveedorSeleccionado===-1?($("#spnMensajes").html(mensajesAlertas.errorSeleccionarProveedorAlEnviar),$("#panelMensajes").modal("show")):($("#msgEnviar").html("<p>Se enviará al proveedor, el registro seleccionado(No."+n+"). ¿Desea continuar?<\/p>"),$("#panelEnviar").modal("show"))},error:function(n,t){console.log(t+": "+n.responseText)}})},editar=n=>{$(".form-group").removeClass("has-error");$(".help-block").empty();$("#frm")[0].reset();$("#divDocumentos").empty();var t={};t.path=window.location.hostname;t.id=n;t=JSON.stringify(t);$.ajax({type:"POST",url:"../pages/PanelRequisiciones.aspx/GetItem",data:t,contentType:"application/json; charset=utf-8",dataType:"json",async:!0,success:function(n){var t=n.d;idSeleccionado=t.IdRequisicion;idEquipoSeleccionado=t.IdEquipo;idProveedorSeleccionado=t.IdProveedor;console.log(".");$("#txtNumeroRequisicion").val(t.IdRequisicion);$("#txtNombreEquipo").val(t.NombreEquipo);$("#txtNombreProveedor").val(t.NombreProveedor);$("#txtOrometro").val(t.Orometro);$("#chkDetieneOperacion").prop("checked",t.DetieneOperacion==1);$("#txtFechaCreacion").val(t.FechaCreacionFormateada);$("#txtDescripcion").val(t.Descripcion);$("#txtNumeroEconomico").val(t.NumeroEconomico);$("#txtDiagnostico").val(t.Diagnostico);$("#txtCoordenadas").val(t.Latitud+", "+t.Longitud);$("#comboMarca").val(t.IdMarca);cargarComboModelos_($("#comboMarca").val(),t.IdModelo);accion="editar";$("#spnTituloForm").text("Editar requisición");$(".deshabilitable").prop("disabled",!1);let i={path:window.location.hostname,id_requisicion:t.IdRequisicion,idUsuario:sessionStorage.getItem("idusuario"),id_tipo:1};utils.getDocumentos(i)},error:function(n,t){console.log(t+": "+n.responseText)}})};