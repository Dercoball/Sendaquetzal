"use strict";let date=new Date,descargas="Mensajes_"+date.getFullYear()+"_"+date.getMonth()+"_"+date.getUTCDay()+"_"+date.getMilliseconds(),pagina="11";const messages={init:()=>{$("#panelTabla").show(),$("#panelForm").hide(),messages.loadComboTipoPlantilla(),messages.loadComboFrecuenciaEnvio(),messages.idSeleccionado=-1,messages.accion="",messages.cargarItems()},loadComboTipoPlantilla:()=>{let n={};n.path=window.location.hostname;n=JSON.stringify(n);$.ajax({type:"POST",url:"../../pages/Config/Messages.aspx/GetListaItemsTipoPlantilla",data:n,contentType:"application/json; charset=utf-8",dataType:"json","async":!0,success:function(n){let t=n.d,i='<option value="">Seleccione...<\/option>';for(let n=0;n<t.length;n++){let r=t[n];i+=`<option value = '${r.IdTipoPlantilla}' > ${r.Nombre}</option > `}$("#comboTipoPlantilla").html(i)},error:function(n,t){console.log(t+": "+n.responseText)}})},loadComboFrecuenciaEnvio:()=>{let n={};n.path=window.location.hostname;n=JSON.stringify(n);$.ajax({type:"POST",url:"../../pages/Config/Messages.aspx/GetListaItemsFrecuenciaEnvio",data:n,contentType:"application/json; charset=utf-8",dataType:"json","async":!0,success:function(n){let t=n.d,i='<option value="">Seleccione...<\/option>';for(let n=0;n<t.length;n++){let r=t[n];i+=`<option value = '${r.IdFrecuenciaEnvio}' > ${r.Nombre}</option > `}$("#comboFrecuenciaEnvio").html(i)},error:function(n,t){console.log(t+": "+n.responseText)}})},cargarItems:()=>{let n={};n.path=window.location.hostname;n.idUsuario=document.getElementById("txtIdUsuario").value;n=JSON.stringify(n);$.ajax({type:"POST",url:"../../pages/Config/Messages.aspx/GetItems",data:n,contentType:"application/json; charset=utf-8",dataType:"json","async":!0,success:function(n){let t=n.d;t==null&&(window.location="../../pages/Index.aspx");let i=$("#table").DataTable({destroy:!0,processing:!0,order:[],data:t,columns:[{data:"IdMensaje"},{data:"Nombre"},{data:"NombreTipoPlantilla"},{data:"Accion"}],language:textosEsp,columnDefs:[{targets:[-1],orderable:!1},],dom:"frBtipl",buttons:[{extend:"excelHtml5",title:descargas,text:"Xls",className:"excelbtn"},{extend:"pdfHtml5",title:descargas,text:"Pdf",className:"pdfbtn"}]})},error:function(n,t){console.log(t+": "+n.responseText)}})},"delete":n=>{messages.idSeleccionado=n,$("#mensajeEliminar").text(`Se eliminará el registro seleccionado (No. ${n}). ¿Desea continuar ?`),$("#panelEliminar").modal("show")},edit:n=>{$(".form-group").removeClass("has-error");$(".help-block").empty();let t={};t.path=window.location.hostname;t.id=n;t=JSON.stringify(t);$.ajax({type:"POST",url:"../../pages/Config/Messages.aspx/GetItem",data:t,contentType:"application/json; charset=utf-8",dataType:"json","async":!0,success:function(n){let t=n.d;messages.idSeleccionado=t.IdMensaje;$("#txtNombre").val(t.Nombre);$("#comboTipoPlantilla").val(t.IdTipoPlantilla);$("#comboFrecuenciaEnvio").val(t.IdFrecuenciaEnvio);tinymce.get("contenido").setContent(t.Contenido);$("#panelTabla").hide();$("#panelForm").show();messages.accion="editar";$("#spnTituloForm").text("Editar");$(".deshabilitable").prop("disabled",!1)},error:function(n,t){console.log(t+": "+n.responseText)}})},nuevo:()=>{$("#frm")[0].reset(),$(".form-group").removeClass("has-error"),$(".help-block").empty(),$("#spnTituloForm").text("Nuevo"),$("#panelTabla").hide(),$("#panelForm").show(),messages.accion="nuevo",messages.idSeleccionado=-1,$(".deshabilitable").prop("disabled",!1)},accionesBotones:()=>{$("#btnNuevo").on("click",n=>{n.preventDefault(),messages.nuevo()});$("#btnGuardar").click(function(n){n.preventDefault();var t=$('form[name="frm"]').validator("validate").has(".has-error").length;if(!t){let t={};t.IdMensaje=messages.idSeleccionado;t.Nombre=$("#txtNombre").val();t.Contenido=tinymce.get("contenido").getContent();t.IdTipoPlantilla=$("#comboTipoPlantilla").val();t.IdFrecuenciaEnvio=$("#comboFrecuenciaEnvio").val();let n={};n.path=window.location.hostname;n.item=t;n.accion=messages.accion;n.idUsuario=document.getElementById("txtIdUsuario").value;n=JSON.stringify(n);$.ajax({type:"POST",url:"../../pages/Config/Messages.aspx/Save",data:n,contentType:"application/json; charset=utf-8",dataType:"json","async":!0,success:function(n){let t=parseInt(n.d);t>0?(utils.toast(mensajesAlertas.exitoGuardar,"ok"),$("#panelTabla").show(),$("#panelForm").hide(),messages.cargarItems()):utils.toast(mensajesAlertas.errorGuardar,"fail");$("#panelEdicion").modal("hide")},error:function(n,t){console.log(t+": "+n.responseText)}})}});$("#btnCancelar").on("click",n=>{n.preventDefault(),$("#panelTabla").show(),$("#panelForm").hide()});$("#btnEliminarAceptar").on("click",()=>{let n={};n.path=window.location.hostname;n.id=messages.idSeleccionado;n.idUsuario=document.getElementById("txtIdUsuario").value;n=JSON.stringify(n);$.ajax({type:"POST",url:"../../pages/Config/Messages.aspx/Delete",data:n,contentType:"application/json; charset=utf-8",dataType:"json","async":!0,success:function(n){var t=n.d;t.MensajeError===null?(utils.toast(mensajesAlertas.exitoEliminar,"ok"),messages.cargarItems()):utils.toast(t.MensajeError,"error")},error:function(n,t){console.log(t+": "+n.responseText)}})})}};window.addEventListener("load",()=>{messages.init(),messages.accionesBotones()});