"use strict";let date=new Date,descargas="Clientes_"+date.getFullYear()+"_"+date.getMonth()+"_"+date.getUTCDay()+"_"+date.getMilliseconds(),pagina="8";const POSICION_DIRECTOR=1,POSICION_COORDINADOR=2,POSICION_EJECUTIVO=3,POSICION_SUPERVISOR=4,POSICION_PROMOTOR=5,employee={init:()=>{$("#panelTabla").show(),$("#panelForm").hide(),employee.idSeleccionado="-1",employee.idTipoUsuario="-1",employee.login="-1",employee.accion="",employee.loadComboTipoCliente(),employee.cargarItems(),$(".combo-supervisor").hide(),$(".combo-ejecutivo").hide()},cargarItems:()=>{let n={};n.path=window.location.hostname;n.idUsuario=document.getElementById("txtIdUsuario").value;n=JSON.stringify(n);$.ajax({type:"POST",url:"../../pages/Clients.aspx/GetListaItems",data:n,contentType:"application/json; charset=utf-8",dataType:"json","async":!0,success:function(n){let t=n.d;t==null&&(window.location="../../pages/Index.aspx");let i=$("#table").DataTable({destroy:!0,processing:!0,order:[],data:t,columns:[{data:"Id_Cliente"},{data:"NombreCompleto"},{data:"TipoCliente"},{data:"Telefono_1"},{data:"Curp"},{data:"Ocupacion"},{data:"Monto"},{data:"FechaSolicitud"},{data:"Accion"}],language:textosEsp,columnDefs:[{targets:[-1],orderable:!1},],dom:"frtiplB",buttons:[{extend:"excelHtml5",title:descargas,text:"Xls",className:"excelbtn"},{extend:"pdfHtml5",title:descargas,text:"Pdf",className:"pdfbtn"}]})},error:function(n,t){console.log(t+": "+n.responseText)}})},"delete":n=>{employee.idSeleccionado=n,$("#panelEliminar").modal("show")},changePassword:(n,t,i)=>{$(".form-group").removeClass("has-error"),$(".help-block").empty(),$("#txtLoginP").val(i),$("#txtPassP").val(""),employee.idSeleccionado=n,employee.idTipoUsuario=t,employee.login=i,employee.accion="changePassword",$("#panelEdicionPass").modal("show")},edit:n=>{$(".form-group").removeClass("has-error");$(".help-block").empty();$("#frm")[0].reset();let t={};t.path=window.location.hostname;t.id=n;t=JSON.stringify(t);$.ajax({type:"POST",url:"../../pages/Clients.aspx/GetDataClient",data:t,contentType:"application/json; charset=utf-8",dataType:"json","async":!0,success:function(n){var t=n.d;employee.idSeleccionado=t.Id_Cliente;$("#txtNombre").val(t.Nombre);$("#txtPrimerApellido").val(t.PrimerApellido);$("#txtSegundoApellido").val(t.SegundoApellido);$("#txtCURP").val(t.Curp);$("#txtFechaSolicitud").val(t.FechaSolicitud);$("#txtTelefono").val(t.Telefono_1);$("#txtCantidadPrestamo").val(t.Monto);$("#txtOcupacion").val(t.Ocupacion);$("#comboTipoCliente").val(t.IdTipoCliente);$("#txtCalle").val(t.direccion.Calle);$("#txtColonia").val(t.direccion.Colonia);$("#txtMunicipio").val(t.direccion.Municipio);$("#txtEstado").val(t.direccion.Estado);$("#txtCodigoPostal").val(t.direccion.CodigoPostal);$("#txtDireccionTrabajo").val(t.direccion.DireccionTrabajo);$("#txtNombreAval").val(t.NombreAval);$("#txtPrimerApellidoAval").val(t.PrimerApellidoAval);$("#txtSegundoApellidoAval").val(t.SegundoApellidoAval);$("#txtCURPAval").val(t.CurpAval);$("#txtTelefonoAval").val(t.TelefonoAval);$("#txtOcupacionAval").val(t.OcupacionAval);$("#txtCalleAval").val(t.direccionAval.Calle);$("#txtColoniaAval").val(t.direccionAval.Colonia);$("#txtMunicipioAval").val(t.direccionAval.Municipio);$("#txtEstadoAval").val(t.direccionAval.Estado);$("#txtCodigoPostalAval").val(t.direccionAval.CodigoPostal);$("#txtDireccionTrabajoAval").val(t.direccionAval.DireccionTrabajo);$("#panelTabla").hide();$("#panelForm").show();employee.accion="editar";$("#spnTituloForm").text("Editar");console.log(employee.idSeleccionado);employee.getDocument(employee.idSeleccionado,2,"#img_1");employee.getDocument(employee.idSeleccionado,3,"#img_2");employee.getDocument(employee.idSeleccionado,4,"#img_3");employee.getDocument(employee.idSeleccionado,6,"#img_6");employee.getDocument(employee.idSeleccionado,7,"#img_7");employee.getDocument(employee.idSeleccionado,8,"#img_8")},error:function(n,t){console.log(t+": "+n.responseText)}})},getDocument(n,t,i){let r={};r.path=window.location.hostname;r.idCliente=n;r.idTipoDocumento=t;r=JSON.stringify(r);$.ajax({type:"POST",url:"../../pages/Clients.aspx/GetDocument",data:r,contentType:"application/json; charset=utf-8",dataType:"json","async":!0,success:function(n){let r=n.d;r.IdDocumento?(r.Extension==="png"||r.Extension==="jpg"||r.Extension==="jpeg"||r.Extension==="bmp"?$(`${i}`).attr("src",`data:image/jpg;base64,${r.Contenido}`):r.Extension==="pdf"?$(`${i}`).attr("src","../../img/ico_pdf.png"):$(`${i}`).attr("src","../../img/ico_doc.png"),$(`#href_${t}`).css("cursor","pointer")):$(`#href_${t}`).css("cursor","default")},error:function(n,t){console.log(t+": "+n.responseText)}})},nuevo:()=>{$("#frm")[0].reset(),$(".form-group").removeClass("has-error"),$(".help-block").empty(),$("#spnTituloForm").text("Nuevo"),$("#txtDescripcion").val(""),$("#panelTabla").hide(),$("#panelForm").show(),employee.accion="nuevo",employee.idSeleccionado=-1,$(".deshabilitable").prop("disabled",!1),$(".combo-supervisor").hide(),$(".combo-ejecutivo").hide(),$("#txtPassword").prop("disabled",!1)},testData(){$(".campo-combo").val(2);$(".campo-date").val("2022-01-01");$(".campo-input").val(7)},loadComboTipoCliente:()=>{var n={};n.path=window.location.hostname;n=JSON.stringify(n);$.ajax({type:"POST",url:"../../pages/Clients.aspx/GetListaItemsTipoCliente",data:n,contentType:"application/json; charset=utf-8",dataType:"json","async":!0,success:function(n){let t=n.d,i='<option value="">Seleccione...<\/option>';for(let n=0;n<t.length;n++){let r=t[n];i+=`<option value = '${r.IdTipoCliente}' > ${r.NombreTipoCliente}</option > `}$("#comboTipoCliente").html(i)},error:function(n,t){console.log(t+": "+n.responseText)}})},accionesBotones:()=>{$(".img-document").on("click",function(n){n.preventDefault();let t=n.currentTarget.dataset.tipo;if(employee.accion!=="nuevo"){let n={};n.path=window.location.hostname;n.idEmpleado=employee.idSeleccionado;n.idTipoDocumento=t;n=JSON.stringify(n);$.ajax({type:"POST",url:"../../pages/Clients.aspx/GetDocument",data:n,contentType:"application/json; charset=utf-8",dataType:"json","async":!0,success:function(n){let t=n.d;if(t.Contenido){let n=null;if(n=t.Extension==="png"||t.Extension==="jpg"||t.Extension==="jpeg"||t.Extension==="bmp"?utils.b64toBlob(t.Contenido,"data:image/png",512):t.Extension==="pdf"?utils.b64toBlob(t.Contenido,"data:document/pdf",512):utils.b64toBlob(t.Contenido,"",512),n){const r=URL.createObjectURL(n),i=document.createElement("a");i.href=r;i.setAttribute("download",t.Nombre+"."+t.Extension);document.body.appendChild(i);i.click();document.body.removeChild(i)}}},error:function(n,t){console.log(t+": "+n.responseText)}})}});$("#btnNuevo").on("click",n=>{n.preventDefault(),employee.nuevo()});$("#btnGuardar").on("click",n=>{n.preventDefault();let f=$('form[name="frm"]').validator("validate").has(".has-error").length;if(!f){let t={};t.Id_Cliente=employee.idSeleccionado;t.FechaSolicitud=$("#txtFechaSolicitud").val();t.Monto=$("#txtCantidadPrestamo").val();t.IdTipoCliente=$("#comboTipoCliente").val()==null?0:$("#comboTipoCliente").val();t.Curp=$("#txtCURP").val();t.PrimerApellido=$("#txtPrimerApellido").val();t.SegundoApellido=$("#txtSegundoApellido").val();t.Nombre=$("#txtNombre").val();t.Telefono_1=$("#txtTelefono").val();t.Ocupacion=$("#txtOcupacion").val();t.OcupacionAval=$("#txtOcupacionAval").val();t.CurpAval=$("#txtCURPAval").val();t.PrimerApellidoAval=$("#txtPrimerApellidoAval").val();t.SegundoApellidoAval=$("#txtSegundoApellidoAval").val();t.NombreAval=$("#txtNombreAval").val();t.TelefonoAval=$("#txtTelefonoAval").val();let i={};i.IdCliente=employee.idSeleccionado;i.Calle=$("#txtCalle").val();i.Aval=0;i.Colonia=$("#txtColonia").val();i.Municipio=$("#txtMunicipio").val();i.Estado=$("#txtEstado").val();i.CodigoPostal=$("#txtCodigoPostal").val();i.DireccionTrabajo=$("#txtDireccionTrabajo").val();let r={};r.IdCliente=employee.idSeleccionado;r.Calle=$("#txtCalleAval").val();r.Aval=1;r.Colonia=$("#txtColoniaAval").val();r.Municipio=$("#txtMunicipioAval").val();r.Estado=$("#txtEstadoAval").val();r.CodigoPostal=$("#txtCodigoPostalAval").val();r.DireccionTrabajo=$("#txtDireccionTrabajoAval").val();let u={};u.path=window.location.hostname;u.item=t;u.itemAddress=i;u.itemAddressAval=r;u.idUsuario=document.getElementById("txtIdUsuario").value;u.accion=employee.accion;u=JSON.stringify(u);let e=employee.accion==="nuevo"?"Save":"Update";$.ajax({type:"POST",url:`../../pages/Clients.aspx/${e}`,data:u,contentType:"application/json; charset=utf-8",dataType:"json","async":!0,success:function(n){var t=n.d;if(t.CodigoError==0){employee.accion==="nuevo"&&$(".campo-imagen").each(function(n,i){let u=i.dataset.tipo,r;(r=this.files[0])&&utils.sendFileEmployee(r,"documento",t.IdItem,u,"cliente")});let n=employee.accion==="nuevo"?5e3:100;setTimeout(function(){utils.toast(mensajesAlertas.exitoGuardar,"ok");employee.init()},n)}else utils.toast(mensajesAlertas.errorGuardar,"error")},error:function(){utils.toast(mensajesAlertas.errorGuardar,"error")}})}});$(".campo-imagen").on("change",function(n){n.preventDefault();let t=n.currentTarget.dataset.tipo;if(employee.idSeleccionado!=="-1"&&employee.accion!=="nuevo"){let n;(n=this.files[0])&&(utils.sendFileEmployee(n,"update_document_employee",employee.idSeleccionado,t,"cliente"),setTimeout(function(){employee.getDocument(employee.idSeleccionado,t,`#img_${t}`)},5e3))}});$("#btnCancelar").on("click",n=>{n.preventDefault(),$(`.documentos`).attr("src","../../img/upload.png"),$("#panelTabla").show(),$("#panelForm").hide()});$("#btnEliminarAceptar").on("click",()=>{let n={};n.path=window.location.hostname;n.id=employee.idSeleccionado;n=JSON.stringify(n);$.ajax({type:"POST",url:"../../pages/Config/Employees.aspx/Delete",data:n,contentType:"application/json; charset=utf-8",dataType:"json","async":!0,success:function(n){var t=n.d;t.MensajeError===null?(utils.toast(mensajesAlertas.exitoEliminar,"ok"),employee.cargarItems()):utils.toast(t.MensajeError,"error")},error:function(n,t){console.log(t+": "+n.responseText)}})})}};window.addEventListener("load",()=>{employee.init(),employee.accionesBotones()});