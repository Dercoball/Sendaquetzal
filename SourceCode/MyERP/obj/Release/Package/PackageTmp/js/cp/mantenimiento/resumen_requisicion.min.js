"use strict";let date=new Date,descargas="ResumenRequisicion_"+date.getFullYear()+"_"+date.getMonth()+"_"+date.getUTCDay()+"_"+date.getMilliseconds(),pagina="59",idRefaccionSeleccionada=-1,idRequisicionSeleccionada=-1;class ResumenRequisicion{constructor(n){this.IdRegistroFalla=n;this.IdEqÃºipo=null;this.FechaCreacion=null;this.Descripcion="";this.Diagnostico="";this.Orometro="";this.DetieneOperacion=!1}}const resumenRequisicion={init:()=>{$("#alert-operacion-ok").hide(),$("#alert-operacion-fail").hide(),$("#panelForm").hide(),$("#panelTabla").hide(),resumenRequisicion.cargarComboMarcas()},cargarComboMarcas:()=>{var n={};n.path=window.location.hostname;n=JSON.stringify(n);$.ajax({type:"POST",url:"../pages/ResumenRequisicion.aspx/GetListaMarcas",data:n,contentType:"application/json; charset=utf-8",dataType:"json",async:!0,success:function(n){var u=n.d,i="",t,r;for(i+='<option value=""><\/option>',t=0;t<u.length;t++)r=u[t],i+='<option value="'+r.Id_Marca+'">'+r.Nombre+"<\/option>";$("#comboMarca").empty().append(i)},error:function(n,t){console.log(t+": "+n.responseText)}})},cargarItemsRequisiciones:()=>{var n={};n.path=window.location.hostname;n.idUsuario=sessionStorage.getItem("idusuario");n=JSON.stringify(n);$.ajax({type:"POST",url:"../pages/ResumenRequisicion.aspx/GetListaRequisicionesCreadas",data:n,contentType:"application/json; charset=utf-8",dataType:"json",async:!0,success:function(n){function t(n,t){var i={};i.path=window.location.hostname;i.idMarca=n;i=JSON.stringify(i);$.ajax({type:"POST",url:"../pages/ResumenRequisicion.aspx/GetListaModelos",data:i,contentType:"application/json; charset=utf-8",dataType:"json",async:!0,success:function(n){var f=n.d,r="",i,u;for(r+='<option value=""><\/option>',i=0;i<f.length;i++)u=f[i],r+='<option value="'+u.Id_Modelo+'">'+u.Nombre+"<\/option>";$("#comboModelo").empty().append(r);t!==0&&$("#comboModelo").val(t)},error:function(n,t){console.log(t+": "+n.responseText)}})}let i=$("#tablaRequisiciones").DataTable({pageLength:5,destroy:!0,processing:!0,order:[],data:n.d,columns:[{data:"IdRequisicion"},{data:"NumeroEconomico"},{data:"NombreEquipo"},{data:"NombreStatus"},{data:"Accion"}],language:textosEsp,columnDefs:[{targets:[-1],orderable:!1},],dom:"frtipl"});$("#tablaRequisiciones").on("draw.dt",function(){$(".boton-seleccionar-requisicion").on("click",function(n){n.preventDefault();idRequisicionSeleccionada=$(this).attr("data-idrequisicion");var i={};i.path=window.location.hostname;i.id=idRequisicionSeleccionada;i=JSON.stringify(i);$.ajax({type:"POST",url:"../pages/ResumenRequisicion.aspx/GetItem",data:i,contentType:"application/json; charset=utf-8",dataType:"json",async:!0,success:function(n){var i=n.d;idRequisicionSeleccionada=i.IdRequisicion;console.log(".");$("#txtRequisicion").val(i.IdRequisicion);$("#txtNombreEquipo").val(i.NombreEquipo);$("#txtNombreProveedor").val(i.NombreProveedor);$("#txtOrometro").val(i.Orometro);$("#chkDetieneOperacion").prop("checked",i.DetieneOperacion==1);$("#txtFechaCreacion").val(i.FechaCreacionFormateadaMx);$("#txtDescripcion").val(i.Descripcion);$("#txtNumeroEconomico").val(i.NumeroEconomico);$("#txtDiagnostico").val(i.Diagnostico);$("#txtCoordenadas").val(i.Latitud+", "+i.Longitud);$("#comboMarca").val(i.IdMarca);t($("#comboMarca").val(),i.IdModelo);let r={path:window.location.hostname,id_requisicion:i.IdRequisicion,idUsuario:sessionStorage.getItem("idusuario"),id_tipo:1};$("#panelSeleccionarRequisicion").modal("hide");$("#panelTabla").show();resumenRequisicion.cargarItems(idRequisicionSeleccionada);$.ajax({type:"POST",url:"../pages/ResumenRequisicion.aspx/GetDocumentos",data:JSON.stringify(r),contentType:"application/json; charset=utf-8",dataType:"json",async:!0,success:function(n){let i=n.d;console.log(n.d);let t="";i.forEach(function(n){t+="<div>";t+='<a href = "../pages/Download.ashx?path='+window.location.hostname+"&id_documento="+n.IdDocumento+'" target="blank" >';t+=n.Descripcion;t+="<\/a>";t+="<\/div>";$("#divDocumentos").append(t)});$("#divDocumentos").empty().append(t)},error:function(n,t){console.log(t+": "+n.responseText)}})},error:function(n,t){console.log(t+": "+n.responseText)}})})});$("#tablaRequisiciones").trigger("draw.dt")},error:function(n,t){console.log(t+": "+n.responseText)}})},cargarItems:n=>{var t={};t.path=window.location.hostname;t.idUsuario=sessionStorage.getItem("idusuario");t.idRequisicion=n;t=JSON.stringify(t);$.ajax({type:"POST",url:"../pages/ResumenRequisicion.aspx/GetItems",data:t,contentType:"application/json; charset=utf-8",dataType:"json",async:!0,success:function(n){let t=$("#tablaRefacciones").DataTable({pageLength:50,destroy:!0,processing:!0,order:[],data:n.d,columns:[{data:"IdRefaccion"},{data:"NumeroParte"},{data:"FechaFormateadaMx"},{data:"Descripcion"},{data:"Cantidad"},{data:"Urgencia"},],language:textosEsp,columnDefs:[{targets:[-1],orderable:!1},],dom:"rti"});$("#tablaRefacciones").on("draw.dt",function(){});$("#tablaRefacciones").trigger("draw.dt")},error:function(n,t){console.log(t+": "+n.responseText)}})},cargarComboModelos_:(n,t)=>{var i={};i.path=window.location.hostname;i.idMarca=n;i=JSON.stringify(i);$.ajax({type:"POST",url:"../pages/Proyectos.aspx/GetListaModelos",data:i,contentType:"application/json; charset=utf-8",dataType:"json",async:!0,success:function(n){var f=n.d,r="",i,u;for(r+='<option value=""><\/option>',i=0;i<f.length;i++)u=f[i],r+='<option value="'+u.Id_Modelo+'">'+u.Nombre+"<\/option>";$("#comboModelo").empty().append(r);t!==0&&$("#comboModelo").val(t)},error:function(n,t){console.log(t+": "+n.responseText)}})},cancelar:n=>{idRefaccionSeleccionada=n,$("#msgCancelar").html(mensajesAlertas.confirmacionCancelarRefaccion.replace("{numrefaccion}",n)),$("#panelEliminar").modal("show")},accionesBotones:()=>{$("#btnAbrirSeleccionarRequisicion").on("click",n=>{n.preventDefault(),resumenRequisicion.cargarItemsRequisiciones(),$("#panelSeleccionarRequisicion").modal("show")});$("#btnCancelar").on("click",n=>{n.preventDefault(),$("#panelForm").hide(),$("#panelTabla").show()})}};window.addEventListener("load",()=>{resumenRequisicion.init(),resumenRequisicion.accionesBotones()});