"use strict";let date=new Date,descargas="Empleados_"+date.getFullYear()+"_"+date.getMonth()+"_"+date.getUTCDay()+"_"+date.getMilliseconds(),pagina="8";const POSICION_DIRECTOR=1,POSICION_COORDINADOR=2,POSICION_EJECUTIVO=3,POSICION_SUPERVISOR=4,POSICION_PROMOTOR=5,employee={init:()=>{$("#panelTabla").show(),$("#panelForm").hide(),employee.idSeleccionado="-1",employee.idTipoUsuario="-1",employee.login="-1",employee.accion="",employee.loadComboPosicion(),employee.loadComboPlaza(),employee.loadComboModulo(),employee.loadComboEmployeesByPosicion(POSICION_EJECUTIVO,"#comboEjecutivo"),employee.loadComboEmployeesByPosicion(POSICION_SUPERVISOR,"#comboSupervisor"),employee.cargarItems(),$(".combo-supervisor").hide(),$(".combo-ejecutivo").hide()},cargarItems:()=>{let n={};n.path=window.location.hostname;n.idUsuario=document.getElementById("txtIdUsuario").value;n=JSON.stringify(n);$.ajax({type:"POST",url:"../../pages/Config/Employees.aspx/GetListaItems",data:n,contentType:"application/json; charset=utf-8",dataType:"json","async":!0,success:function(n){let t=n.d;t==null&&(window.location="../../pages/Index.aspx");let i=$("#table").DataTable({destroy:!0,processing:!0,order:[],data:t,columns:[{data:"IdEmpleado"},{data:"NombreCompleto"},{data:"Login"},{data:"NombreModulo"},{data:"NombreTipoUsuario"},{data:"NombrePlaza"},{data:"FechaIngresoMx"},{data:"Accion"}],language:textosEsp,columnDefs:[{targets:[-1],orderable:!1},],dom:"frtiplB",buttons:[{extend:"excelHtml5",title:descargas,text:"Xls",className:"excelbtn"},{extend:"pdfHtml5",title:descargas,text:"Pdf",className:"pdfbtn"}]})},error:function(n,t){console.log(t+": "+n.responseText)}})},"delete":n=>{employee.idSeleccionado=n,$("#panelEliminar").modal("show")},changePassword:(n,t,i)=>{$(".form-group").removeClass("has-error"),$(".help-block").empty(),$("#txtLoginP").val(i),$("#txtPassP").val(""),employee.idSeleccionado=n,employee.idTipoUsuario=t,employee.login=i,employee.accion="changePassword",$("#panelEdicionPass").modal("show")},edit:n=>{$(".form-group").removeClass("has-error");$(".help-block").empty();$("#frm")[0].reset();let t={};t.path=window.location.hostname;t.id=n;t=JSON.stringify(t);$.ajax({type:"POST",url:"../../pages/Config/Employees.aspx/GetDataEmployee",data:t,contentType:"application/json; charset=utf-8",dataType:"json","async":!0,success:function(n){var t=n.d;employee.idSeleccionado=t.IdEmpleado;$("#txtNombre").val(t.Nombre);$("#txtPrimerApellido").val(t.PrimerApellido);$("#txtSegundoApellido").val(t.SegundoApellido);$("#txtCURP").val(t.CURP);$("#txtFechaIngreso").val(t.FechaIngreso);$("#txtFechaNacimiento").val(t.FechaNacimiento);$("#txtTelefono").val(t.Telefono);$("#txtMontoLimiteInicial").val(t.MontoLimiteInicial);$("#comboComisionInicial").val(t.IdComisionInicial);$("#comboPosicion").val(t.IdPosicion);$("#comboPlaza").val(t.IdPlaza);$("#comboEjecutivo").val(t.IdEjecutivo);$("#comboSupervisor").val(t.IdSupervisor);$("#txtCalle").val(t.direccion.Calle);$("#txtColonia").val(t.direccion.Colonia);$("#txtMunicipio").val(t.direccion.Municipio);$("#txtEstado").val(t.direccion.Estado);$("#txtCodigoPostal").val(t.direccion.CodigoPostal);$("#txtNombreAval").val(t.NombreAval);$("#txtPrimerApellidoAval").val(t.PrimerApellidoAval);$("#txtSegundoApellidoAval").val(t.SegundoApellidoAval);$("#txtCURPAval").val(t.CURPAval);$("#txtTelefonoAval").val(t.TelefonoAval);$("#txtCalleAval").val(t.direccionAval.Calle);$("#txtColoniaAval").val(t.direccionAval.Colonia);$("#txtMunicipioAval").val(t.direccionAval.Municipio);$("#txtEstadoAval").val(t.direccionAval.Estado);$("#txtCodigoPostalAval").val(t.direccionAval.CodigoPostal);$("#txtNombreUsuario").val(t.usuario.Login);$("#txtPassword").val("0000000000");$("#txtPassword").prop("disabled",!0);$("#panelTabla").hide();$("#panelForm").show();employee.accion="editar";$("#spnTituloForm").text("Editar");Number(t.IdPosicion)===Number(POSICION_PROMOTOR)?($(".combo-supervisor").show(),$(".combo-ejecutivo").hide()):Number(t.IdPosicion)===Number(POSICION_SUPERVISOR)?($(".combo-supervisor").hide(),$(".combo-ejecutivo").show()):($(".combo-supervisor").hide(),$(".combo-ejecutivo").hide());employee.getDocument(employee.idSeleccionado,1,"#img_1");employee.getDocument(employee.idSeleccionado,2,"#img_2");employee.getDocument(employee.idSeleccionado,3,"#img_3");employee.getDocument(employee.idSeleccionado,4,"#img_4");employee.getDocument(employee.idSeleccionado,5,"#img_5");employee.getDocument(employee.idSeleccionado,6,"#img_6");employee.getDocument(employee.idSeleccionado,7,"#img_7");employee.getDocument(employee.idSeleccionado,8,"#img_8")},error:function(n,t){console.log(t+": "+n.responseText)}})},getDocument(n,t,i){let r={};r.path=window.location.hostname;r.idEmpleado=n;r.idTipoDocumento=t;r=JSON.stringify(r);$.ajax({type:"POST",url:"../../pages/Config/Employees.aspx/GetDocument",data:r,contentType:"application/json; charset=utf-8",dataType:"json","async":!0,success:function(n){let r=n.d;r.IdDocumento?(r.Extension==="png"||r.Extension==="jpg"||r.Extension==="jpeg"||r.Extension==="bmp"?$(`${i}`).attr("src",`data:image/jpg;base64,${r.Contenido}`):r.Extension==="pdf"?$(`${i}`).attr("src","../../img/ico_pdf.png"):$(`${i}`).attr("src","../../img/ico_doc.png"),$(`#href_${t}`).css("cursor","pointer")):$(`#href_${t}`).css("cursor","default")},error:function(n,t){console.log(t+": "+n.responseText)}})},nuevo:()=>{$("#frm")[0].reset(),$(".form-group").removeClass("has-error"),$(".help-block").empty(),$("#spnTituloForm").text("Nuevo"),$("#txtDescripcion").val(""),$("#panelTabla").hide(),$("#panelForm").show(),employee.accion="nuevo",employee.idSeleccionado=-1,$(".deshabilitable").prop("disabled",!1),$(".combo-supervisor").hide(),$(".combo-ejecutivo").hide(),$("#txtPassword").prop("disabled",!1)},testData(){$(".campo-combo").val(2);$(".campo-date").val("2022-01-01");$(".campo-input").val(7)},loadComboEmployeesByPosicion:(n,t)=>{var i={};i.path=window.location.hostname;i.idTipoEmpleado=n;i=JSON.stringify(i);$.ajax({type:"POST",url:"../../pages/Config/Employees.aspx/GetListaItemsEmpleadoByPosicion",data:i,contentType:"application/json; charset=utf-8",dataType:"json","async":!0,success:function(n){let i=n.d,r='<option value="">Seleccione...<\/option>';for(let n=0;n<i.length;n++){let t=i[n];r+=`<option value = '${t.IdEmpleado}' > ${t.Nombre}</option > `}$(`${t} `).html(r)},error:function(n,t){console.log(t+": "+n.responseText)}})},loadComboPosicion:()=>{var n={};n.path=window.location.hostname;n=JSON.stringify(n);$.ajax({type:"POST",url:"../../pages/Config/Employees.aspx/GetListaItemsPosiciones",data:n,contentType:"application/json; charset=utf-8",dataType:"json","async":!0,success:function(n){let t=n.d,i='<option value="">Seleccione...<\/option>';for(let n=0;n<t.length;n++){let r=t[n];i+=`<option value = '${r.IdPosicion}' > ${r.Nombre}</option > `}console.log("loadComboPosicion");$("#comboPosicion").html(i)},error:function(n,t){console.log(t+": "+n.responseText)}})},loadComboPlaza:()=>{var n={};n.path=window.location.hostname;n=JSON.stringify(n);$.ajax({type:"POST",url:"../../pages/Config/Employees.aspx/GetListaItemsPlazas",data:n,contentType:"application/json; charset=utf-8",dataType:"json","async":!0,success:function(n){let t=n.d,i='<option value="">Seleccione...<\/option>';for(let n=0;n<t.length;n++){let r=t[n];i+=`<option value = '${r.IdPlaza}' > ${r.Nombre}</option > `}$("#comboPlaza").html(i)},error:function(n,t){console.log(t+": "+n.responseText)}})},loadComboModulo:()=>{var n={};n.path=window.location.hostname;n=JSON.stringify(n);$.ajax({type:"POST",url:"../../pages/Config/Employees.aspx/GetListaItemsModulos",data:n,contentType:"application/json; charset=utf-8",dataType:"json","async":!0,success:function(n){let t=n.d,i='<option value="">Seleccione...<\/option>';for(let n=0;n<t.length;n++){let r=t[n];i+=`<option value = '${r.IdModulo}' > ${r.Nombre}</option > `}$("#comboComisionInicial").html(i)},error:function(n,t){console.log(t+": "+n.responseText)}})},accionesBotones:()=>{$(".img-document").on("click",function(n){n.preventDefault();let t=n.currentTarget.dataset.tipo;if(employee.accion!=="nuevo"){let n={};n.path=window.location.hostname;n.idEmpleado=employee.idSeleccionado;n.idTipoDocumento=t;n=JSON.stringify(n);$.ajax({type:"POST",url:"../../pages/Config/Employees.aspx/GetDocument",data:n,contentType:"application/json; charset=utf-8",dataType:"json","async":!0,success:function(n){let t=n.d;if(t.Contenido){let n=null;if(n=t.Extension==="png"||t.Extension==="jpg"||t.Extension==="jpeg"||t.Extension==="bmp"?utils.b64toBlob(t.Contenido,"data:image/png",512):t.Extension==="pdf"?utils.b64toBlob(t.Contenido,"data:document/pdf",512):utils.b64toBlob(t.Contenido,"",512),n){const r=URL.createObjectURL(n),i=document.createElement("a");i.href=r;i.setAttribute("download",t.Nombre+"."+t.Extension);document.body.appendChild(i);i.click();document.body.removeChild(i)}}},error:function(n,t){console.log(t+": "+n.responseText)}})}});$("#btnNuevo").on("click",n=>{n.preventDefault(),employee.nuevo()});$("#btnGuardar").on("click",n=>{n.preventDefault();let o=$('form[name="frm"]').validator("validate").has(".has-error").length;if(!o){let e=$("#comboPosicion").val();if(Number(e)===Number(POSICION_PROMOTOR)){let n=$("#comboSupervisor").val();if(!n){utils.toast(mensajesAlertas.errorSeleccionarSupervisor,"error");return}}if(Number(e)===Number(POSICION_SUPERVISOR)){let n=$("#comboEjecutivo").val();if(!n){utils.toast(mensajesAlertas.errorSeleccionarEjecutivo,"error");return}}let t={};t.IdEmpleado=employee.idSeleccionado;t.FechaIngreso=$("#txtFechaIngreso").val();t.IdPosicion=$("#comboPosicion").val();t.IdSupervisor=$("#comboSupervisor").val()==null?0:$("#comboSupervisor").val();t.IdEjecutivo=$("#comboEjecutivo").val()==null?0:$("#comboEjecutivo").val();t.CURP=$("#txtCURP").val();t.FechaNacimiento=$("#txtFechaNacimiento").val();t.PrimerApellido=$("#txtPrimerApellido").val();t.SegundoApellido=$("#txtSegundoApellido").val();t.Nombre=$("#txtNombre").val();t.CURPAval=$("#txtCURPAval").val();t.PrimerApellidoAval=$("#txtPrimerApellidoAval").val();t.SegundoApellidoAval=$("#txtSegundoApellidoAval").val();t.NombreAval=$("#txtNombreAval").val();t.TelefonoAval=$("#txtTelefonoAval").val();t.IdSupervisor||(t.IdSupervisor=0);t.IdEjecutivo||(t.IdEjecutivo=0);t.IdPlaza=$("#comboPlaza").val();t.IdComisionInicial=$("#comboComisionInicial").val();t.Telefono=$("#txtTelefono").val();t.MontoLimiteInicial=$("#txtMontoLimiteInicial").val();let r={};r.IdEmpleado=employee.idSeleccionado;r.Calle=$("#txtCalle").val();r.Aval=0;r.Colonia=$("#txtColonia").val();r.Municipio=$("#txtMunicipio").val();r.Estado=$("#txtEstado").val();r.CodigoPostal=$("#txtCodigoPostal").val();let u={};u.IdEmpleado=employee.idSeleccionado;u.Calle=$("#txtCalleAval").val();u.Aval=1;u.Colonia=$("#txtColoniaAval").val();u.Municipio=$("#txtMunicipioAval").val();u.Estado=$("#txtEstadoAval").val();u.CodigoPostal=$("#txtCodigoPostalAval").val();let f={};f.IdEmpleado=employee.idSeleccionado;f.Login=$("#txtNombreUsuario").val();f.Password=$("#txtPassword").val();f.IdTipoUsuario=$("#comboPosicion").val();let i={};i.path=window.location.hostname;i.item=t;i.itemAddress=r;i.itemAddressAval=u;i.itemUser=f;i.idUsuario=document.getElementById("txtIdUsuario").value;i.accion=employee.accion;i=JSON.stringify(i);let s=employee.accion==="nuevo"?"Save":"Update";$.ajax({type:"POST",url:`../../pages/Config/Employees.aspx/${s}`,data:i,contentType:"application/json; charset=utf-8",dataType:"json","async":!0,success:function(n){var t=n.d;if(t.CodigoError==0){employee.accion==="nuevo"&&$(".campo-imagen").each(function(n,i){let u=i.dataset.tipo,r;(r=this.files[0])&&utils.sendFileEmployee(r,"documento",t.IdItem,u,"empleado")});let n=employee.accion==="nuevo"?5e3:100;setTimeout(function(){utils.toast(mensajesAlertas.exitoGuardar,"ok");employee.init()},n)}else utils.toast(mensajesAlertas.errorGuardar,"error")},error:function(){utils.toast(mensajesAlertas.errorGuardar,"error")}})}});$(".campo-imagen").on("change",function(n){n.preventDefault();let t=n.currentTarget.dataset.tipo;if(employee.idSeleccionado!=="-1"&&employee.accion!=="nuevo"){let n;(n=this.files[0])&&(utils.sendFileEmployee(n,"update_document_employee",employee.idSeleccionado,t,"empleado"),setTimeout(function(){employee.getDocument(employee.idSeleccionado,t,`#img_${t}`)},5e3))}});$("#comboPosicion").on("change",n=>{n.preventDefault();let t=$("#comboPosicion").val();Number(t)===Number(POSICION_PROMOTOR)?($(".combo-supervisor").show(),$(".combo-ejecutivo").hide()):Number(t)===Number(POSICION_SUPERVISOR)?($(".combo-supervisor").hide(),$(".combo-ejecutivo").show()):($(".combo-supervisor").hide(),$(".combo-ejecutivo").hide())});$("#btnCancelar").on("click",n=>{n.preventDefault(),$(`.documentos`).attr("src","../../img/upload.png"),$("#panelTabla").show(),$("#panelForm").hide()});$("#btnEliminarAceptar").on("click",()=>{let n={};n.path=window.location.hostname;n.id=employee.idSeleccionado;n=JSON.stringify(n);$.ajax({type:"POST",url:"../../pages/Config/Employees.aspx/Delete",data:n,contentType:"application/json; charset=utf-8",dataType:"json","async":!0,success:function(n){var t=n.d;t.MensajeError===null?(utils.toast(mensajesAlertas.exitoEliminar,"ok"),employee.cargarItems()):utils.toast(t.MensajeError,"error")},error:function(n,t){console.log(t+": "+n.responseText)}})});$("#btnGuardarPassword").click(function(n){n.preventDefault();let t=$('form[name="frmUsuarioP"]').validator("validate").has(".has-error").length;if(!t){let n={};n.path=window.location.hostname;n.newPassword=$("#txtPassP").val();n.idEmpleado=employee.idSeleccionado;n.login=employee.login;n.idUsuario=document.getElementById("txtIdUsuario").value;n.accion=accion;n=JSON.stringify(n);$.ajax({type:"POST",url:"../../pages/Config/Employees.aspx/ChangePassword",data:n,contentType:"application/json; charset=utf-8",dataType:"json","async":!0,success:function(n){var t=parseInt(n.d);t>0?(utils.toast(mensajesAlertas.exitoPasswordModificada,"ok"),employee.cargarItems()):utils.toast(mensajesAlertas.errorInesperado,"fail");$("#panelEdicionPass").modal("hide")},error:function(n,t){console.log(t+": "+n.responseText)}})}})}};window.addEventListener("load",()=>{employee.init(),employee.accionesBotones()});