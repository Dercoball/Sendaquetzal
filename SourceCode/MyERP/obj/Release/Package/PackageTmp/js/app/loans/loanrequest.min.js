"use strict";let date=new Date,descargas="Prestamos"+date.getFullYear()+"_"+date.getMonth()+"_"+date.getUTCDay()+"_"+date.getMilliseconds(),pagina="12";const POSICION_DIRECTOR=1,POSICION_COORDINADOR=2,POSICION_EJECUTIVO=3,POSICION_SUPERVISOR=4,POSICION_PROMOTOR=5,client={init:()=>{$("#panelTabla").hide(),$("#panelForm").show(),client.idSeleccionado="-1",client.idTipoUsuario="-1",client.accion="nuevo",client.loadComboTipoCliente(),client.fechaHoy(),$(".combo-supervisor").hide(),$(".combo-ejecutivo").hide(),client.ClienteExistente=0,client.IdCliente=-1},cargarItems:()=>{let n={};n.path=window.location.hostname;n.idUsuario=document.getElementById("txtIdUsuario").value;n=JSON.stringify(n);$.ajax({type:"POST",url:"../../pages/Loans/LoanRequest.aspx/GetListaItems",data:n,contentType:"application/json; charset=utf-8",dataType:"json","async":!0,success:function(n){let t=n.d;t==null&&(window.location="../../pages/Index.aspx");let i=$("#table").DataTable({destroy:!0,processing:!0,order:[],data:t,columns:[{data:"IdCliente"},{data:"NombreCompleto"},{data:"TipoCliente"},{data:"Telefono"},{data:"Curp"},{data:"Ocupacion"},{data:"Monto"},{data:"FechaSolicitud"},{data:"Accion"}],language:textosEsp,columnDefs:[{targets:[-1],orderable:!1},],dom:"frtiplB",buttons:[{extend:"excelHtml5",title:descargas,text:"Xls",className:"excelbtn"},{extend:"pdfHtml5",title:descargas,text:"Pdf",className:"pdfbtn"}]})},error:function(n,t){console.log(t+": "+n.responseText)}})},"delete":n=>{client.idSeleccionado=n,$("#panelEliminar").modal("show")},fechaHoy(){let i=new Date,n=i.getDate();n=n.toString().length===1?`0${n}`:n;let t=i.getMonth()+1;t=t.toString().length===1?`0${t}`:t;$("#txtFechaSolicitud").val(`${i.getFullYear()}-${t}-${n}`)},edit:n=>{$(".form-group").removeClass("has-error");$(".help-block").empty();$("#frm")[0].reset();let t={};t.path=window.location.hostname;t.id=n;t=JSON.stringify(t);$.ajax({type:"POST",url:"../../pages/Loans/LoanRequest.aspx/GetDataClient",data:t,contentType:"application/json; charset=utf-8",dataType:"json","async":!0,success:function(n){var t=n.d;client.idSeleccionado=t.IdCliente;$("#txtNombre").val(t.Nombre);$("#txtPrimerApellido").val(t.PrimerApellido);$("#txtSegundoApellido").val(t.SegundoApellido);$("#txtCURP").val(t.Curp);$("#txtFechaSolicitud").val(t.FechaSolicitud);$("#txtTelefono").val(t.Telefono);$("#txtCantidadPrestamo").val(t.Monto);$("#txtOcupacion").val(t.Ocupacion);$("#comboTipoCliente").val(t.IdTipoCliente);$("#txtCalle").val(t.direccion.Calle);$("#txtColonia").val(t.direccion.Colonia);$("#txtMunicipio").val(t.direccion.Municipio);$("#txtEstado").val(t.direccion.Estado);$("#txtCodigoPostal").val(t.direccion.CodigoPostal);$("#txtDireccionTrabajo").val(t.direccion.DireccionTrabajo);$("#txtNombreAval").val(t.NombreAval);$("#txtPrimerApellidoAval").val(t.PrimerApellidoAval);$("#txtSegundoApellidoAval").val(t.SegundoApellidoAval);$("#txtCURPAval").val(t.CurpAval);$("#txtTelefonoAval").val(t.TelefonoAval);$("#txtOcupacionAval").val(t.OcupacionAval);$("#txtCalleAval").val(t.direccionAval.Calle);$("#txtColoniaAval").val(t.direccionAval.Colonia);$("#txtMunicipioAval").val(t.direccionAval.Municipio);$("#txtEstadoAval").val(t.direccionAval.Estado);$("#txtCodigoPostalAval").val(t.direccionAval.CodigoPostal);$("#txtDireccionTrabajoAval").val(t.direccionAval.DireccionTrabajo);$("#panelTabla").hide();$("#panelForm").show();client.accion="editar";$("#spnTituloForm").text("Editar");console.log(client.idSeleccionado);client.getDocument(client.idSeleccionado,2,"#img_2");client.getDocument(client.idSeleccionado,3,"#img_3");client.getDocument(client.idSeleccionado,4,"#img_4");client.getDocument(client.idSeleccionado,6,"#img_6");client.getDocument(client.idSeleccionado,7,"#img_7");client.getDocument(client.idSeleccionado,8,"#img_8")},error:function(n,t){console.log(t+": "+n.responseText)}})},getDocument(n,t,i){let r={};r.path=window.location.hostname;r.idCliente=n;r.idTipoDocumento=t;r=JSON.stringify(r);$.ajax({type:"POST",url:"../../pages/Loans/LoanRequest.aspx/GetDocument",data:r,contentType:"application/json; charset=utf-8",dataType:"json","async":!0,success:function(n){let r=n.d;r.IdDocumento?(r.Extension==="png"||r.Extension==="jpg"||r.Extension==="jpeg"||r.Extension==="bmp"?$(`${i}`).attr("src",`data:image/jpg;base64,${r.Contenido}`):r.Extension==="pdf"?$(`${i}`).attr("src","../../img/ico_pdf.png"):$(`${i}`).attr("src","../../img/ico_doc.png"),$(`#href_${t}`).css("cursor","pointer")):$(`#href_${t}`).css("cursor","default")},error:function(n,t){console.log(t+": "+n.responseText)}})},nuevo:()=>{$("#frm")[0].reset(),$(".form-group").removeClass("has-error"),$(".help-block").empty(),$("#spnTituloForm").text("Nuevo"),$("#txtDescripcion").val(""),$("#panelTabla").hide(),$("#panelForm").show(),client.accion="nuevo",client.idSeleccionado=-1,$(".deshabilitable").prop("disabled",!1)},testData(){$(".campo-combo").val(2);$(".campo-input").val(7);$(".campo-input").val(200+parseInt(Math.random()*1e3+1));$("#txtCantidadPrestamo").val(1e3+parseInt(Math.random()*1e3+1))},loadComboTipoCliente:()=>{var n={};n.path=window.location.hostname;n=JSON.stringify(n);$.ajax({type:"POST",url:"../../pages/Loans/LoanRequest.aspx/GetListaItemsTipoCliente",data:n,contentType:"application/json; charset=utf-8",dataType:"json","async":!0,success:function(n){let t=n.d,i='<option value="">Seleccione...<\/option>';for(let n=0;n<t.length;n++){let r=t[n];i+=`<option value = '${r.IdTipoCliente}' > ${r.NombreTipoCliente}</option > `}$("#comboTipoCliente").html(i)},error:function(n,t){console.log(t+": "+n.responseText)}})},accionesBotones:()=>{$(".img-document").on("click",function(n){n.preventDefault();let t=n.currentTarget.dataset.tipo;if(client.accion!=="nuevo"){let n={};n.path=window.location.hostname;n.idEmpleado=client.idSeleccionado;n.idTipoDocumento=t;n=JSON.stringify(n);$.ajax({type:"POST",url:"../../pages/Loans/LoanRequest.aspx/GetDocument",data:n,contentType:"application/json; charset=utf-8",dataType:"json","async":!0,success:function(n){let t=n.d;if(t.Contenido){let n=null;if(n=t.Extension==="png"||t.Extension==="jpg"||t.Extension==="jpeg"||t.Extension==="bmp"?utils.b64toBlob(t.Contenido,"data:image/png",512):t.Extension==="pdf"?utils.b64toBlob(t.Contenido,"data:document/pdf",512):utils.b64toBlob(t.Contenido,"",512),n){const r=URL.createObjectURL(n),i=document.createElement("a");i.href=r;i.setAttribute("download",t.Nombre+"."+t.Extension);document.body.appendChild(i);i.click();document.body.removeChild(i)}}},error:function(n,t){console.log(t+": "+n.responseText)}})}});$("#btnNuevo").on("click",n=>{n.preventDefault(),client.nuevo()});$("#btnGuardar").on("click",n=>{n.preventDefault();let e=$('form[name="frm"]').validator("validate").has(".has-error").length;if(e){$("#spnMensajes").html(mensajesAlertas.solicitudNoProcedenteCamposVacios);$("#panelMensajes").modal("show");return}$(".deshabilitable").prop("disabled",!0);$("#btnGuardar").html(`<i class="fa fa-paper-plane mr-1"></i>Guardando...`);let t={};t.IdCliente=client.IdCliente;t.FechaSolicitud=$("#txtFechaSolicitud").val();t.Monto=$("#txtCantidadPrestamo").val();t.IdTipoCliente=$("#comboTipoCliente").val()==null?0:$("#comboTipoCliente").val();t.Curp=$("#txtCURP").val();t.PrimerApellido=$("#txtPrimerApellido").val();t.SegundoApellido=$("#txtSegundoApellido").val();t.Nombre=$("#txtNombre").val();t.Telefono=$("#txtTelefono").val();t.Ocupacion=$("#txtOcupacion").val();t.OcupacionAval=$("#txtOcupacionAval").val();t.CurpAval=$("#txtCURPAval").val();t.PrimerApellidoAval=$("#txtPrimerApellidoAval").val();t.SegundoApellidoAval=$("#txtSegundoApellidoAval").val();t.NombreAval=$("#txtNombreAval").val();t.TelefonoAval=$("#txtTelefonoAval").val();t.ClienteExistente=client.ClienteExistente;let i={};i.IdCliente=client.IdCliente;i.Calle=$("#txtCalle").val();i.Aval=0;i.Colonia=$("#txtColonia").val();i.Municipio=$("#txtMunicipio").val();i.Estado=$("#txtEstado").val();i.CodigoPostal=$("#txtCodigoPostal").val();i.DireccionTrabajo=$("#txtDireccionTrabajo").val();let r={};r.IdCliente=client.IdCliente;r.Calle=$("#txtCalleAval").val();r.Aval=1;r.Colonia=$("#txtColoniaAval").val();r.Municipio=$("#txtMunicipioAval").val();r.Estado=$("#txtEstadoAval").val();r.CodigoPostal=$("#txtCodigoPostalAval").val();r.DireccionTrabajo=$("#txtDireccionTrabajoAval").val();let u={};u.path=window.location.hostname;u.item=t;u.itemAddress=i;u.itemAddressAval=r;u.idUsuario=document.getElementById("txtIdUsuario").value;u.accion=client.accion;u=JSON.stringify(u);let f=Number(client.ClienteExistente)!==0?"SaveLoanUpdateCustomer":"Save";console.log(`urlService = ${f}`);console.log(`client.ClienteExistente ${client.ClienteExistente}`);console.log(`client.IdCliente ${client.IdCliente}`);$.ajax({type:"POST",url:`../../pages/Loans/LoanRequest.aspx/${f}`,data:u,contentType:"application/json; charset=utf-8",dataType:"json","async":!0,success:function(n){let t=n.d;if(t==null&&(window.location="../../pages/Index.aspx"),parseInt(t.CodigoError)===0){$(".campo-imagen").each(function(n,i){let r=i.dataset.tipo;console.log(`idTipoDocumento  = ${r}`);let u;(u=this.files[0])&&(Number(client.ClienteExistente)!==0?utils.sendFileEmployee(u,"update_document_customer",t.IdItem,r,"cliente"):utils.sendFileEmployee(u,"documento",t.IdItem,r,"cliente"))});setTimeout(function(){utils.toast(mensajesAlertas.exitoGuardar,"ok");$("#spnMensajeControlado").html(mensajesAlertas.solicitudPrestamoEnviada);$("#panelMensajeControlado").modal("show");$(".deshabilitable").prop("disabled",!1);$("#btnGuardar").html(`<i class="fa fa-save mr-1"></i>Guardar`)},1e4)}else{$(".deshabilitable").prop("disabled",!1);$("#btnGuardar").html(`<i class="fa fa-save mr-1"></i>Guardar`);$("#spnMensajes").html(t.MensajeError);$("#panelMensajes").modal("show");utils.toast(mensajesAlertas.errorGuardar,"error");return}},error:function(){utils.toast(mensajesAlertas.errorGuardar,"error")}})});$("#btnCancelar").on("click",n=>{n.preventDefault(),$(`.documentos`).attr("src","../../img/upload.png"),window.location="LoansIndex.aspx"});$("#btnAceptarPanelMensajeControlado").on("click",n=>{n.preventDefault(),setTimeout(function(){console.log(`Retornnado a lista de prestamos`);window.location="LoansIndex.aspx"},2e3)});$("#txtCURP").on("change",n=>{n.preventDefault();let t={};t.path=window.location.hostname;t.curp=$("#txtCURP").val();t=JSON.stringify(t);$.ajax({type:"POST",url:"../../pages/Loans/LoanRequest.aspx/GetCustomerByCurp",data:t,contentType:"application/json; charset=utf-8",dataType:"json","async":!0,success:function(n){let t=n.d;t?(client.IdCliente=t.IdCliente,client.ClienteExistente=1,$("#txtNombre").val(t.Nombre),$("#txtPrimerApellido").val(t.PrimerApellido),$("#txtSegundoApellido").val(t.SegundoApellido),$("#txtTelefono").val(t.Telefono),$("#txtOcupacion").val(t.Ocupacion),$("#comboTipoCliente").val(t.IdTipoCliente),$("#txtCalle").val(t.direccion.Calle),$("#txtColonia").val(t.direccion.Colonia),$("#txtMunicipio").val(t.direccion.Municipio),$("#txtEstado").val(t.direccion.Estado),$("#txtCodigoPostal").val(t.direccion.CodigoPostal),$("#txtDireccionTrabajo").val(t.direccion.DireccionTrabajo),$("#txtNombreAval").val(t.NombreAval),$("#txtPrimerApellidoAval").val(t.PrimerApellidoAval),$("#txtSegundoApellidoAval").val(t.SegundoApellidoAval),$("#txtCURPAval").val(t.CurpAval),$("#txtTelefonoAval").val(t.TelefonoAval),$("#txtOcupacionAval").val(t.OcupacionAval),$("#txtCalleAval").val(t.direccionAval.Calle),$("#txtColoniaAval").val(t.direccionAval.Colonia),$("#txtMunicipioAval").val(t.direccionAval.Municipio),$("#txtEstadoAval").val(t.direccionAval.Estado),$("#txtCodigoPostalAval").val(t.direccionAval.CodigoPostal),$("#txtDireccionTrabajoAval").val(t.direccionAval.DireccionTrabajo),client.getDocument(t.IdCliente,2,"#img_2"),client.getDocument(t.IdCliente,3,"#img_3"),client.getDocument(t.IdCliente,4,"#img_4"),client.getDocument(t.IdCliente,6,"#img_6"),client.getDocument(t.IdCliente,7,"#img_7"),client.getDocument(t.IdCliente,8,"#img_8")):(client.IdCliente=-1,client.ClienteExistente=0,$(".campo-input").val(""),$(".campo-combo").val(""),$(`.documentos`).attr("src","../../img/upload.png"))},error:function(n,t){console.log(t+": "+n.responseText)}})})}};window.addEventListener("load",()=>{client.init(),client.accionesBotones()});