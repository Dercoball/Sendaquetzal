"use strict";let date=new Date,descargas="HistoricosOT_"+date.getFullYear()+"_"+date.getMonth()+"_"+date.getUTCDay()+"_"+date.getMilliseconds(),pagina="74";class RegistroFalla{constructor(n){this.IdRegistroFalla=n;this.IdEqúipo=null;this.FechaCreacion=null;this.Descripcion="";this.Orometro="";this.DetieneOperacion=!1}}const listadoGeneral={init:()=>{$("#alert-operacion-ok").hide(),$("#alert-operacion-fail").hide(),$("#panelTabla").show(),$("#panelForm").hide(),$("#panelTablaCerrados").hide(),listadoGeneral.idProveedorSeleccionado=-1,listadoGeneral.idEquipoSeleccionado=-1,listadoGeneral.idSeleccionado=-1,listadoGeneral.accion="",listadoGeneral.idUsuarioDiagnostico=-1,listadoGeneral.cargarItems(),datosEquipo.cargarComboMarcas(),datosEquipo.cargarComboEstatus(),listadoGeneral.cargarEmpleados(),datosEquipo.cargarComboUnidadesMedida()},cargarComboUbicaciones:n=>{console.log("cargarComboUbicaciones");console.log(`idUbicacion = ${n}`);var t={};t.path=window.location.hostname;t=JSON.stringify(t);$.ajax({type:"POST",url:"../pages/PanelEquipos.aspx/GetListaUbicaciones",data:t,contentType:"application/json; charset=utf-8",dataType:"json","async":!0,success:function(t){for(var r,u=t.d,f="",i=0;i<u.length;i++)r=u[i],f+='<option value="'+r.IdUbicacion+'">'+r.Nombre+"<\/option>";$("#comboUbicacion").html(f).promise().done(function(){$("#comboUbicacion").val(n)})},error:function(n,t){console.log(t+": "+n.responseText)}})},cargarItemsRefacciones:n=>{var t={};t.path=window.location.hostname;t.idUsuario=sessionStorage.getItem("idusuario");t.idRequisicion=n;t=JSON.stringify(t);$.ajax({type:"POST",url:"../pages/MantenimientoPanelSolicitudRefacciones.aspx/GetItems",data:t,contentType:"application/json; charset=utf-8",dataType:"json","async":!0,success:function(n){let t=$("#tablaRefacciones").DataTable({pageLength:50,destroy:!0,processing:!0,order:[],data:n.d,columns:[{data:"FechaFormateadaMx"},{data:"NombreMarca"},{data:"Cantidad"},{data:"NumeroParte"},{data:"Descripcion"},{data:"ValorCaptura"},],language:textosEsp,columnDefs:[{targets:[0,1,2,3,4],orderable:!1},],dom:"t"})},error:function(n,t){console.log(t+": "+n.responseText)}})},cargarItems:()=>{var n={};n.path=window.location.hostname;n.idUsuario=sessionStorage.getItem("idusuario");n.idTipoUsuario=sessionStorage.getItem("idtipousuario");n.mostrarSoloFinalizados=1;utils.postData("../pages/MantenimientoListadoFallas.aspx/GetListaItems",n).then(n=>{n=n.d;let t=$("#table").DataTable({destroy:!0,processing:!0,pageLength:10,order:[],data:n,columns:[{data:"IdRequisicion"},{data:"NumeroEconomico"},{data:"Accion"},{data:"NombreEquipo"},{data:"Descripcion"},{data:"FechaCreacionFormateada"},{data:"TiempoTranscurrido"},{data:"FechaCierreFormateada"},{data:"NombrePrioridad"},{data:"NombreUsuarioDiagnostico"},{data:"NombreStatus"},],language:textosEsp,columnDefs:[{targets:[-1],orderable:!1},],dom:"fBrtipl",buttons:[{extend:"csvHtml5",title:descargas,text:"&nbsp;Exportar Csv",className:"csvbtn"},{extend:"excelHtml5",title:descargas,text:"Xls",className:"excelbtn"},{extend:"pdfHtml5",title:descargas,text:"Pdf",className:"pdfbtn"}]})})},cargarEmpleados:()=>{var n={};n.path=window.location.hostname;n.idUsuario=sessionStorage.getItem("idusuario");n.like="";n=JSON.stringify(n);$.ajax({type:"POST",url:"../pages/MantenimientoPanelRegistroFallas.aspx/GetListaEmpleados",data:n,contentType:"application/json; charset=utf-8",dataType:"json","async":!0,success:function(n){var t=JSON.parse(n.d),i=new $.jqx.dataAdapter(t);$("#comboEmpleado").jqxDropDownList({source:i,displayMember:"Nombre",valueMember:"IdEmpleado",width:"350px",height:"20px",placeHolder:"Seleccione:",filterable:!0,searchMode:"containsignorecase",filterPlaceHolder:"Buscar"});$("#comboEmpleado").jqxDropDownList("clearSelection")},error:function(n,t){console.log(t+": "+n.responseText)}})},cargarItemsUsuarios:n=>{var t={};t.path=window.location.hostname;t.idUsuario=sessionStorage.getItem("idusuario");t.idRequisicion=n;t=JSON.stringify(t);$.ajax({type:"POST",url:"../pages/MantenimientoListadoFallas.aspx/GetItemsUsuarios",data:t,contentType:"application/json; charset=utf-8",dataType:"json","async":!0,success:function(n){var i,r;let t=n.d,u=``;for(i=0;i<t.length-1;i++)r=t[i],u+=`
							 <div class="row">



									<div class="form-group col-md-12">
										<label>
											${r.NombreUsuario}, ${r.FechaFormateadaMx}
										</label>
										<textarea class="form-control" rows="4" disabled="disabled">${r.Diagnostico}</textarea>
									</div>

								</div>
						`;$("#divDiagnosticos").empty().append(u);t[t.length-1]!=null&&t[t.length-1].NombreUsuario!=null&&$("#lblUsuarioDiagnosticoActual").text(`${t[t.length-1].NombreUsuario} (ACTUAL), ${t[t.length-1].FechaFormateadaMx}`)},error:function(n,t){console.log(t+": "+n.responseText)}})},reAbrir:n=>{listadoGeneral.idSeleccionado=n,$("#msgReAbrir").html('<p>Se va a re-abrir esta orden de trabajo y pasarla a status "En diagnostico" (No.'+n+"). ¿Desea continuar?<\/p>"),$("#panelReAbrir").modal("show")},abrir:n=>{$(".form-group").removeClass("has-error");$(".help-block").empty();var t={};t.path=window.location.hostname;t.id=n;t=JSON.stringify(t);$.ajax({type:"POST",url:"../pages/MantenimientoListadoFallas.aspx/GetItem",data:t,contentType:"application/json; charset=utf-8",dataType:"json","async":!0,success:function(t){var i=t.d;listadoGeneral.idSeleccionado=i.IdRequisicion;listadoGeneral.idEquipoSeleccionado=i.IdEquipo;listadoGeneral.idProveedorSeleccionado=i.IdProveedor;$("#txtNumeroRequisicion").val(i.IdRequisicion);$("#txtNombreEquipo").val(i.NombreEquipo);$("#txtNombreProveedor").val(i.NombreProveedor);$("#txtGeneradoPor").val(i.NombreUsuario);$("#txtNombreOperador").val(i.NombreOperador);$("#txtTelefono").val(i.Telefono);$("#comboUnidadMedidaOrometro").val(i.IdUnidadMedidaOrometro);listadoGeneral.cargarComboUbicaciones(i.IdUbicacion);$("#txtFechaCreacion").val(i.FechaCreacionFormateadaMx);$("#txtFechaCreacion").prop("fecha",i.FechaCreacion);$("#txtOrometro").val(i.Orometro);$("#chkDetieneOperacion").prop("checked",i.DetieneOperacion==1);$("#txtDescripcion").val(i.Descripcion);$("#txtNumeroEconomico").val(i.NumeroEconomico);$("#comboMarca").val(i.IdMarca);$("#comboPrioridad").val(i.IdNivelPrioridad);$("#txtDiagnostico").val(i.Diagnostico);$("#comboEmpleado").val(i.IdUsuarioDiagnostico);$("#comboEmpleado").jqxDropDownList({disabled:!0});datosEquipo.cargarComboModelos_(i.IdMarca,i.IdModelo);$("#txtPrioridadRojo").hide();$("#txtPrioridadAmarillo").hide();$("#txtPrioridadVerde").hide();switch(i.IdNivelPrioridad){case 1:$("#txtPrioridadRojo").show();break;case 2:$("#txtPrioridadAmarillo").show();break;case 3:$("#txtPrioridadVerde").show()}listadoGeneral.accion="editar";$("#spnTituloForm").text("Datos orden de trabajo");$(".deshabilitable").prop("disabled",!0);datosEquipo.odometro(i.IdEquipo);let r={path:window.location.hostname,id_requisicion:i.IdRequisicion,idUsuario:sessionStorage.getItem("idusuario"),id_tipo:1};utils.getDocumentos(r);listadoGeneral.cargarItemsUsuarios(n);listadoGeneral.cargarItemsRefacciones(n);$("#panelTabla").hide();$("#panelForm").show()},error:function(n,t){console.log(t+": "+n.responseText)}})},accionesBotones:()=>{$("#btnDescargar").on("click",n=>{n.preventDefault(),window.open(`../pages/Download.ashx?path=${window.location.hostname}&id_requisicion=${listadoGeneral.idSeleccionado}&tipo_descarga=3`)});$("#btnReAbrirAceptar").on("click",n=>{n.preventDefault();var t={};t.path=window.location.hostname;t.id=listadoGeneral.idSeleccionado;t=JSON.stringify(t);$.ajax({type:"POST",url:"../pages/MantenimientoListadoFallas.aspx/ReAbrirRequisicion",data:t,contentType:"application/json; charset=utf-8",dataType:"json","async":!0,success:function(n){var t=n.d;t.MensajeError===null?(utils.toast(mensajesAlertas.exitoOperacion,"ok"),listadoGeneral.cargarItems()):utils.toast(t.MensajeError,"error")},error:function(n,t){console.log(t+": "+n.responseText)}})});$("#btnAbrirSeleccionarEquipo").on("click",n=>{n.preventDefault(),listadoGeneral.cargarItemsEquipos(),$("#panelSeleccionarEquipo").modal("show")});$("#btnNuevo").on("click",n=>{n.preventDefault(),listadoGeneral.nuevo()});$("#btnGuardar").on("click",n=>{var r,t,i;if(n.preventDefault(),r=$('form[name="frm"]').validator("validate").has(".has-error").length,!r){if(listadoGeneral.idEquipoSeleccionado==-1){utils.toast(mensajesAlertas.errorSeleccionarEquipo,"error");return}t={};t.IdRequisicion=listadoGeneral.idSeleccionado;t.IdEquipo=listadoGeneral.idEquipoSeleccionado;t.Descripcion=$("#txtDescripcion").val();t.Orometro=$("#txtOrometro").val();t.Diagnostico=$("#txtDiagnostico").val();t.DetieneOperacion=$("#chkDetieneOperacion").prop("checked")==!0?1:0;t.IdNivelPrioridad=$("#comboPrioridad").val();t.IdUsuarioDiagnostico=$("#comboEmpleado").val()===null?"-1":$("#comboEmpleado").val();t.IdUsuarioDiagnosticoAnterior=listadoGeneral.IdUsuarioDiagnostico;i={};i.path=window.location.hostname;i.item=t;i.accion=listadoGeneral.accion;i=JSON.stringify(i);$.ajax({type:"POST",url:"../pages/MantenimientoListadoFallas.aspx/Guardar",data:i,contentType:"application/json; charset=utf-8",dataType:"json","async":!0,success:function(n){var t=n.d;t.CodigoError==0?(listadoGeneral.idSeleccionado=t.IdItem,$("#txtNumeroRequisicion").val(listadoGeneral.idSeleccionado),$(".file-documentos").each(function(){let n;(n=this.files[0])&&utils.sendFile(n,"documentos",t.IdItem,"documento")}),$("#spnMensajes").html(mensajesAlertas.exitoGuardar),$("#panelMensajes").modal("show"),listadoGeneral.cargarItems()):utils.toast(mensajesAlertas.errorGuardar,"error")},error:function(n,t){console.log(t+": "+n.responseText);utils.toast(mensajesAlertas.errorGuardar,"error")}})}});$("#btnAceptarPanelMensajes").on("click",n=>{n.preventDefault(),$("#panelMensajes").modal("hide"),$("#panelTabla").show(),$("#panelForm").hide()});$("#btnCancelar").on("click",n=>{n.preventDefault(),$("#panelTabla").show(),$("#panelForm").hide()});$("#btnEliminarAceptar").on("click",()=>{var n={};n.path=window.location.hostname;n.id=listadoGeneral.idSeleccionado;n=JSON.stringify(n);$.ajax({type:"POST",url:"../pages/MantenimientoPanelRegistroFallas.aspx/EliminarRequisicion",data:n,contentType:"application/json; charset=utf-8",dataType:"json","async":!0,success:function(n){var t=n.d;t.MensajeError===null?(utils.toast(mensajesAlertas.exitoEliminar,"ok"),listadoGeneral.cargarItems()):utils.toast(t.MensajeError,"error")},error:function(n,t){console.log(t+": "+n.responseText)}})});$("#btnEnviarAceptar").on("click",n=>{n.preventDefault();var t={};t.path=window.location.hostname;t.id=listadoGeneral.idSeleccionado;t=JSON.stringify(t);$.ajax({type:"POST",url:"../pages/MantenimientoPanelRegistroFallas.aspx/EnviarRequisicion",data:t,contentType:"application/json; charset=utf-8",dataType:"json","async":!0,success:function(n){var t=n.d;t.MensajeError===null?(utils.toast(mensajesAlertas.exitoEnviar,"ok"),listadoGeneral.cargarItems()):utils.toast(t.MensajeError,"error")},error:function(n,t){console.log(t+": "+n.responseText)}})})}};window.addEventListener("load",()=>{listadoGeneral.init(),listadoGeneral.accionesBotones()});