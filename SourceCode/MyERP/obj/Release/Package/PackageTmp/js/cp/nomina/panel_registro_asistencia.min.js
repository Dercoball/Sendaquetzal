"use strict";let date=new Date,descargas="RegistroAsistencia_"+date.getFullYear()+"_"+date.getMonth()+"_"+date.getUTCDay()+"_"+date.getMilliseconds(),pagina="64",prenomina={idPrenomina:-1,idObra:-1,prenomina:{},arrayData:[]};const panelPrenomina={init:()=>{panelPrenomina.idSeleccionado=-1,panelPrenomina.cargarItems()},cargarItems:()=>{console.log(`id del usuario logueado = ${sessionStorage.getItem("idusuario")}`);console.log(`id del empleado logueado = ${sessionStorage.getItem("idempleado")}`);var n={};n.path=window.location.hostname;n.idEmpleado=sessionStorage.getItem("idempleado");n.idUsuario=sessionStorage.getItem("idusuario");utils.postData("../pages/PanelRegistroAsistencia.aspx/GetListaObrasPorResidente",n).then(n=>{console.log(n);n=n.d;let t=$("#tableObras").DataTable({destroy:!0,processing:!0,order:[],data:n,columns:[{data:"ClaveObra"},{data:"NombreObra"},{data:"NombreStatus"},{data:"Accion"}],language:textosEsp,columnDefs:[{targets:[-1],orderable:!1},],dom:"frtiplB",buttons:[{extend:"excelHtml5",title:descargas,text:"Xls",className:"excelbtn"},{extend:"pdfHtml5",title:descargas,text:"Pdf",className:"pdfbtn"}]})})},eliminar:n=>{panelPrenomina.idSeleccionado=n,$("#panelEliminar").modal("show")},seleccionar:(n,t)=>{$("#table tbody").empty();$(".form-group").removeClass("has-error");$(".help-block").empty();prenomina.idObra=n;prenomina.idPrenomina=t;var i={};i.path=window.location.hostname;i.idObra=prenomina.idObra;i.idPrenomina=prenomina.idPrenomina;i=JSON.stringify(i);$.ajax({type:"POST",url:"../pages/PanelRegistroAsistencia.aspx/GetListaItemsAsistencia",data:i,contentType:"application/json; charset=utf-8",dataType:"json",async:!0,success:function(n){var t=n.d;if(t.table==="")console.log("No se pudo generar la tabla de prenomina");else{$("#table tbody").empty().append(t.Table);prenomina.arrayData=t.Array;prenomina.prenomina=t.prenomina;let r=prenomina.prenomina.IdStatusPrenomina===1||prenomina.prenomina.IdStatusPrenomina===2;$("#btnGuardar").attr("disabled",!r);$("#btnEnviar").attr("disabled",!r);$("#table").on("change","textarea",t=>{t.preventDefault();t.stopImmediatePropagation();let i=t.currentTarget.id,r=$("#"+i).val(),u=$("#"+i).hasClass("detalle-horas-extra"),f=$("#"+i).hasClass("observaciones");u===!0&&(prenomina.arrayData[n].DetalleHorasExtra=r);f===!0&&(prenomina.arrayData[n].Observaciones=r)});$("#table").on("change","input",t=>{t.preventDefault();t.stopImmediatePropagation();let i=t.currentTarget.id,r=$("#"+i).val(),u=$("#"+i).hasClass("numero-horas-extra"),f=$("#"+i).hasClass("monto-viaticos");u===!0&&(prenomina.arrayData[n].NumeroHorasExtra=r);f===!0&&(prenomina.arrayData[n].MontoViaticos=r)});$("#table").on("change","select",t=>{t.preventDefault();t.stopImmediatePropagation();var u=t.currentTarget.id;let r=$("#"+u).attr("data-empleado"),i=6;$(".clave_"+r).each(function(t,r){let e=$(r).attr("id"),f=$(r).attr("data-dia"),u=$("#"+e).val();u!=="1"&&u!=="10"&&i--;f==="jue"&&(prenomina.arrayData[n].ValorJue=u);f==="vie"&&(prenomina.arrayData[n].ValorVie=u);f==="sab"&&(prenomina.arrayData[n].ValorSab=u);f==="dom"&&(prenomina.arrayData[n].ValorDom=u);f==="lun"&&(prenomina.arrayData[n].ValorLun=u);f==="mar"&&(prenomina.arrayData[n].ValorMar=u);f==="mie"&&(prenomina.arrayData[n].ValorMie=u);prenomina.arrayData[n].NumeroDias=i});$("#txtNumDias_"+r).val(i)});let n=-1;$("#table").on("click","tbody tr",function(){n=$(this).index();$(this).hasClass("selected")?$(this).removeClass("selected"):(u.$("tr.selected").removeClass("selected"),$(this).addClass("selected"))});let i="Asistencia_"+date.getFullYear()+"_"+date.getMonth()+"_"+date.getUTCDay()+"_"+date.getMilliseconds(),u=$("#table").DataTable({destroy:!0,pageLength:25,lengthMenu:[[10,25,50,-1],[10,25,50,"All"]],processing:!0,order:[],language:textosEsp,columnDefs:[{targets:[-1,-2,-3,-4,-5,-6,-7,-8,-9,-10,-11,-12,-13],orderable:!1},],dom:"fBrtipl",buttons:[{extend:"csvHtml5",title:i,text:"&nbsp;Exportar Csv",className:"csvbtn"},{extend:"excelHtml5",title:i,text:"Xls",className:"excelbtn"},{extend:"pdfHtml5",title:i,text:"Pdf",className:"pdfbtn"}]});$('#nav-tab a[href="#nav-empleados"]').tab("show")}},error:function(n,t){console.log(t+": "+n.responseText)}})},nuevo:()=>{$("#frm")[0].reset(),$(".form-group").removeClass("has-error"),$(".help-block").empty(),$("#spnTituloForm").text("Nuevo"),$("#txtDescripcion").val(""),panelPrenomina.accion="nuevo",panelPrenomina.idSeleccionado=-1,$(".deshabilitable").prop("disabled",!1),obtenerFechaHoraServidor("txtFechaCreacion")},accionesBotones:()=>{$("#nav-tab a").on("click",function(n){n.preventDefault();n.stopImmediatePropagation()});$("#btnNuevo").on("click",n=>{n.preventDefault(),panelPrenomina.nuevo()});$("#btnSeleccionarSemana").on("click",n=>{n.preventDefault();console.log("asignar semana");let t=$("#txtNumSemana").val();$(".num-semana").text(t)});$("#btnGuardar").on("click",n=>{n.preventDefault();$("#panelLoading").modal("show");let t={};t.path=window.location.hostname;t.data=prenomina.arrayData;t.idObra=prenomina.idObra;t.idPrenomina=prenomina.idPrenomina;t.idUsuario=sessionStorage.getItem("idusuario");t.idEmpleado=sessionStorage.getItem("idempleado");t.accion="guardar";t=JSON.stringify(t);$.ajax({type:"POST",url:"../pages/PanelRegistroAsistencia.aspx/Guardar",data:t,contentType:"application/json; charset=utf-8",dataType:"json",async:!0,success:function(n){var t=n.d;setTimeout(()=>{$("#panelLoading").modal("hide")},2e3);t.CodigoError==0?(utils.toast(mensajesAlertas.exitoGuardar,"ok"),$('#nav-tab a[href="#nav-obras"]').tab("show"),panelPrenomina.cargarItems()):utils.toast(mensajesAlertas.errorGuardar,"error")},error:function(){$("#panelLoading").modal("hide");utils.toast(mensajesAlertas.errorGuardar,"error")}})});$("#btnAceptarEnviar").on("click",n=>{n.preventDefault();$("#panelLoading").modal("show");let t={};t.path=window.location.hostname;t.data=prenomina.arrayData;t.idObra=prenomina.idObra;t.idPrenomina=prenomina.idPrenomina;t.idUsuario=sessionStorage.getItem("idusuario");t.idEmpleado=sessionStorage.getItem("idempleado");t.accion="enviar";t=JSON.stringify(t);$.ajax({type:"POST",url:"../pages/PanelRegistroAsistencia.aspx/Enviar",data:t,contentType:"application/json; charset=utf-8",dataType:"json",async:!0,success:function(n){var t=n.d;setTimeout(()=>{$("#panelLoading").modal("hide"),$('#nav-tab a[href="#nav-obras"]').tab("show")},2e3);t.CodigoError==0?(utils.toast(mensajesAlertas.exitoGuardar,"ok"),panelPrenomina.cargarItems()):utils.toast(mensajesAlertas.errorGuardar,"error")},error:function(){$("#panelLoading").modal("hide");utils.toast(mensajesAlertas.errorGuardar,"error")}})});$("#btnEnviar").on("click",n=>{n.preventDefault(),$("#panelEnviar").modal("show")});$("#btnCancelar").on("click",n=>{n.preventDefault(),$('#nav-tab a[href="#nav-obras"]').tab("show")});$("#btnEliminarAceptar").on("click",()=>{var n={};n.path=window.location.hostname;n.id=panelPrenomina.idSeleccionado;n=JSON.stringify(n);$.ajax({type:"POST",url:"../pages/PanelRegistroAsistencia.aspx/Eliminar",data:n,contentType:"application/json; charset=utf-8",dataType:"json",async:!0,success:function(n){var t=n.d;t.MensajeError===null?(utils.toast(mensajesAlertas.exitoEliminar,"ok"),panelPrenomina.cargarItems()):utils.toast(t.MensajeError,"error")},error:function(n,t){console.log(t+": "+n.responseText)}})})}};window.addEventListener("load",()=>{panelPrenomina.init(),panelPrenomina.accionesBotones()});