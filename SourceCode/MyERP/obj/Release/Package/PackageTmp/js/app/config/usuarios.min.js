function editar(n){$(".form-group").removeClass("has-error");$(".help-block").empty();accion="nuevo";var t={};t.path=window.location.hostname;t.id=n;t=JSON.stringify(t);$.ajax({type:"POST",url:"../pages/Usuarios.aspx/GetUsuario",data:t,contentType:"application/json; charset=utf-8",dataType:"json",async:!0,success:function(n){var t=n.d;$("#txtNombre").val(t.Nombre);$("#txtLogin").val(t.Login);$("#txtEmail").val(t.Email);$("#txtTelefono").val(t.Telefono);$("#txtPass").val(t.Password);$("#comboTipoUsuario").val(t.IdTipoUsuario);$("#comboEmpleado").jqxDropDownList("clearSelection");$("#comboEmpleado").val(t.IdEmpleado);$("#comboProveedor").val(t.IdProveedor);idSeleccionado=t.Id_Usuario;accion="editar";$("#spnTituloForm").text("Editar");$("#comboTipoUsuario").val()==="2"?($("#divProveedores").show(),$("#divEmpleados").hide()):($("#divEmpleados").show(),$("#divProveedores").hide());$("#panelTabla").hide();$("#panelForm").show()},error:function(n,t){console.log(t+": "+n.responseText)}})}function editarP(n){$(".form-group").removeClass("has-error");$(".help-block").empty();accion="editar";var t={};t.path=window.location.hostname;t.id=n;t=JSON.stringify(t);$.ajax({type:"POST",url:"Usuarios.aspx/GetUsuario",data:t,contentType:"application/json; charset=utf-8",dataType:"json",async:!0,success:function(n){var t=n.d;$("#txtLoginP").val(t.Login);$("#txtPassP").val("");idSeleccionado=t.Id_Usuario;accion="editar";$("#panelEdicionPass").modal("show")},error:function(n,t){console.log(t+": "+n.responseText)}})}function eliminar(n){idSeleccionado=n;$("#panelEliminar").modal("show")}function permisos(n,t){idSeleccionado=n;$("#spnNombreUsuario").text(t);$("#spnIdUsuario").text(n);cargarListaPermisos();cargarListaPermisosUsuario();$("#panelPermisos").modal("show")}function cargarListaPermisos(){var n={};n.path=window.location.hostname;n.idUsuario=$("#spnIdUsuario").text();n=JSON.stringify(n);$.ajax({type:"POST",url:"../pages/Usuarios.aspx/ObtenerListaPermisos",data:n,contentType:"application/json; charset=utf-8",dataType:"json",async:!0,success:function(n){for(var i,r=n.d,u="",t=0;t<r.length;t++)i=r[t],u+='<option value="'+i.IdPermiso+'">'+i.Nombre+"<\/option>";$("#listaPermisos").empty().append(u)},error:function(n,t){console.log(t+": "+n.responseText)}})}function cargarListaPermisosUsuario(){var n={};n.path=window.location.hostname;n.idUsuario=$("#spnIdUsuario").text();n=JSON.stringify(n);$.ajax({type:"POST",url:"../pages/Usuarios.aspx/ObtenerListaPermisosPorUsuario",data:n,contentType:"application/json; charset=utf-8",dataType:"json",async:!0,success:function(n){for(var i,r=n.d,u="",t=0;t<r.length;t++)i=r[t],u+='<option value="'+i.IdPermiso+'">'+i.Nombre+"<\/option>";$("#listaPermisosSeleccionados").empty().append(u)},error:function(n,t){console.log(t+": "+n.responseText)}})}function nuevo(){$("#frm")[0].reset();$(".form-group").removeClass("has-error");$(".help-block").empty();$("#spnTituloForm").text("Nuevo");idSelecccionado=-1;$("#panelTabla").hide();$("#panelForm").show();accion="nuevo";id="-1";$("#divProveedores").hide();$("#comboEmpleado").jqxDropDownList("clearSelection")}var accion="",idSeleccionado="-1",table,date=new Date,descargas="Usuarios_"+date.getFullYear()+"_"+date.getMonth()+"_"+date.getUTCDay()+"_"+date.getMilliseconds(),pagina="9";$(document).ready(function(){function n(){var n={};n.path=window.location.hostname;n.idUsuario=sessionStorage.getItem("idusuario");n=JSON.stringify(n);$.ajax({type:"POST",url:"../pages/Usuarios.aspx/GetListaUsuarios",data:n,contentType:"application/json; charset=utf-8",dataType:"json",async:!0,success:function(n){table=$("#table").DataTable({destroy:!0,processing:!0,order:[],data:n.d,columns:[{data:"Nombre"},{data:"Login"},{data:"NombreTipoUsuario"},{data:"Accion"}],language:textosEsp,columnDefs:[{targets:[-1],orderable:!1}],dom:"fBrtip",buttons:[{extend:"csvHtml5",title:descargas,text:"&nbsp;Exportar Csv",className:"csvbtn"},{extend:"pdfHtml5",title:descargas,text:"Xls",className:"pdfbtn"}]})},error:function(n,t){console.log(t+": "+n.responseText)}})}function t(){var n={};n.path=window.location.hostname;n=JSON.stringify(n);$.ajax({type:"POST",url:"../pages/Usuarios.aspx/GetListaTiposUsuario",data:n,contentType:"application/json; charset=utf-8",dataType:"json",async:!0,success:function(n){for(var i,r="",u=n.d,t=0;t<u.length;t++)i=u[t],r+='<option value="'+i.IdTipoUsuario+'">'+i.Nombre+"<\/option>";$("#comboTipoUsuario").empty().append(r)},error:function(n,t){console.log(t+": "+n.responseText)}})}function i(){var n={};n.path=window.location.hostname;n.idUsuario=sessionStorage.getItem("idusuario");n=JSON.stringify(n);$.ajax({type:"POST",url:"../pages/Usuarios.aspx/GetListaProveedores",data:n,contentType:"application/json; charset=utf-8",dataType:"json",async:!0,success:function(n){for(var i,r="",u=n.d,t=0;t<u.length;t++)i=u[t],r+='<option value="'+i.IdProveedor+'">'+i.Nombre+"<\/option>";$("#comboProveedor").empty().append(r)},error:function(n,t){console.log(t+": "+n.responseText)}})}function r(){var n={};n.path=window.location.hostname;n.idUsuario=sessionStorage.getItem("idusuario");n.like="";n=JSON.stringify(n);$.ajax({type:"POST",url:"../pages/Usuarios.aspx/GetListaEmpleados",data:n,contentType:"application/json; charset=utf-8",dataType:"json",async:!0,success:function(n){var t=JSON.parse(n.d),i=new $.jqx.dataAdapter(t);$("#comboEmpleado").jqxDropDownList({source:i,displayMember:"NombreCompleto",valueMember:"IdEmpleado",width:"350px",height:"20px",placeHolder:"Seleccione:",filterable:!0,searchMode:"containsignorecase",filterPlaceHolder:"Buscar"});$("#comboEmpleado").jqxDropDownList("clearSelection")},error:function(n,t){console.log(t+": "+n.responseText)}})}n();$("#panelTabla").show();$("#panelForm").hide();$("#btnNuevo").on("click",function(n){n.preventDefault();nuevo()});$("#btnGuardar").click(function(t){t.preventDefault();var i=$('form[name="frm"]').validator("validate").has(".has-error").length;if(!i){$("#comboTipoUsuario").val()==="2"&&$("#comboProveedor").val()==null&&toastr(mensajesAlertas.errorSeleccionarProveedorUsuario,"error");return new Promise(t=>{var i={},r;i.Id_Usuario=idSeleccionado;i.Nombre=$("#txtNombre").val();i.Login=$("#txtLogin").val();i.Password=$("#txtPass").val();i.Email=$("#txtEmail").val();i.Telefono=$("#txtTelefono").val();i.IdTipoUsuario=$("#comboTipoUsuario").val();i.IdProveedor=$("#comboProveedor").val()===null?"-1":$("#comboProveedor").val();i.IdEmpleado=$("#comboEmpleado").val()===""?"-1":$("#comboEmpleado").val();r={};r.path=window.location.hostname;r.usuario=i;r.accion=accion;r=JSON.stringify(r);$.ajax({type:"POST",url:"../pages/Usuarios.aspx/GuardarUsuario",data:r,contentType:"application/json; charset=utf-8",dataType:"json",async:!0,success:function(i){var r=parseInt(i.d);r>0?(utils.toast(mensajesAlertas.exitoGuardar,"ok"),$("#panelTabla").show(),$("#panelForm").hide(),n(),t(mensajesAlertas.exitoGuardar)):(utils.toast(mensajesAlertas.errorGuardar,"fail"),regect(mensajesAlertas.errorGuardar));$("#panelEdicion").modal("hide")},error:function(n,t){console.log(t+": "+n.responseText);regect(mensajesAlertas.errorGuardar);utils.toast(mensajesAlertas.errorGuardar,"fail")}})})}});$("#btnGuardarP").click(function(t){var u,r,i;t.preventDefault();u=$('form[name="frmUsuarioP"]').validator("validate").has(".has-error").length;u||(r={},r.Id_Usuario=idSeleccionado,r.Password=$("#txtPassP").val(),i={},i.path=window.location.hostname,i.usuario=r,i.accion=accion,i=JSON.stringify(i),$.ajax({type:"POST",url:"Usuarios.aspx/GuardarUsuarioP",data:i,contentType:"application/json; charset=utf-8",dataType:"json",async:!0,success:function(t){var i=parseInt(t.d);i>0?(utils.toast(mensajesAlertas.exitoPasswordModificada,"ok"),table.destroy(),n()):utils.toast(mensajesAlertas.errorInesperado,"fail");$("#panelEdicionPass").modal("hide")},error:function(n,t){console.log(t+": "+n.responseText)}}))});$("#btnCancelar").click(function(n){n.preventDefault();$("#panelTabla").show();$("#panelForm").hide()});$("#btnEliminarAceptar").click(function(t){t.preventDefault();var i={};i.path=window.location.hostname;i.id=idSeleccionado;i=JSON.stringify(i);$.ajax({type:"POST",url:"../pages/Usuarios.aspx/EliminarUsuario",data:i,contentType:"application/json; charset=utf-8",dataType:"json",async:!0,success:function(t){var i=t.d;i>0?(utils.toast(mensajesAlertas.exitoEliminar,"ok"),table.destroy(),n()):utils.toast(mensajesAlertas.errorEliminar,"fail")},error:function(n,t){console.log(t+": "+n.responseText)}})});$("#comboTipoUsuario").on("change",n=>{n.preventDefault(),console.log("change"),$("#comboTipoUsuario").val()==="2"?($("#divProveedores").show(),$("#divEmpleados").hide()):($("#divEmpleados").show(),$("#divProveedores").hide())});t();i();r();$("#btnQuitar").click(function(n){n.preventDefault();$("#listaPermisosSeleccionados option:selected").each(function(){var n=$(this).val(),t=$(this).text(),i;console.log("permiso value = "+n);console.log("permiso text = "+t);i='<option value="'+n+'">'+t+"<\/option>";$("#listaPermisos").append(i);$("#listaPermisosSeleccionados option[value='"+n+"']").remove()})});$("#btnAgregar").click(function(n){n.preventDefault();$("#listaPermisos option:selected").each(function(){var n=$(this).val(),t=$(this).text(),i;console.log("permiso value = "+n);console.log("permiso text = "+t);i='<option value="'+n+'">'+t+"<\/option>";$("#listaPermisosSeleccionados").append(i);$("#listaPermisos option[value='"+n+"']").remove()})});$("#btnAgregarTodos").click(function(n){n.preventDefault();var t={};t.idUsuario=$("#spnIdUsuario").text();t.path=window.location.hostname;t=JSON.stringify(t);$.ajax({type:"POST",url:"../pages/Usuarios.aspx/ObtenerTodosLosPermisos",data:t,contentType:"application/json; charset=utf-8",dataType:"json",async:!0,success:function(n){for(var i,r=n.d,u="",t=0;t<r.length;t++)i=r[t],u+='<option value="'+i.IdPermiso+'">'+i.Nombre+"<\/option>";$("#listaPermisos").empty();$("#listaPermisosSeleccionados").empty().append(u)},error:function(n,t){console.log(t+": "+n.responseText)}})});$("#btnQuitarTodos").click(function(n){n.preventDefault();var t={};t.path=window.location.hostname;t=JSON.stringify(t);$.ajax({type:"POST",url:"../pages/Usuarios.aspx/ObtenerTodosLosPermisos",data:t,contentType:"application/json; charset=utf-8",dataType:"json",async:!0,success:function(n){for(var i,r=n.d,u="",t=0;t<r.length;t++)i=r[t],u+='<option value="'+i.IdPermiso+'">'+i.Nombre+"<\/option>";$("#listaPermisosSeleccionados").empty();$("#listaPermisos").empty().append(u)},error:function(n,t){console.log(t+": "+n.responseText)}})});$("#btnGuardarPermisos").click(function(n){var i,t;console.log("Boton guardarP");n.preventDefault();i=[];$("#listaPermisosSeleccionados option").each(function(){var n={};n.IdPermiso=$(this).val();n.IdUsuario=$("#spnIdUsuario").text();i.push(n)});t={};t.path=window.location.hostname;t.listaPermisos=i;t.idUsuario=$("#spnIdUsuario").text();t=JSON.stringify(t);$.ajax({type:"POST",url:"Usuarios.aspx/GuardarPermisosUsuario",data:t,contentType:"application/json; charset=utf-8",dataType:"json",async:!0,success:function(n){var t=parseInt(n.d);t>0?utils.toast(mensajesAlertas.exitoGuardar,"ok"):utils.toast(mensajesAlertas.errorGuardar,"ok");$("#panelPermisos").modal("hide")},error:function(n,t){console.log(t+": "+n.responseText)}})})});