"use strict";let date=new Date,descargas="ListadoGeneral_"+date.getFullYear()+"_"+date.getMonth()+"_"+date.getUTCDay()+"_"+date.getMilliseconds(),pagina="67";class RegistroFalla{constructor(n){this.IdRegistroFalla=n;this.IdEqúipo=null;this.FechaCreacion=null;this.Descripcion="";this.Orometro="";this.DetieneOperacion=!1}}const listadoGeneral={init:()=>{$("#alert-operacion-ok").hide();$("#alert-operacion-fail").hide();$("#panelTabla").show();$("#panelForm").hide();$("#panelTablaCerrados").hide();$("#panelTablaRefacciones").show();listadoGeneral.idProveedorSeleccionado=-1;listadoGeneral.idEquipoSeleccionado=-1;listadoGeneral.idSeleccionado=-1;listadoGeneral.accion="";listadoGeneral.idUsuarioDiagnostico=-1;listadoGeneral.cargarItems();listadoGeneral.cargarComboMarcas();datosEquipo.cargarComboEstatus();listadoGeneral.cargarEmpleados();datosEquipo.cargarComboUnidadesMedida();let n=utils.parseURLParams(window.location.href);if(n!=null&&n.id!==undefined){let t=n.id[0];listadoGeneral.abrir(t)}},cargarItems:()=>{var n={};n.path=window.location.hostname;n.idUsuario=sessionStorage.getItem("idusuario");n.idTipoUsuario=sessionStorage.getItem("idtipousuario");n.mostrarSoloFinalizados=0;utils.postData("../pages/MantenimientoListadoFallas.aspx/GetListaItems",n).then(n=>{n=n.d;let t=$("#table").DataTable({destroy:!0,processing:!0,pageLength:10,order:[],data:n,columns:[{data:"IdRequisicion"},{data:"NumeroEconomico"},{data:"Accion"},{data:"NombreEquipo"},{data:"Descripcion"},{data:"FechaCreacionFormateada"},{data:"TiempoTranscurrido"},{data:"NombrePrioridad"},{data:"NombreUsuarioDiagnostico"},{data:"NombreStatus"},],language:textosEsp,columnDefs:[{targets:[-1],orderable:!1},],dom:"fBrtipl",buttons:[{extend:"csvHtml5",title:descargas,text:"&nbsp;Exportar Csv",className:"csvbtn"},{extend:"excelHtml5",title:descargas,text:"Xls",className:"excelbtn"},{extend:"pdfHtml5",title:descargas,text:"Pdf",className:"pdfbtn"}]})})},cargarEmpleados:()=>{var n={};n.path=window.location.hostname;n.idUsuario=sessionStorage.getItem("idusuario");n.like="";n=JSON.stringify(n);$.ajax({type:"POST",url:"../pages/MantenimientoPanelRegistroFallas.aspx/GetListaEmpleados",data:n,contentType:"application/json; charset=utf-8",dataType:"json","async":!0,success:function(n){var i=JSON.parse(n.d),t=new $.jqx.dataAdapter(i);$("#comboEmpleado").jqxDropDownList({source:t,displayMember:"Nombre",valueMember:"IdEmpleado",width:"350px",height:"20px",placeHolder:"Seleccione:",filterable:!0,searchMode:"containsignorecase",filterPlaceHolder:"Buscar"});$("#comboEmpleado").jqxDropDownList("clearSelection");$("#comboAsignarColaborador").jqxDropDownList({source:t,displayMember:"Nombre",valueMember:"IdEmpleado",width:"350px",height:"20px",placeHolder:"Seleccione:",filterable:!0,searchMode:"containsignorecase",filterPlaceHolder:"Buscar"});$("#comboAsignarColaborador").jqxDropDownList("clearSelection")},error:function(n,t){console.log(t+": "+n.responseText)}})},cargarItemsUsuarios:n=>{var t={};t.path=window.location.hostname;t.idUsuario=sessionStorage.getItem("idusuario");t.idRequisicion=n;t=JSON.stringify(t);$.ajax({type:"POST",url:"../pages/MantenimientoListadoFallas.aspx/GetItemsUsuarios",data:t,contentType:"application/json; charset=utf-8",dataType:"json","async":!0,success:function(n){var i,r;console.log(`items`);let t=n.d,u=``;for(i=0;i<t.length-1;i++)r=t[i],u+=`
							 <div class="row">



									<div class="form-group col-md-12">
										<label>
											${r.NombreUsuario}, ${r.FechaFormateadaMx}
										</label>
										<textarea class="form-control" rows="4" disabled="disabled">${r.Diagnostico}</textarea>
									</div>

								</div>
						`;$("#divDiagnosticos").empty().append(u);t[t.length-1]!=null&&t[t.length-1].NombreUsuario!=null&&$("#lblUsuarioDiagnosticoActual").text(`${t[t.length-1].NombreUsuario} (ACTUAL), ${t[t.length-1].FechaFormateadaMx}`)},error:function(n,t){console.log(t+": "+n.responseText)}})},cargarComboMarcas:()=>{var n={};n.path=window.location.hostname;n=JSON.stringify(n);$.ajax({type:"POST",url:"../pages/Proyectos.aspx/GetListaMarcas",data:n,contentType:"application/json; charset=utf-8",dataType:"json","async":!0,success:function(n){var i=n.d,r="",t,u,f;for(r+='<option value=""><\/option>',t=0;t<i.length;t++)u=i[t],r+='<option value="'+u.Id_Marca+'">'+u.Nombre+"<\/option>";$("#comboMarca").empty().append(r);f=new $.jqx.dataAdapter(i);$("#comboMarcaProveedor").jqxDropDownList({source:f,displayMember:"Nombre",valueMember:"Id_Marca",width:"250px",height:"20px",placeHolder:"Seleccione:",filterable:!0,searchMode:"containsignorecase",filterPlaceHolder:"Buscar"});$("#comboMarcaProveedor").jqxDropDownList("clearSelection")},error:function(n,t){console.log(t+": "+n.responseText)}})},eliminar:n=>{listadoGeneral.idSeleccionado=n,$("#msgEliminar").html("<p>Se va a eliminar esta orden de trabajo  (No."+n+"). ¿Desea continuar?<\/p>"),$("#panelEliminar").modal("show")},reAbrir:n=>{listadoGeneral.idSeleccionado=n,$("#msgReAbrir").html('<p>Se va a re-abrir esta orden de trabajo y pasarla a status "En diagnostico" (No.'+n+"). ¿Desea continuar?<\/p>"),$("#panelReAbrir").modal("show")},abrir:n=>{$(".form-group").removeClass("has-error");$(".help-block").empty();var t={};t.path=window.location.hostname;t.id=n;t=JSON.stringify(t);$.ajax({type:"POST",url:"../pages/MantenimientoListadoFallas.aspx/GetItem",data:t,contentType:"application/json; charset=utf-8",dataType:"json","async":!0,success:function(t){var i=t.d;listadoGeneral.idSeleccionado=i.IdRequisicion;listadoGeneral.idEquipoSeleccionado=i.IdEquipo;listadoGeneral.idProveedorSeleccionado=i.IdProveedor;$("#txtNumeroRequisicion").val(i.IdRequisicion);$("#txtNombreEquipo").val(i.NombreEquipo);$("#txtGeneradoPor").val(i.NombreUsuario);$("#txtNombreOperador").val(i.NombreOperador);$("#txtTelefono").val(i.Telefono);$("#comboUnidadMedidaOrometro").val(i.IdUnidadMedidaOrometro);datosEquipo.cargarComboUbicaciones(i.IdUbicacion);$("#txtFechaCreacion").val(i.FechaCreacionFormateadaMx);$("#txtFechaCreacion").prop("fecha",i.FechaCreacion);$("#txtOrometro").val(i.Orometro);$("#chkDetieneOperacion").prop("checked",i.DetieneOperacion==1);$("#txtDescripcion").val(i.Descripcion);$("#txtNumeroEconomico").val(i.NumeroEconomico);$("#comboMarca").val(i.IdMarca);$("#comboPrioridad").val(i.IdNivelPrioridad);$("#txtDiagnostico").val(i.Diagnostico);$("#comboEmpleado").val(i.IdUsuarioDiagnostico);$("#comboEmpleado").jqxDropDownList({disabled:!0});datosEquipo.cargarComboModelos(i.IdMarca,i.IdModelo);$("#txtPrioridadRojo").hide();$("#txtPrioridadAmarillo").hide();$("#txtPrioridadVerde").hide();switch(i.IdNivelPrioridad){case 1:$("#txtPrioridadRojo").show();break;case 2:$("#txtPrioridadAmarillo").show();break;case 3:$("#txtPrioridadVerde").show()}listadoGeneral.accion="editar";$("#spnTituloForm").text("Datos orden de trabajo");datosEquipo.odometro(i.IdEquipo);let r={path:window.location.hostname,id_requisicion:i.IdRequisicion,idUsuario:sessionStorage.getItem("idusuario"),id_tipo:1};utils.getDocumentos(r);listadoGeneral.cargarItemsUsuarios(n);registroPanelRefacciones.idRequisicionSeleccionada=i.IdRequisicion;registroPanelRefacciones.cargarItems(i.IdRequisicion);$("#panelTablaRefacciones").show();$("#panelTabla").hide();$("#panelForm").show();$(".deshabilitable").prop("disabled",!0)},error:function(n,t){console.log(t+": "+n.responseText)}})},editar:n=>{$(".form-group").removeClass("has-error");$(".help-block").empty();$("#divDocumentos").empty();var t={};t.path=window.location.hostname;t.id=n;t=JSON.stringify(t);$.ajax({type:"POST",url:"../pages/MantenimientoListadoFallas.aspx/GetItem",data:t,contentType:"application/json; charset=utf-8",dataType:"json","async":!0,success:function(t){var i=t.d;listadoGeneral.idSeleccionado=i.IdRequisicion;listadoGeneral.idEquipoSeleccionado=i.IdEquipo;$("#txtNumeroRequisicion").val(i.IdRequisicion);$("#txtNombreEquipo").val(i.NombreEquipo);$("#txtGeneradoPor").val(i.NombreUsuario);$("#txtNombreOperador").val(i.NombreOperador);$("#txtTelefono").val(i.Telefono);$("#comboUnidadMedidaOrometro").val(i.IdUnidadMedidaOrometro);datosEquipo.cargarComboUbicaciones(i.IdUbicacion);$("#txtFechaCreacion").val(i.FechaCreacionFormateadaMx);$("#txtFechaCreacion").prop("fecha",i.FechaCreacion);$("#txtOrometro").val(i.Orometro);$("#chkDetieneOperacion").prop("checked",i.DetieneOperacion==1);$("#txtDescripcion").val(i.Descripcion);$("#txtNumeroEconomico").val(i.NumeroEconomico);$("#comboMarca").val(i.IdMarca);$("#comboPrioridad").val(i.IdNivelPrioridad);$("#txtDiagnostico").val(i.Diagnostico);datosEquipo.cargarComboModelos($("#comboMarca").val(),i.IdModelo);$("#comboEmpleado").jqxDropDownList("clearSelection");$("#comboEmpleado").val(i.IdUsuarioDiagnostico);$("#comboEmpleado").jqxDropDownList({disabled:!1});listadoGeneral.accion="editar";listadoGeneral.IdUsuarioDiagnostico=i.IdUsuarioDiagnostico;$("#spnTituloForm").text("Editar");let r={path:window.location.hostname,id_requisicion:i.IdRequisicion,idUsuario:sessionStorage.getItem("idusuario"),id_tipo:1};datosEquipo.odometro(i.IdEquipo);utils.getDocumentos(r);listadoGeneral.cargarItemsUsuarios(n);$("#panelTabla").hide();$("#panelForm").show();registroPanelRefacciones.idRequisicionSeleccionada=i.IdRequisicion;registroPanelRefacciones.cargarItems(i.IdRequisicion);$("#panelTablaRefacciones").show();$(".deshabilitable").prop("disabled",!1)},error:function(n,t){console.log(t+": "+n.responseText)}})},finalizar:(n,t)=>{listadoGeneral.idSeleccionado=n,listadoGeneral.idEquipoSeleccionado=t,$("#msgFinalizar").html("<p>Se dara por finalizada esta orden de trabajo  (No."+n+"). ¿Desea continuar?<\/p>"),$("#panelFinalizar").modal("show")},status_espera:(n,t)=>{listadoGeneral.idSeleccionado=n,listadoGeneral.idEquipoSeleccionado=t,listadoGeneral.idStatus=4,$("#msgSetStatus").html("<p>Se enviará esta orden de trabajo a status  <strong> En espera de refacciones <\/strong>(No."+n+"). ¿Desea continuar?<\/p>"),$("#panelSetStatus").modal("show")},status_enatencion:(n,t)=>{listadoGeneral.idSeleccionado=n,listadoGeneral.idEquipoSeleccionado=t,listadoGeneral.idStatus=5,$("#msgSetStatus").html("<p>Se enviará esta orden a status <strong>En atención <\/strong>(No."+n+"). ¿Desea continuar?<\/p>"),$("#panelSetStatus").modal("show")},asignar_colaborador:(n,t)=>{listadoGeneral.idSeleccionado=n;listadoGeneral.idEquipoSeleccionado=t;var i={};i.path=window.location.hostname;i.idUsuario=sessionStorage.getItem("idusuario");i.idRequisicion=n;i=JSON.stringify(i);$.ajax({type:"POST",url:"../pages/MantenimientoListadoFallas.aspx/GetItemsColaboraciones",data:i,contentType:"application/json; charset=utf-8",dataType:"json","async":!0,success:function(t){var i,f;let r=t.d;console.log(r);let u=`
                         

                            <div class="form-group col-md-12">
                    <ul>`;for(i=0;i<r.length;i++)f=r[i],u+=`
						
										<li>
											${f.NombreUsuario}, ${f.FechaFormateadaMx}
										</li>
									

								
						`;u+=` 
                    <ul> </div>`;$("#listaColaboradores").empty().append(u);$("#idRequisicionSpan").empty().append(n);$("#panelAsignarColaborador").modal("show")},error:function(n,t){console.log(t+": "+n.responseText)}})},accionesBotones:()=>{$("#btnDescargar").on("click",n=>{n.preventDefault(),window.open(`../pages/Download.ashx?path=${window.location.hostname}&id_requisicion=${listadoGeneral.idSeleccionado}&tipo_descarga=3`)});$("#btnCargarRefacciones").on("click",n=>{n.preventDefault();console.log("btnCargarRefacciones PM1");var t={};t.path=window.location.hostname;t.idEquipo=listadoGeneral.idEquipoSeleccionado;t.idUsuario=sessionStorage.getItem("idusuario");t.idRequisicion=listadoGeneral.idSeleccionado;t=JSON.stringify(t);$.ajax({type:"POST",url:"../pages/MantenimientoListadoFallas.aspx/GuardarListaRefaccionesPorEquipoPM1",data:t,contentType:"application/json; charset=utf-8",dataType:"json","async":!0,success:function(n){var t=n.d;console.log(t);registroPanelRefacciones.idRequisicionSeleccionada=listadoGeneral.idSeleccionado;registroPanelRefacciones.cargarItems(registroPanelRefacciones.idRequisicionSeleccionada)},error:function(n,t){console.log(t+": "+n.responseText)}})});$("#btnFinalizarAceptar").on("click",()=>{var n={};n.path=window.location.hostname;n.id=listadoGeneral.idSeleccionado;n.idEquipo=listadoGeneral.idEquipoSeleccionado;n=JSON.stringify(n);$.ajax({type:"POST",url:"../pages/MantenimientoPanelDiagnostico.aspx/FinalizarRequisicion",data:n,contentType:"application/json; charset=utf-8",dataType:"json","async":!0,success:function(n){var t=n.d;t.MensajeError===null?(utils.toast(mensajesAlertas.exitoFinalizar,"ok"),listadoGeneral.cargarItems()):utils.toast(t.MensajeError,"error")},error:function(n,t){console.log(t+": "+n.responseText)}})});$("#btnSetStatusAceptar").on("click",()=>{var n={};n.path=window.location.hostname;n.id=listadoGeneral.idSeleccionado;n.idEquipo=listadoGeneral.idEquipoSeleccionado;n.status=listadoGeneral.idStatus;n=JSON.stringify(n);$.ajax({type:"POST",url:"../pages/MantenimientoListadoFallas.aspx/setStatusRequisicion",data:n,contentType:"application/json; charset=utf-8",dataType:"json","async":!0,success:function(n){var t=n.d;t.MensajeError===null?(utils.toast(mensajesAlertas.exitoCambiarStatus,"ok"),listadoGeneral.cargarItems()):utils.toast(t.MensajeError,"error")},error:function(n,t){console.log(t+": "+n.responseText);utils.toast(resultado.MensajeError,"error")}})});$("#btnReAbrirAceptar").on("click",n=>{n.preventDefault();var t={};t.path=window.location.hostname;t.id=listadoGeneral.idSeleccionado;t=JSON.stringify(t);$.ajax({type:"POST",url:"../pages/MantenimientoListadoFallas.aspx/ReAbrirRequisicion",data:t,contentType:"application/json; charset=utf-8",dataType:"json","async":!0,success:function(n){var t=n.d;t.MensajeError===null?(utils.toast(mensajesAlertas.exitoOperacion,"ok"),listadoGeneral.cargarItems()):utils.toast(t.MensajeError,"error")},error:function(n,t){console.log(t+": "+n.responseText)}})});$("#btnAbrirSeleccionarEquipo").on("click",n=>{n.preventDefault(),listadoGeneral.cargarItemsEquipos(),$("#panelSeleccionarEquipo").modal("show")});$("#btnGuardar").on("click",n=>{var r,t,i;if(n.preventDefault(),r=$('form[name="frm"]').validator("validate").has(".has-error").length,!r){if(listadoGeneral.idEquipoSeleccionado==-1){utils.toast(mensajesAlertas.errorSeleccionarEquipo,"error");return}t={};t.IdRequisicion=listadoGeneral.idSeleccionado;t.IdEquipo=listadoGeneral.idEquipoSeleccionado;t.Descripcion=$("#txtDescripcion").val();t.Orometro=$("#txtOrometro").val();t.Diagnostico=$("#txtDiagnostico").val();t.DetieneOperacion=$("#chkDetieneOperacion").prop("checked")==!0?1:0;t.IdNivelPrioridad=$("#comboPrioridad").val();t.IdUsuarioDiagnostico=$("#comboEmpleado").val()===null||$("#comboEmpleado").val()===""?"-1":$("#comboEmpleado").val();t.IdUsuarioDiagnosticoAnterior=listadoGeneral.IdUsuarioDiagnostico;t.IdUsuario=sessionStorage.getItem("idusuario");i={};i.path=window.location.hostname;i.item=t;i.accion=listadoGeneral.accion;i.idTipoUsuario=sessionStorage.getItem("idtipousuario");i=JSON.stringify(i);$.ajax({type:"POST",url:"../pages/MantenimientoListadoFallas.aspx/Guardar",data:i,contentType:"application/json; charset=utf-8",dataType:"json","async":!0,success:function(n){var t=n.d;t.CodigoError==0?(listadoGeneral.idSeleccionado=t.IdItem,$("#txtNumeroRequisicion").val(listadoGeneral.idSeleccionado),$(".file-documentos").each(function(){let n;(n=this.files[0])&&utils.sendFile(n,"documentos",t.IdItem,"documento")}),$("#spnMensajes").html(mensajesAlertas.exitoGuardar),$("#panelMensajes").modal("show"),listadoGeneral.cargarItems()):utils.toast(mensajesAlertas.errorGuardar,"error")},error:function(n,t){console.log(t+": "+n.responseText);utils.toast(mensajesAlertas.errorGuardar,"error")}})}});$("#btnAceptarPanelMensajes").on("click",n=>{n.preventDefault(),$("#panelMensajes").modal("hide"),$("#panelTabla").show(),$("#panelForm").hide()});$("#btnAgregarOtroDocumento").on("click",n=>{n.preventDefault();let t='<div class="form-group col-md-4">';t+='<input type="file" class="form-control file-documentos" />';t+='<div class="help-block with-errors"><\/div>';t+="<\/div>";$("#divDocumentos").append(t)});$("#btnCancelar").on("click",n=>{n.preventDefault(),$("#panelTabla").show(),$("#panelForm").hide()});$("#btnEliminarAceptar").on("click",n=>{n.preventDefault();var t={};t.path=window.location.hostname;t.id=listadoGeneral.idSeleccionado;t=JSON.stringify(t);$.ajax({type:"POST",url:"../pages/MantenimientoPanelRegistroFallas.aspx/EliminarRequisicion",data:t,contentType:"application/json; charset=utf-8",dataType:"json","async":!0,success:function(n){var t=n.d;t.MensajeError===null?(utils.toast(mensajesAlertas.exitoEliminar,"ok"),listadoGeneral.cargarItems()):utils.toast(t.MensajeError,"error")},error:function(n,t){console.log(t+": "+n.responseText)}})});$("#btnEliminarAceptarImagen").on("click",n=>{n.preventDefault();var t={};t.path=window.location.hostname;t.id=utils.idDoc;t=JSON.stringify(t);$.ajax({type:"POST",url:"../pages/MantenimientoListadoFallas.aspx/EliminarImagen",data:t,contentType:"application/json; charset=utf-8",dataType:"json","async":!0,success:function(n){var t=n.d;if(t.MensajeError===null){utils.toast(mensajesAlertas.exitoEliminar,"ok");let n={path:window.location.hostname,id_requisicion:listadoGeneral.idSeleccionado,idUsuario:sessionStorage.getItem("idusuario"),id_tipo:1};utils.getDocumentos(n)}else utils.toast(t.MensajeError,"error")},error:function(n,t){console.log(t+": "+n.responseText)}})});$("#btnEnviarAceptar").on("click",n=>{n.preventDefault();var t={};t.path=window.location.hostname;t.id=listadoGeneral.idSeleccionado;t=JSON.stringify(t);$.ajax({type:"POST",url:"../pages/MantenimientoPanelRegistroFallas.aspx/EnviarRequisicion",data:t,contentType:"application/json; charset=utf-8",dataType:"json","async":!0,success:function(n){var t=n.d;t.MensajeError===null?(utils.toast(mensajesAlertas.exitoEnviar,"ok"),listadoGeneral.cargarItems()):utils.toast(t.MensajeError,"error")},error:function(n,t){console.log(t+": "+n.responseText)}})})}};window.addEventListener("load",()=>{listadoGeneral.init(),listadoGeneral.accionesBotones()});