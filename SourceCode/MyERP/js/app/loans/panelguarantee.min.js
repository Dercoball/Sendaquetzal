"use strict";const panelGuarantee={init:()=>{$("#panelFormGarantias").hide(),$("#panelFormGarantiasAval").hide(),panelGuarantee.accion="",panelGuarantee.idPrestamo=-1,panelGuarantee.idSeleccionado=-1},view(n,t){panelGuarantee.idPrestamo=n;panelGuarantee.cargarItemsCustomer(n,t);panelGuarantee.cargarItemsAval(n,t);console.log("Asignar id del prestamo al paneeeel "+n)},cargarItemsCustomer:(n,t)=>{let i={};i.path=window.location.hostname;i.idUsuario=document.getElementById("txtIdUsuario").value;i.idPrestamo=n;i=JSON.stringify(i);$.ajax({type:"POST",url:"../../pages/Loans/LoansIndex.aspx/GetListGuaranteeCustomer",data:i,contentType:"application/json; charset=utf-8",dataType:"json","async":!0,success:function(n){let i=n.d;i==null&&(window.location="../../pages/Index.aspx");let r=$("#tableGarantias").DataTable({destroy:!0,pageLength:50,processing:!1,order:[],data:i,columns:[{data:"Nombre"},{data:"NumeroSerie"},{data:"CostoFormateadoMx"},{data:"Imagen"},{data:"Accion"}],language:textosEsp,columnDefs:[{targets:[-1],orderable:!1},],dom:"Rt",buttons:[{extend:"excelHtml5",title:descargas,text:"Xls",className:"excelbtn"},{extend:"pdfHtml5",title:descargas,text:"Pdf",className:"pdfbtn"}]});t?$(".boton-ocultable").hide():$(".boton-ocultable").show();$(".garantias").each(function(n,t){let i=t.dataset.idgarantia,r=t.id;panelGuarantee.getGuaranteePhoto(i,`#${r}`)})},error:function(n,t){console.log(t+": "+n.responseText)}})},getGuaranteePhoto:(n,t)=>{let i={};i.path=window.location.hostname;i.idGarantia=n;i=JSON.stringify(i);$.ajax({type:"POST",url:"../../pages/Loans/LoansIndex.aspx/getGuaranteePhoto",data:i,contentType:"application/json; charset=utf-8",dataType:"json","async":!0,success:function(n){let i=n.d;i.IdGarantia&&$(`${t}`).attr("src",`data:image/jpg;base64,${i.Fotografia}`)},error:function(n,t){console.log(t+": "+n.responseText)}})},cargarItemsAval:(n,t)=>{let i={};i.path=window.location.hostname;i.idUsuario=document.getElementById("txtIdUsuario").value;i.idPrestamo=n;i=JSON.stringify(i);$.ajax({type:"POST",url:"../../pages/Loans/LoansIndex.aspx/GetListGuaranteeAval",data:i,contentType:"application/json; charset=utf-8",dataType:"json","async":!0,success:function(n){let i=n.d;i==null&&(window.location="../../pages/Index.aspx");let r=$("#tableGarantiasAval").DataTable({destroy:!0,pageLength:50,processing:!1,order:[],data:i,columns:[{data:"Nombre"},{data:"NumeroSerie"},{data:"CostoFormateadoMx"},{data:"Imagen"},{data:"Accion"}],language:textosEsp,columnDefs:[{targets:[-1],orderable:!1},],dom:"rt",buttons:[{extend:"excelHtml5",title:descargas,text:"Xls",className:"excelbtn"},{extend:"pdfHtml5",title:descargas,text:"Pdf",className:"pdfbtn"}]});t?$(".boton-ocultable").hide():$(".boton-ocultable").show();$(".garantias").each(function(n,t){let i=t.dataset.idgarantia,r=t.id;panelGuarantee.getGuaranteePhoto(i,`#${r}`)})},error:function(n,t){console.log(t+": "+n.responseText)}})},"delete":n=>{panelGuarantee.idSeleccionado=n,$("#panelEliminar").modal("show")},nuevoGarantiaCliente:()=>{$("#frmGarantias")[0].reset(),$(".form-group").removeClass("has-error"),$(".help-block").empty(),panelGuarantee.accion="nuevo",$("#panelFormGarantias").modal("show")},nuevoGarantiaAval:()=>{console.log("nuevo garantia aval"),$("#frmGarantiasAval")[0].reset(),$(".form-group").removeClass("has-error"),$(".help-block").empty(),panelGuarantee.accion="nuevo",$("#panelFormGarantiasAval").modal("show")},cancelarRefacciones:n=>{panelGuarantee.idRefaccionSeleccionada=n,$("#msgCancelar").html(mensajesAlertas.confirmacionCancelarRefaccion.replace("{numrefaccion}",n)),$("#panelCancelarRefaccion").modal("show")},accionesBotones:()=>{$("#btnEliminarAceptar").on("click",()=>{var n={};n.path=window.location.hostname;n.id=panelGuarantee.idSeleccionado;n.idUsuario=document.getElementById("txtIdUsuario").value;n=JSON.stringify(n);$.ajax({type:"POST",url:"../../pages/Loans/LoansIndex.aspx/Delete",data:n,contentType:"application/json; charset=utf-8",dataType:"json","async":!0,success:function(n){var t=n.d;t.MensajeError===null?(utils.toast(mensajesAlertas.exitoEliminar,"ok"),panelGuarantee.cargarItemsCustomer(panelGuarantee.idPrestamo),panelGuarantee.cargarItemsAval(panelGuarantee.idPrestamo)):utils.toast(t.MensajeError,"error")},error:function(n,t){console.log(t+": "+n.responseText)}})});$("#btnNuevaGarantia").on("click",n=>{n.preventDefault(),panelGuarantee.nuevoGarantiaCliente()});$("#btnNuevaGarantiaAval").on("click",n=>{n.preventDefault(),panelGuarantee.nuevoGarantiaAval()});$("#btnGuardarGarantiaCliente").on("click",n=>{var r,i,t;(n.preventDefault(),r=$('form[name="frmGarantias"]').validator("validate").has(".has-error").length,r)||(i={},i.IdGarantia=0,i.Nombre=$("#txtNombreGarantia").val(),i.NumeroSerie=$("#txtNumeroSerie").val(),i.Costo=$("#txtCosto").val(),t={},t.path=window.location.hostname,t.item=i,t.idUsuario=document.getElementById("txtIdUsuario").value,t.idPrestamo=panelGuarantee.idPrestamo,console.log("idPrestamo = "+panelGuarantee.idPrestamo),t=JSON.stringify(t),$.ajax({type:"POST",url:"../../pages/Loans/LoansIndex.aspx/SaveCustomerGuarantee",data:t,contentType:"application/json; charset=utf-8",dataType:"json","async":!0,success:function(n){var t=n.d;parseInt(t.CodigoError)==0?(utils.toast(mensajesAlertas.exitoGuardar,"ok"),$(".file-garantiacliente").each(function(){let n;(n=this.files[0])&&utils.sendFileEmployee(n,"garantia",t.IdItem,0,"garantia")}),panelGuarantee.cargarItemsCustomer(panelGuarantee.idPrestamo),$("#panelFormGarantias").modal("hide")):utils.toast(mensajesAlertas.errorGuardar,"error")},error:function(n,t){console.log(t+": "+n.responseText);utils.toast(mensajesAlertas.errorGuardar,"error")}}))});$("#btnGuardarGarantiaAval").on("click",n=>{var r,i,t;(n.preventDefault(),r=$('form[name="frmGarantiasAval"]').validator("validate").has(".has-error").length,r)||(i={},i.IdGarantia=0,i.Nombre=$("#txtNombreGarantiaAval").val(),i.NumeroSerie=$("#txtNumeroSerieAval").val(),i.Costo=$("#txtCostoAval").val(),t={},t.path=window.location.hostname,t.item=i,t.idUsuario=document.getElementById("txtIdUsuario").value,t.idPrestamo=panelGuarantee.idPrestamo,t=JSON.stringify(t),$.ajax({type:"POST",url:"../../pages/Loans/LoansIndex.aspx/SaveAvalGuarantee",data:t,contentType:"application/json; charset=utf-8",dataType:"json","async":!0,success:function(n){var t=n.d;parseInt(t.CodigoError)==0?(utils.toast(mensajesAlertas.exitoGuardar,"ok"),$(".file-garantiaaval").each(function(){let n;(n=this.files[0])&&(console.log("guardar la foto aval"+t.IdItem),utils.sendFileEmployee(n,"garantia",t.IdItem,0,"garantia"))}),panelGuarantee.cargarItemsAval(panelGuarantee.idPrestamo),$("#panelFormGarantiasAval").modal("hide")):utils.toast(mensajesAlertas.errorGuardar,"error")},error:function(n,t){console.log(t+": "+n.responseText);utils.toast(mensajesAlertas.errorGuardar,"error")}}))});$("#btnCancelarGarantíaCliente").on("click",n=>{n.preventDefault(),$("#panelTablaGarantias").show()});$("#btnCancelarGarantíaAval").on("click",n=>{n.preventDefault(),$("#panelTablaGarantiasAval").show()})}};window.addEventListener("load",()=>{panelGuarantee.init(),panelGuarantee.accionesBotones()});