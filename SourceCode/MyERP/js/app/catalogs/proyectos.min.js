var accion="",idSeleccionado="-1",idEquipoSeleccionado="-1",idCitaSeleccionado="-1",table,tablaCerrados,tablaClientes,tablaCitas,date=new Date,descargas="Proyectos_"+date.getFullYear()+"_"+date.getMonth()+"_"+date.getUTCDay()+"_"+date.getMilliseconds(),pagina="15";$(document).ready(function(){function t(){var n={};n.path=window.location.hostname;n=JSON.stringify(n);$.ajax({type:"POST",url:"../pages/PanelEquipos.aspx/GetListaMarcas",data:n,contentType:"application/json; charset=utf-8",dataType:"json",async:!0,success:function(n){var u=n.d,i="",t,r;for(i+='<option value=""><\/option>',t=0;t<u.length;t++)r=u[t],i+='<option value="'+r.Id_Marca+'">'+r.Nombre+"<\/option>";$("#comboMarca").empty().append(i)},error:function(n,t){console.log(t+": "+n.responseText)}})}function n(){var n={};n.path=window.location.hostname;n.idUsuario=sessionStorage.getItem("idusuario");n.idProveedor=sessionStorage.getItem("idproveedor");n=JSON.stringify(n);$.ajax({type:"POST",url:"../pages/Proyectos.aspx/GetListaItems",data:n,contentType:"application/json; charset=utf-8",dataType:"json",async:!0,success:function(n){table=$("#table").DataTable({destroy:!0,processing:!0,order:[],data:n.d,columns:[{data:"IdProyecto"},{data:"NumeroEconomico"},{data:"NombreEquipo"},{data:"NombreStatusProyecto"},{data:"Accion"}],language:textosEsp,columnDefs:[{targets:[-1],orderable:!1},],dom:"frtiplB",buttons:[{extend:"excelHtml5",title:descargas,text:"Xls",className:"excelbtn"},{extend:"pdfHtml5",title:descargas,text:"Pdf",className:"pdfbtn"}]})},error:function(n,t){console.log(t+": "+n.responseText)}})}function i(){var n={};n.path=window.location.hostname;n.idUsuario=sessionStorage.getItem("idusuario");n=JSON.stringify(n);$.ajax({type:"POST",url:"../pages/Proyectos.aspx/GetListaEquipos",data:n,contentType:"application/json; charset=utf-8",dataType:"json",async:!0,success:function(n){function t(n,t){var i={};i.path=window.location.hostname;i.idMarca=n;i=JSON.stringify(i);$.ajax({type:"POST",url:"../pages/PanelEquipos.aspx/GetListaModelos",data:i,contentType:"application/json; charset=utf-8",dataType:"json",async:!0,success:function(n){var f=n.d,r="",i,u;for(r+='<option value=""><\/option>',i=0;i<f.length;i++)u=f[i],r+='<option value="'+u.Id_Modelo+'">'+u.Nombre+"<\/option>";$("#comboModelo").empty().append(r);t!==0&&$("#comboModelo").val(t)},error:function(n,t){console.log(t+": "+n.responseText)}})}tablaClientes=$("#tablaEquipos").DataTable({pageLength:5,destroy:!0,processing:!0,order:[],data:n.d,columns:[{data:"NumeroEconomico"},{data:"Nombre"},{data:"NombreMarca"},{data:"Accion"}],language:textosEsp,columnDefs:[{targets:[-1],orderable:!1},],dom:"frtipl"});$("#tablaEquipos").on("draw.dt",function(){$(".boton-seleccionar-equipo").on("click",function(n){n.preventDefault();idEquipoSeleccionado=$(this).attr("data-idequipo");$("#txtNombreEquipo").val(idEquipoSeleccionado);var i={};i.path=window.location.hostname;i.id=idEquipoSeleccionado;i=JSON.stringify(i);$.ajax({type:"POST",url:"../pages/Proyectos.aspx/GetItemEquipo",data:i,contentType:"application/json; charset=utf-8",dataType:"json",async:!0,success:function(n){var i=n.d;idEquipoSeleccionado=i.IdEquipo;$("#txtNombreEquipo").val(i.Nombre);$("#txtNumeroEconomico").val(i.NumeroEconomico);$("#txtNumeroSerie").val(i.NumeroSerie);$("#txtAnio").val(i.Anio);$("#txtNombreEquipo").val(i.Nombre);$("#comboMarca").val(i.IdMarca);t(i.IdMarca,i.IdModelo);$("#panelSeleccionarEquipo").modal("hide")},error:function(n,t){console.log(t+": "+n.responseText)}})})});$("#tablaEquipos").trigger("draw.dt")},error:function(n,t){console.log(t+": "+n.responseText)}})}function t(){var n={};n.path=window.location.hostname;n=JSON.stringify(n);$.ajax({type:"POST",url:"../pages/Proyectos.aspx/GetListaMarcas",data:n,contentType:"application/json; charset=utf-8",dataType:"json",async:!0,success:function(n){var u=n.d,i="",t,r;for(i+='<option value=""><\/option>',t=0;t<u.length;t++)r=u[t],i+='<option value="'+r.Id_Marca+'">'+r.Nombre+"<\/option>";$("#comboMarca").empty().append(i)},error:function(n,t){console.log(t+": "+n.responseText)}})}function r(){var n={};n.path=window.location.hostname;n=JSON.stringify(n);$.ajax({type:"POST",url:"../pages/Proyectos.aspx/GetListaTiposReparacion",data:n,contentType:"application/json; charset=utf-8",dataType:"json",async:!0,success:function(n){for(var i,r=n.d,u="",t=0;t<r.length;t++)i=r[t],u+='<option value="'+i.IdTipoReparacion+'">'+i.Nombre+"<\/option>";$("#comboTipoReparacion").empty().append(u)},error:function(n,t){console.log(t+": "+n.responseText)}})}function u(){var n={};n.path=window.location.hostname;n=JSON.stringify(n);$.ajax({type:"POST",url:"../pages/Proyectos.aspx/GetListaEstatus",data:n,contentType:"application/json; charset=utf-8",dataType:"json",async:!0,success:function(n){for(var i,r=n.d,u="",t=0;t<r.length;t++)i=r[t],u+='<option value="'+i.IdStatusProyecto+'">'+i.Nombre+"<\/option>";$("#comboEstatus").empty().append(u)},error:function(n,t){console.log(t+": "+n.responseText)}})}function f(n,t){var i={};i.path=window.location.hostname;i.idMarca=n;i=JSON.stringify(i);$.ajax({type:"POST",url:"../pages/Proyectos.aspx/GetListaModelos",data:i,contentType:"application/json; charset=utf-8",dataType:"json",async:!0,success:function(n){var f=n.d,r="",i,u;for(r+='<option value=""><\/option>',i=0;i<f.length;i++)u=f[i],r+='<option value="'+u.Id_Modelo+'">'+u.Nombre+"<\/option>";$("#comboModelo").empty().append(r);t!==0&&$("#comboModelo").val(t)},error:function(n,t){console.log(t+": "+n.responseText)}})}$("#alert-operacion-ok").hide();$("#alert-operacion-fail").hide();$("#panelTabla").show();$("#panelForm").hide();$("#panelTablaCerrados").hide();n();t();r();u();$("#btnAbrirSeleccionarEquipo").click(function(n){n.preventDefault();i();$("#panelSeleccionarEquipo").modal("show")});$("#btnAbrirSeleccionarcliente").click(function(n){n.preventDefault();cargarItemsClientes();$("#panelSeleccionarCliente").modal("show")});$("#comboMarca").on("change",function(n){n.preventDefault();f($("#comboMarca").val(),0)});$("#btnAceptarPanelMensajes").on("click",n=>{n.preventDefault(),$("#panelMensajes").modal("hide"),$("#panelTabla").show(),$("#panelForm").hide()});$("#btnGuardar").click(function(t){var u,i,r;(t.preventDefault(),u=$('form[name="frm"]').validator("validate").has(".has-error").length,u)||(i={},i.IdProyecto=idSeleccionado,i.FechaCreacion=$("#txtFecha").prop("fecha"),i.Diagnostico=$("#txtDiagnostico").val(),i.DescripcionServicio1=$("#txtDescripcionServicio1").val(),i.IdRequisicion=idSeleccionado,r={},r.path=window.location.hostname,r.proyecto=i,r.accion=accion,r=JSON.stringify(r),$.ajax({type:"POST",url:"../pages/Proyectos.aspx/Guardar",data:r,contentType:"application/json; charset=utf-8",dataType:"json",async:!0,success:function(t){var i=t.d;i.CodigoError==0?($("#spnMensajes").html(mensajesAlertas.exitoGuardar),$("#panelMensajes").modal("show"),n()):utils.toast(mensajesAlertas.errorGuardar,"error")},error:function(n,t){console.log(t+": "+n.responseText);utils.toast(mensajesAlertas.errorGuardar,"error")}}))});$("#btnCancelar").click(function(n){n.preventDefault();$("#panelTabla").show();$("#panelForm").hide()});$("#btnEliminarAceptar").click(function(){var t={};t.path=window.location.hostname;t.id=idSeleccionado;t=JSON.stringify(t);$.ajax({type:"POST",url:"../pages/Proyectos.aspx/EliminarProyecto",data:t,contentType:"application/json; charset=utf-8",dataType:"json",async:!0,success:function(t){var i=t.d;i.MensajeError===null?($("#spnMensajes").html("Registro eliminado correctamente..."),$("#panelMensajes").modal("show"),n()):($("#spnMensajes").html(i.MensajeError),$("#panelMensajes").modal("show"))},error:function(n,t){console.log(t+": "+n.responseText)}})})});const eliminar=n=>{idSeleccionado=n,$("#panelEliminar").modal("show")},cargarComboModelos_=(n,t)=>{var i={};i.path=window.location.hostname;i.idMarca=n;i=JSON.stringify(i);$.ajax({type:"POST",url:"../pages/Proyectos.aspx/GetListaModelos",data:i,contentType:"application/json; charset=utf-8",dataType:"json",async:!0,success:function(n){var f=n.d,r="",i,u;for(r+='<option value=""><\/option>',i=0;i<f.length;i++)u=f[i],r+='<option value="'+u.Id_Modelo+'">'+u.Nombre+"<\/option>";$("#comboModelo").empty().append(r);t!==0&&$("#comboModelo").val(t)},error:function(n,t){console.log(t+": "+n.responseText)}})},aprobar=n=>{$(".form-group").removeClass("has-error");$(".help-block").empty();$("#frm")[0].reset();$("#txtDiagnostico").val("");$("#txtDescripcionServicion1").val("");var t={};t.path=window.location.hostname;t.id=n;t.idProveedor=sessionStorage.getItem("idproveedor");t=JSON.stringify(t);$.ajax({type:"POST",url:"../pages/Proyectos.aspx/GetItem",data:t,contentType:"application/json; charset=utf-8",dataType:"json",async:!0,success:function(n){var t=n.d;idSeleccionado=t.IdRequisicion;idEquipoSeleccionado=t.IdEquipo;idProveedorSeleccionado=t.IdProveedor;console.log(".");$("#txtNumeroRequisicion").val(t.IdRequisicion);$("#txtNombreEquipo").val(t.NombreEquipo);$("#txtNombreProveedor").val(t.NombreProveedor);$("#txtFechaCreacion").val(t.FechaCreacionFormateada);$("#txtDescripcion").val(t.Descripcion);$("#txtNumeroEconomico").val(t.NumeroEconomico);$("#txtNumeroSerie").val(t.NumeroSerie);$("#txtAnio").val(t.Anio);$("#txtCoordenadas").val(t.Latitud+", "+t.Longitud);$("#comboMarca").val(t.IdMarca);cargarComboModelos_($("#comboMarca").val(),t.IdModelo);$(".deshabilitable").prop("disabled",!1);accion="nuevo";$("#spnTituloForm").text("Aprobar requisici√≥n");let i={path:window.location.hostname,id_requisicion:t.IdRequisicion,idUsuario:sessionStorage.getItem("idusuario"),id_tipo:1};$.ajax({type:"POST",url:"../pages/PanelRequisiciones.aspx/GetDocumentos",data:JSON.stringify(i),contentType:"application/json; charset=utf-8",dataType:"json",async:!0,success:function(n){let i=n.d;console.log(n.d);let t="";i.forEach(function(n){t+="<div>";t+='<a href = "../pages/Download.ashx?path='+window.location.hostname+"&id_documento="+n.IdDocumento+'" target="blank" >';t+=n.Descripcion;t+="<\/a>";t+="<\/div>";$("#divDocumentos").append(t)});$("#divDocumentos").empty().append(t);$("#panelTabla").hide();$("#panelForm").show()},error:function(n,t){console.log(t+": "+n.responseText)}});obtenerFechaHoraServidor("txtFecha");$("#panelTabla").hide();$("#panelForm").show()},error:function(n,t){console.log(t+": "+n.responseText)}})},abrir=n=>{$(".form-group").removeClass("has-error");$(".help-block").empty();$("#frm")[0].reset();$("#txtDiagnostico").val("");$("#txtDescripcionServicion1").val("");var t={};t.path=window.location.hostname;t.id=n;t.idProveedor=sessionStorage.getItem("idproveedor");t=JSON.stringify(t);$.ajax({type:"POST",url:"../pages/Proyectos.aspx/GetItem",data:t,contentType:"application/json; charset=utf-8",dataType:"json",async:!0,success:function(n){var t=n.d;idSeleccionado=t.IdRequisicion;idEquipoSeleccionado=t.IdEquipo;idProveedorSeleccionado=t.IdProveedor;console.log(".");$("#txtNumeroRequisicion").val(t.IdRequisicion);$("#txtNombreEquipo").val(t.NombreEquipo);$("#txtNombreProveedor").val(t.NombreProveedor);$("#txtFechaCreacion").val(t.FechaCreacionFormateada);$("#txtNumeroEconomico").val(t.NumeroEconomico);$("#txtNumeroSerie").val(t.NumeroSerie);$("#txtAnio").val(t.Anio);$("#txtCoordenadas").val(t.Latitud+", "+t.Longitud);$("#txtDiagnostico").val(t.Latitud);$("#txtDescripcionServicion1").val(t.Latitud);$("#comboMarca").val(t.IdMarca);cargarComboModelos_($("#comboMarca").val(),t.IdModelo);$(".deshabilitable").prop("disabled",!0);accion="nuevo";$("#spnTituloForm").text("Aprobar requisici√≥n");let i={path:window.location.hostname,id_requisicion:t.IdRequisicion,idUsuario:sessionStorage.getItem("idusuario"),id_tipo:1};$.ajax({type:"POST",url:"../pages/PanelRequisiciones.aspx/GetDocumentos",data:JSON.stringify(i),contentType:"application/json; charset=utf-8",dataType:"json",async:!0,success:function(n){let i=n.d;console.log(n.d);let t="";i.forEach(function(n){t+="<div>";t+='<a href = "../pages/Download.ashx?path='+window.location.hostname+"&id_documento="+n.IdDocumento+'" target="blank" >';t+=n.Descripcion;t+="<\/a>";t+="<\/div>";$("#divDocumentos").append(t)});$("#divDocumentos").empty().append(t);$("#panelTabla").hide();$("#panelForm").show()},error:function(n,t){console.log(t+": "+n.responseText)}});obtenerFechaHoraServidor("txtFecha");$("#panelTabla").hide();$("#panelForm").show()},error:function(n,t){console.log(t+": "+n.responseText)}})},nuevo=()=>{$("#frm")[0].reset(),$(".form-group").removeClass("has-error"),$(".help-block").empty(),$("#spnTituloForm").text("Nuevo"),$("#panelTabla").hide(),$("#panelForm").show(),accion="nuevo",id="-1",idSeleccionado="-1",idClienteSeleccionado="-1",obtenerFechaHoraServidor("txtFechaCreacion")};