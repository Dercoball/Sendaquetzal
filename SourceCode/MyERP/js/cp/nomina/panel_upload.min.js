"use strict";let date=new Date,descargas="Uploads_"+date.getFullYear()+"_"+date.getMonth()+"_"+date.getUTCDay()+"_"+date.getMilliseconds(),pagina="62";const upload={init:()=>{$("#panelTabla").hide(),$("#panelForm").show(),upload.idSeleccionado=-1,upload.accion=""},cargarItems:()=>{var n={};n.path=window.location.hostname;n.idUsuario=sessionStorage.getItem("idusuario");utils.postData("../pages/uploads.aspx/GetListaItems",n).then(n=>{console.log(n);n=n.d;let t=$("#table").DataTable({destroy:!0,processing:!0,order:[],data:n,columns:[{data:"Idupload"},{data:"Nombre"},{data:"Clave"},{data:"ActivoStr"},{data:"Accion"}],language:textosEsp,columnDefs:[{targets:[-1],orderable:!1},],dom:"frtiplB",buttons:[{extend:"excelHtml5",title:descargas,text:"Xls",className:"excelbtn"},{extend:"pdfHtml5",title:descargas,text:"Pdf",className:"pdfbtn"}]})})},eliminar:n=>{upload.idSeleccionado=n,$("#panelEliminar").modal("show")},editar:n=>{$(".form-group").removeClass("has-error");$(".help-block").empty();var t={};t.path=window.location.hostname;t.id=n;t=JSON.stringify(t);$.ajax({type:"POST",url:"../pages/uploads.aspx/GetItem",data:t,contentType:"application/json; charset=utf-8",dataType:"json",async:!0,success:function(n){var t=n.d;upload.idSeleccionado=t.Idupload;console.log(".");$("#txtNombre").val(t.Nombre);$("#txtClave").val(t.Clave);$("#chkActivo").prop("checked",t.Activo===1);$("#panelTabla").hide();$("#panelForm").show();upload.accion="editar";$("#spnTituloForm").text("Editar");$(".deshabilitable").prop("disabled",!1)},error:function(n,t){console.log(t+": "+n.responseText)}})},nuevo:()=>{$("#frm")[0].reset(),$(".form-group").removeClass("has-error"),$(".help-block").empty(),$("#spnTituloForm").text("Nuevo"),$("#txtDescripcion").val(""),$("#panelTabla").hide(),$("#panelForm").show(),upload.accion="nuevo",upload.idSeleccionado=-1,$(".deshabilitable").prop("disabled",!1),obtenerFechaHoraServidor("txtFechaCreacion")},sendFile:n=>{var u=n,r=u.name,i=utils.getFileExtension(r),t;if(console.log(`extension = ${i}`),i!=="csv"&&i!=="txt"){console.log("archivo incorrecto");utils.toast(mensajesAlertas.errorSubirCsv,"error");return}$("#panelLoading").modal("show");t=new FormData;t.append("file",n);t.append("pagina",window.location.pathname);t.append("path",window.location.hostname);t.append("extension",i);t.append("descripcion",r);t.append("tipo","csv");t.append("usuario",sessionStorage.getItem("idusuario"));$.ajax({type:"post",url:"../pages/FileUploaderCSV.ashx",data:t,success:function(n){var t,i,f,e,r,o;if(n!="error")if(t=JSON.parse(n),t===-1)setTimeout(function(){$("#panelLoading").modal("hide");$("#spnTipoMensaje").text("Información");$("#spnContenidoMensaje").html("Errores en el proceso.<br/><ul><li>No existe la configuración correcta.<\/ul>");$("#panelMensajes").modal("show")},500);else if(t===null)setTimeout(function(){$("#panelLoading").modal("hide");$("#spnTipoMensaje").text("Información");$("#spnContenidoMensaje").html("Errores en el proceso.<br/>Posibles problemas:<ul><li>No ha generado la tabla de detalle.<li>El archivo que seleccionó no es del formato correcto.<\/ul>");$("#panelMensajes").modal("show")},500);else{for($("#tableResultados >tbody").empty(),i=0;i<t.length;i++){var u="<tr>",s=t[i].valido,h=s===!0?'<span class="badge badge-success">Correcto<\/span>':'<span class="badge badge-danger">Incorrecto<\/span>';for(u+=`<td>${h}</td>`,f=t[i].parts,e=t[i].estilosCss,r=0;r<f.length;r++)o=f[r],u+=`<td class='${e[r+1]}'>${o}</td>`;u+=`</tr>`;$("#tableResultados >tbody").append(u)}$("#panelLoading").show("fast",function(){setTimeout(function(){$("#panelLoading").modal("hide");$("#spnTipoMensaje").text("Información");$("#spnMensajes").html("Operación finalizada.<br/>"+t[0].mensajeError);$("#panelMensajes").modal("show");upload.generarTabla(upload.idSeleccionado)},500)})}},processData:!1,contentType:!1,error:function(){$("#panelLoading").modal("hide")}})},generarTabla:()=>{var r=["clave empleado","nombre","apellido  paterno","apellido materno","clave depto.","depto.","clave area","area","clave puesto","puesto","fecha_alta","salario_mens","id. reg. pat.","reg. pat.","reg. pat."],u="",t="",n,i;for(t+="<th>Status<\/th>",n=0;n<r.length;n++)i=r[n].toUpperCase(),u+="<th>"+i+"<\/th>",t+="<th>"+i+"<\/th>";$("#tableResultados >thead").empty().append(t)},accionesBotones:()=>{$("#txtFileCSV").on("change",n=>{n.preventDefault();console.log("txtFileCSV subir archivo csv");let t;(t=$("#txtFileCSV")[0].files[0])&&upload.sendFile(t,"csv")});$("#btnUpload").on("click",n=>{n.preventDefault();console.log("txtFileCSV subir archivo csv");let t;(t=$("#txtFileCSV")[0].files[0])?upload.sendFile(t,"csv"):utils.toast(mensajesAlertas.errorSubirCsv,"error")});$("#btnCancelar").on("click",n=>{n.preventDefault(),$("#panelTabla").show(),$("#panelForm").hide()});$("#btnEliminarAceptar").on("click",()=>{var n={};n.path=window.location.hostname;n.id=upload.idSeleccionado;n=JSON.stringify(n);$.ajax({type:"POST",url:"../pages/uploads.aspx/Eliminar",data:n,contentType:"application/json; charset=utf-8",dataType:"json",async:!0,success:function(n){var t=n.d;t.MensajeError===null?(utils.toast(mensajesAlertas.exitoEliminar,"ok"),upload.cargarItems()):utils.toast(t.MensajeError,"error")},error:function(n,t){console.log(t+": "+n.responseText)}})})}};window.addEventListener("load",()=>{upload.init(),upload.accionesBotones()});