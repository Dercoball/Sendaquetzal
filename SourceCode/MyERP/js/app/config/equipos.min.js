function descargarFormato(n){window.open("../pages/Download.ashx?path="+window.location.hostname+"&id_proyecto="+n+"&tipo=1")}function eliminar(n){idSeleccionado=n;$("#panelEliminar").modal("show")}function cargarComboModelos_(n,t){var i={};i.path=window.location.hostname;i.idMarca=n;i=JSON.stringify(i);$.ajax({type:"POST",url:"../pages/PanelEquipos.aspx/GetListaModelos",data:i,contentType:"application/json; charset=utf-8",dataType:"json",async:!0,success:function(n){var f=n.d,r="",i,u;for(r+='<option value=""><\/option>',i=0;i<f.length;i++)u=f[i],r+='<option value="'+u.Id_Modelo+'">'+u.Nombre+"<\/option>";$("#comboModelo").empty().append(r);t!==0&&$("#comboModelo").val(t)},error:function(n,t){console.log(t+": "+n.responseText)}})}function editar(n){$(".form-group").removeClass("has-error");$(".help-block").empty();accion="nuevo";var t={};t.path=window.location.hostname;t.id=n;t=JSON.stringify(t);$.ajax({type:"POST",url:"../pages/PanelEquipos.aspx/GetItem",data:t,contentType:"application/json; charset=utf-8",dataType:"json",async:!0,success:function(n){var t=n.d;idSeleccionado=t.IdEquipo;$("#txtNombre").val(t.Nombre);$("#txtDescripcion").val(t.Descripcion);$("#txtNumeroEconomico").val(t.NumeroEconomico);$("#txtNumeroSerie").val(t.NumeroSerie);$("#comboUbicacion").val(t.IdUbicacion);$("#txtValorComercial").val(t.ValorComercial);$("#comboMarca").val(t.IdMarca);$("#chkOperativo").prop("checked",t.Activo==1);cargarComboModelos_($("#comboMarca").val(),t.IdModelo);$("#txtAnio").val(t.Anio);accion="editar";$("#spnTituloForm").text("Editar");$("#panelTabla").hide();$("#panelForm").show()},error:function(n,t){console.log(t+": "+n.responseText)}})}function nuevo(){$("#frm")[0].reset();$(".form-group").removeClass("has-error");$(".help-block").empty();$("#spnTituloForm").text("Nuevo");$("#panelTabla").hide();$("#panelForm").show();accion="nuevo";id="-1";idSeleccionado="-1";idClienteSeleccionado="-1";var n=new Date;$("#txtNumProyecto").prop("disabled",!0)}var accion="",idSeleccionado="-1",idClienteSeleccionado="-1",idCitaSeleccionado="-1",table,tablaCerrados,tablaClientes,tablaCitas,date=new Date,descargas="Equipos_"+date.getFullYear()+"_"+date.getMonth()+"_"+date.getUTCDay()+"_"+date.getMilliseconds(),pagina="54";$(document).ready(function(){function n(){var n={};n.path=window.location.hostname;n.idUsuario=sessionStorage.getItem("idusuario");n=JSON.stringify(n);$.ajax({type:"POST",url:"../pages/PanelEquipos.aspx/GetListaItems",data:n,contentType:"application/json; charset=utf-8",dataType:"json",async:!0,success:function(n){table=$("#table").DataTable({destroy:!0,processing:!0,order:[],data:n.d,columns:[{data:"NumeroEconomico"},{data:"Nombre"},{data:"NombreMarca"},{data:"NombreModelo"},{data:"ActivoStr"},{data:"Accion"}],language:textosEsp,columnDefs:[{targets:[-1],orderable:!1},],dom:"fBrtip",buttons:[{extend:"csvHtml5",title:descargas,text:"&nbsp;Exportar Csv",className:"csvbtn"},{extend:"excelHtml5",title:descargas,text:"Xls",className:"excelbtn"},{extend:"pdfHtml5",title:descargas,text:"Pdf",className:"pdfbtn"}]})},error:function(n,t){console.log(t+": "+n.responseText)}})}function t(){var n={};n.path=window.location.hostname;n=JSON.stringify(n);$.ajax({type:"POST",url:"../pages/PanelEquipos.aspx/GetListaMarcas",data:n,contentType:"application/json; charset=utf-8",dataType:"json",async:!0,success:function(n){var u=n.d,i="",t,r;for(i+='<option value=""><\/option>',t=0;t<u.length;t++)r=u[t],i+='<option value="'+r.Id_Marca+'">'+r.Nombre+"<\/option>";$("#comboMarca").empty().append(i)},error:function(n,t){console.log(t+": "+n.responseText)}})}function i(){var n={};n.path=window.location.hostname;n=JSON.stringify(n);$.ajax({type:"POST",url:"../pages/PanelEquipos.aspx/GetListaUbicaciones",data:n,contentType:"application/json; charset=utf-8",dataType:"json",async:!0,success:function(n){for(var i,r=n.d,u="",t=0;t<r.length;t++)i=r[t],u+='<option value="'+i.IdUbicacion+'">'+i.Nombre+"<\/option>";$("#comboUbicacion").empty().append(u)},error:function(n,t){console.log(t+": "+n.responseText)}})}function r(n,t){var i={};i.path=window.location.hostname;i.idMarca=n;i=JSON.stringify(i);$.ajax({type:"POST",url:"../pages/PanelEquipos.aspx/GetListaModelos",data:i,contentType:"application/json; charset=utf-8",dataType:"json",async:!0,success:function(n){var f=n.d,r="",i,u;for(r+='<option value=""><\/option>',i=0;i<f.length;i++)u=f[i],r+='<option value="'+u.Id_Modelo+'">'+u.Nombre+"<\/option>";$("#comboModelo").empty().append(r);t!==0&&$("#comboModelo").val(t)},error:function(n,t){console.log(t+": "+n.responseText)}})}$("#alert-operacion-ok").hide();$("#alert-operacion-fail").hide();$("#panelTabla").show();$("#panelForm").hide();$("#panelTablaCerrados").hide();n();t();i();$("#btnNuevo").click(function(n){n.preventDefault();nuevo()});$("#comboMarca").on("change",function(n){n.preventDefault();r($("#comboMarca").val(),0)});$("#btnGuardar").click(function(t){var u,i,r;t.preventDefault();u=$('form[name="frm"]').validator("validate").has(".has-error").length;u||(i={},i.IdEquipo=idSeleccionado,i.Nombre=$("#txtNombre").val(),i.Descripcion=$("#txtDescripcion").val(),i.NumeroEconomico=$("#txtNumeroEconomico").val(),i.ValorComercial=$("#txtValorComercial").val(),i.NumeroSerie=$("#txtNumeroSerie").val(),i.IdUbicacion=$("#comboUbicacion").val(),i.IdMarca=$("#comboMarca").val(),i.IdModelo=$("#comboModelo").val(),i.Anio=$("#txtAnio").val(),i.Activo=$("#chkOperativo").prop("checked")==!0?1:0,r={},r.path=window.location.hostname,r.equipo=i,r.accion=accion,r=JSON.stringify(r),$.ajax({type:"POST",url:"../pages/PanelEquipos.aspx/Guardar",data:r,contentType:"application/json; charset=utf-8",dataType:"json",async:!0,success:function(t){var i=t.d,u=parseInt(i[0]),r=i[1];console.log(r);$("#spnMensajes").html(r);$("#panelMensajes").modal("show");u>0?($("#lblMensajesOk").text("Registro guardado correctamente..."),$("#alert-operacion-ok").show("fast",function(){setTimeout(function(){$("#alert-operacion-ok").hide("fast")},3e3)}),$("#panelTabla").show(),$("#panelForm").hide(),n()):($("#lblMensajesFail").text("No se pudo guardar el registro..."),$("#alert-operacion-fail").show("fast",function(){setTimeout(function(){$("#alert-operacion-fail").hide("fast")},3e3)}));$("#panelEdicion").modal("hide")},error:function(n,t){console.log(t+": "+n.responseText);$("#lblMensajesFail").text("No se pudo guardar el registro...");$("#alert-operacion-fail").show("fast",function(){setTimeout(function(){$("#alert-operacion-fail").hide("fast")},3e3)})}}))});$("#btnCancelar").click(function(n){n.preventDefault();$("#panelTabla").show();$("#panelForm").hide()});$("#btnEliminarAceptar").click(function(){var t={};t.path=window.location.hostname;t.id=idSeleccionado;t=JSON.stringify(t);$.ajax({type:"POST",url:"../pages/PanelEquipos.aspx/EliminarEquipo",data:t,contentType:"application/json; charset=utf-8",dataType:"json",async:!0,success:function(t){var i=t.d;i.MensajeError===null?($("#spnMensajes").html("Registro eliminado correctamente..."),$("#panelMensajes").modal("show"),n()):($("#spnMensajes").html(i.MensajeError),$("#panelMensajes").modal("show"))},error:function(n,t){console.log(t+": "+n.responseText)}})})});