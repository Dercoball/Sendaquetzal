"use strict";class PanelSolicitudRefacciones{}const registroPanelRefacciones={init:()=>{$("#panelFormRefacciones").hide(),$("#panelTablaRefacciones").hide(),registroPanelRefacciones.accion="",registroPanelRefacciones.cargarComboMarcasRefacciones(),registroPanelRefacciones.idRequisicionSeleccionada=-1,registroPanelRefacciones.idRefaccionSeleccionada=-1},cargarComboMarcasRefacciones:()=>{var n={};n.path=window.location.hostname;n=JSON.stringify(n);$.ajax({type:"POST",url:"../pages/Proyectos.aspx/GetListaMarcas",data:n,contentType:"application/json; charset=utf-8",dataType:"json","async":!0,success:function(n){var t=n.d,i=new $.jqx.dataAdapter(t);$("#comboMarcaProveedor").jqxDropDownList({source:i,displayMember:"Nombre",valueMember:"Id_Marca",width:"250px",height:"20px",placeHolder:"Seleccione:",filterable:!0,searchMode:"containsignorecase",filterPlaceHolder:"Buscar"});$("#comboMarcaProveedor").jqxDropDownList("clearSelection")},error:function(n,t){console.log(t+": "+n.responseText)}})},cargarItems:n=>{var t={};t.path=window.location.hostname;t.idUsuario=sessionStorage.getItem("idusuario");t.idRequisicion=n;t=JSON.stringify(t);$.ajax({type:"POST",url:"../pages/MantenimientoPanelSolicitudRefacciones.aspx/GetItems",data:t,contentType:"application/json; charset=utf-8",dataType:"json","async":!0,success:function(n){let t=$("#tablaRefacciones").DataTable({pageLength:50,destroy:!0,processing:!0,order:[],data:n.d,columns:[{data:"FechaFormateadaMx"},{data:"NombreMarca"},{data:"Cantidad"},{data:"NumeroParte"},{data:"Descripcion"},{data:"ValorCaptura"},{data:"Accion"}],language:textosEsp,columnDefs:[{targets:[0,1,2,3,4,5],orderable:!1},],dom:"t"});$("#tablaRefacciones").on("draw.dt",function(){});$("#tablaRefacciones").trigger("draw.dt")},error:function(n,t){console.log(t+": "+n.responseText)}})},nuevo:()=>{console.log("nuevo refaccion"),$("#frmRefaccion")[0].reset(),$(".form-group").removeClass("has-error"),$(".help-block").empty(),registroPanelRefacciones.accion="nuevo",$("#panelTablaRefacciones").hide(),$("#panelFormRefacciones").show(),obtenerFechaHoraServidor("txtFecha")},cancelarRefacciones:n=>{registroPanelRefacciones.idRefaccionSeleccionada=n,$("#msgCancelar").html(mensajesAlertas.confirmacionCancelarRefaccion.replace("{numrefaccion}",n)),$("#panelCancelarRefaccion").modal("show")},accionesBotones:()=>{$("#btnEliminarAceptarRefaccion").on("click",()=>{var n={};n.path=window.location.hostname;n.id=registroPanelRefacciones.idRefaccionSeleccionada;n=JSON.stringify(n);$.ajax({type:"POST",url:"../pages/MantenimientoPanelSolicitudRefacciones.aspx/CancelarRefaccion",data:n,contentType:"application/json; charset=utf-8",dataType:"json","async":!0,success:function(n){$("#panelCancelarRefaccion").modal("hide");var t=n.d;t.MensajeError===null?(utils.toast(mensajesAlertas.exitoCancelarRefaccion,"ok"),registroPanelRefacciones.cargarItems(registroPanelRefacciones.idRequisicionSeleccionada)):utils.toast(t.MensajeError,"error")},error:function(n,t){console.log(t+": "+n.responseText)}})});$("#btnNuevo").on("click",n=>{n.preventDefault(),registroPanelRefacciones.nuevo()});$("#btnGuardarRefaccion").on("click",n=>{var r,t,i;if(n.preventDefault(),r=$('form[name="frmRefaccion"]').validator("validate").has(".has-error").length,!r){if($("#comboMarcaProveedor").val()==null||$("#comboMarcaProveedor").val()===""){utils.toast(mensajesAlertas.errorSeleccionarMarca,"error");return}t={};t.IdRequisicion=registroPanelRefacciones.idRequisicionSeleccionada;t.Descripcion=$("#txtDescripcionRefaccion").val();t.NumeroParte=$("#txtNumeroParte").val();t.Cantidad=$("#txtCantidad").val();t.IdMarca=$("#comboMarcaProveedor").val()===null?"-1":$("#comboMarcaProveedor").val();t.Fecha=$("#txtFecha").prop("fecha");t.IdUnidad=1;t.Urgencia="urgente";t.idUsuario=sessionStorage.getItem("idusuario");i={};i.path=window.location.hostname;i.item=t;i.accion=registroPanelRefacciones.accion;i=JSON.stringify(i);$.ajax({type:"POST",url:"../pages/MantenimientoPanelSolicitudRefacciones.aspx/GuardarRefaccion",data:i,contentType:"application/json; charset=utf-8",dataType:"json","async":!0,success:function(n){var t=n.d;t.CodigoError==0?(utils.toast(mensajesAlertas.exitoGuardar,"ok"),$("#panelFormRefacciones").hide(),$("#panelTablaRefacciones").show(),registroPanelRefacciones.cargarItems(registroPanelRefacciones.idRequisicionSeleccionada)):utils.toast(mensajesAlertas.errorGuardar,"error")},error:function(n,t){console.log(t+": "+n.responseText);utils.toast(mensajesAlertas.errorGuardar,"error")}})}});$("#btnCancelarRefaccion").on("click",n=>{n.preventDefault(),$("#panelFormRefacciones").hide(),$("#panelTablaRefacciones").show()})}};window.addEventListener("load",()=>{registroPanelRefacciones.init(),registroPanelRefacciones.accionesBotones()});